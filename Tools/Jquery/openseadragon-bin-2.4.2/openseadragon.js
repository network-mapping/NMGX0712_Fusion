function OpenSeadragon(options){return new OpenSeadragon.Viewer(options)}!function($){$.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var devicePixelRatio,canvasElement,class2type={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},toString=Object.prototype.toString,hasOwn=Object.prototype.hasOwnProperty;$.isFunction=function(obj){return"function"===$.type(obj)},$.isArray=Array.isArray||function(obj){return"array"===$.type(obj)},$.isWindow=function(obj){return obj&&"object"==typeof obj&&"setInterval"in obj},$.type=function(obj){return null==obj?String(obj):class2type[toString.call(obj)]||"object"},$.isPlainObject=function(obj){if(!obj||"object"!==OpenSeadragon.type(obj)||obj.nodeType||$.isWindow(obj))return!1;if(obj.constructor&&!hasOwn.call(obj,"constructor")&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf"))return!1;var lastKey,key;for(key in obj)lastKey=key;return void 0===lastKey||hasOwn.call(obj,lastKey)},$.isEmptyObject=function(obj){for(var name in obj)return!1;return!0},$.freezeObject=function(obj){return Object.freeze?$.freezeObject=Object.freeze:$.freezeObject=function(obj){return obj},$.freezeObject(obj)},$.supportsCanvas=(canvasElement=document.createElement("canvas"),!(!$.isFunction(canvasElement.getContext)||!canvasElement.getContext("2d"))),$.isCanvasTainted=function(canvas){var isTainted=!1;try{canvas.getContext("2d").getImageData(0,0,1,1)}catch(e){isTainted=!0}return isTainted},$.pixelDensityRatio=$.supportsCanvas?(canvasElement=document.createElement("canvas").getContext("2d"),devicePixelRatio=window.devicePixelRatio||1,canvasElement=canvasElement.webkitBackingStorePixelRatio||canvasElement.mozBackingStorePixelRatio||canvasElement.msBackingStorePixelRatio||canvasElement.oBackingStorePixelRatio||canvasElement.backingStorePixelRatio||1,Math.max(devicePixelRatio,1)/canvasElement):1}(OpenSeadragon),!function($){$.extend=function(){var options,name,copy,copyIsArray,src,target=arguments[0]||{},length=arguments.length,deep=!1,i=1;for("boolean"==typeof target&&(deep=target,target=arguments[1]||{},i=2),"object"==typeof target||OpenSeadragon.isFunction(target)||(target={}),length===i&&(target=this,--i);i<length;i++)if(null!==(options=arguments[i])||void 0!==options)for(name in options)src=target[name],target!==(copy=options[name])&&(deep&&copy&&(OpenSeadragon.isPlainObject(copy)||(copyIsArray=OpenSeadragon.isArray(copy)))?(src=copyIsArray?(copyIsArray=!1,src&&OpenSeadragon.isArray(src)?src:[]):src&&OpenSeadragon.isPlainObject(src)?src:{},target[name]=OpenSeadragon.extend(deep,src,copy)):void 0!==copy&&(target[name]=copy));return target};var isIOSDevice=function(){var userAgent;return"object"==typeof navigator&&"string"==typeof(userAgent=navigator.userAgent)&&(-1!==userAgent.indexOf("iPhone")||-1!==userAgent.indexOf("iPad")||-1!==userAgent.indexOf("iPod"))},nullfunction=($.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(object,method){return function(){var args=arguments;return method.apply(object,args=void 0===args?[]:args)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(element){return element="string"==typeof element?document.getElementById(element):element},getElementPosition:function(element){for(var isFixed,result=new $.Point,offsetParent=getOffsetParent(element=$.getElement(element),isFixed="fixed"==$.getElementStyle(element).position);offsetParent;)result.x+=element.offsetLeft,result.y+=element.offsetTop,isFixed&&(result=result.plus($.getPageScroll())),offsetParent=getOffsetParent(element=offsetParent,isFixed="fixed"==$.getElementStyle(element).position);return result},getElementOffset:function(element){var docElement,doc=(element=$.getElement(element))&&element.ownerDocument,boundingRect={top:0,left:0};return doc?(docElement=doc.documentElement,void 0!==element.getBoundingClientRect&&(boundingRect=element.getBoundingClientRect()),element=doc==doc.window?doc:9===doc.nodeType&&(doc.defaultView||doc.parentWindow),new $.Point(boundingRect.left+(element.pageXOffset||docElement.scrollLeft)-(docElement.clientLeft||0),boundingRect.top+(element.pageYOffset||docElement.scrollTop)-(docElement.clientTop||0))):new $.Point},getElementSize:function(element){return element=$.getElement(element),new $.Point(element.clientWidth,element.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(element){return(element=$.getElement(element)).currentStyle}:function(element){return element=$.getElement(element),window.getComputedStyle(element,"")},getCssPropertyWithVendorPrefix:function(property){var memo={};return $.getCssPropertyWithVendorPrefix=function(property){if(void 0!==memo[property])return memo[property];var style=document.createElement("div").style,result=null;if(void 0!==style[property])result=property;else for(var prefixes=["Webkit","Moz","MS","O","webkit","moz","ms","o"],suffix=$.capitalizeFirstLetter(property),i=0;i<prefixes.length;i++){var prop=prefixes[i]+suffix;if(void 0!==style[prop]){result=prop;break}}return memo[property]=result},$.getCssPropertyWithVendorPrefix(property)},capitalizeFirstLetter:function(string){return string.charAt(0).toUpperCase()+string.slice(1)},positiveModulo:function(number,modulo){number%=modulo;return number<0&&(number+=modulo),number},pointInElement:function(element,point){element=$.getElement(element);var offset=$.getElementOffset(element),element=$.getElementSize(element);return point.x>=offset.x&&point.x<offset.x+element.x&&point.y<offset.y+element.y&&point.y>=offset.y},getEvent:function(event){return $.getEvent=event?function(event){return event}:function(){return window.event},$.getEvent(event)},getMousePosition:function(event){if("number"==typeof event.pageX)$.getMousePosition=function(event){var result=new $.Point;return event=$.getEvent(event),result.x=event.pageX,result.y=event.pageY,result};else{if("number"!=typeof event.clientX)throw new Error("Unknown event mouse position, no known technique.");$.getMousePosition=function(event){var result=new $.Point;return event=$.getEvent(event),result.x=event.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,result.y=event.clientY+document.body.scrollTop+document.documentElement.scrollTop,result}}return $.getMousePosition(event)},getPageScroll:function(){var docElement=document.documentElement||{},body=document.body||{};if("number"==typeof window.pageXOffset)$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(body.scrollLeft||body.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!docElement.scrollLeft&&!docElement.scrollTop)return new $.Point(0,0);$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return $.getPageScroll()},setPageScroll:function(scroll){if(void 0!==window.scrollTo)$.setPageScroll=function(scroll){window.scrollTo(scroll.x,scroll.y)};else{var originalScroll=$.getPageScroll();if(originalScroll.x===scroll.x&&originalScroll.y===scroll.y)return;document.body.scrollLeft=scroll.x,document.body.scrollTop=scroll.y;var currentScroll=$.getPageScroll();if(currentScroll.x!==originalScroll.x&&currentScroll.y!==originalScroll.y)return void($.setPageScroll=function(scroll){document.body.scrollLeft=scroll.x,document.body.scrollTop=scroll.y});if(document.documentElement.scrollLeft=scroll.x,document.documentElement.scrollTop=scroll.y,(currentScroll=$.getPageScroll()).x!==originalScroll.x&&currentScroll.y!==originalScroll.y)return void($.setPageScroll=function(scroll){document.documentElement.scrollLeft=scroll.x,document.documentElement.scrollTop=scroll.y});$.setPageScroll=function(scroll){}}return $.setPageScroll(scroll)},getWindowSize:function(){var docElement=document.documentElement||{},body=document.body||{};if("number"==typeof window.innerWidth)$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(docElement.clientWidth||docElement.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!body.clientWidth&&!body.clientHeight)throw new Error("Unknown window size, no known technique.");$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)}}return $.getWindowSize()},makeCenteredNode:function(element){element=$.getElement(element);var wrappers=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(wrappers[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(wrappers[1].style,{display:"table-row"}),$.extend(wrappers[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),wrappers[0].appendChild(wrappers[1]),wrappers[1].appendChild(wrappers[2]),wrappers[2].appendChild(element),wrappers[0]},makeNeutralElement:function(tagName){var tagName=document.createElement(tagName),style=tagName.style;return style.background="transparent none",style.border="none",style.margin="0px",style.padding="0px",style.position="static",tagName},now:function(){return Date.now?$.now=Date.now:$.now=function(){return(new Date).getTime()},$.now()},makeTransparentImage:function(src){return $.makeTransparentImage=function(src){var img=$.makeNeutralElement("img");return img.src=src,img},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(src){var img=$.makeNeutralElement("img"),element=null;return(element=$.makeNeutralElement("span")).style.display="inline-block",img.onload=function(){element.style.width=element.style.width||img.width+"px",element.style.height=element.style.height||img.height+"px",img.onload=null,img=null},img.src=src,element.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+src+"', sizingMethod='scale')",element}),$.makeTransparentImage(src)},setElementOpacity:function(element,opacity,usesAlpha){element=$.getElement(element),usesAlpha&&!$.Browser.alpha&&(opacity=Math.round(opacity)),$.Browser.opacity?element.style.opacity=opacity<1?opacity:"":opacity<1?(usesAlpha=Math.round(100*opacity),element.style.filter="alpha(opacity="+usesAlpha+")"):element.style.filter=""},setElementTouchActionNone:function(element){void 0!==(element=$.getElement(element)).style.touchAction?element.style.touchAction="none":void 0!==element.style.msTouchAction&&(element.style.msTouchAction="none")},addClass:function(element,className){(element=$.getElement(element)).className?-1===(" "+element.className+" ").indexOf(" "+className+" ")&&(element.className+=" "+className):element.className=className},indexOf:function(array,searchElement,fromIndex){return Array.prototype.indexOf?this.indexOf=function(array,searchElement,fromIndex){return array.indexOf(searchElement,fromIndex)}:this.indexOf=function(array,searchElement,fromIndex){var i,length,fromIndex=fromIndex||0;if(!array)throw new TypeError;if(!(0===(length=array.length)||length<=fromIndex))for(i=fromIndex=fromIndex<0?length-Math.abs(fromIndex):fromIndex;i<length;i++)if(array[i]===searchElement)return i;return-1},this.indexOf(array,searchElement,fromIndex)},removeClass:function(element,className){for(var newClasses=[],oldClasses=(element=$.getElement(element)).className.split(/\s+/),i=0;i<oldClasses.length;i++)oldClasses[i]&&oldClasses[i]!==className&&newClasses.push(oldClasses[i]);element.className=newClasses.join(" ")},addEvent:function(){if(window.addEventListener)return function(element,eventName,handler,useCapture){(element=$.getElement(element)).addEventListener(eventName,handler,useCapture)};if(window.attachEvent)return function(element,eventName,handler,useCapture){(element=$.getElement(element)).attachEvent("on"+eventName,handler)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(element,eventName,handler,useCapture){(element=$.getElement(element)).removeEventListener(eventName,handler,useCapture)};if(window.detachEvent)return function(element,eventName,handler,useCapture){(element=$.getElement(element)).detachEvent("on"+eventName,handler)};throw new Error("No known event model.")}(),cancelEvent:function(event){(event=$.getEvent(event)).preventDefault?$.cancelEvent=function(event){event.preventDefault()}:$.cancelEvent=function(event){(event=$.getEvent(event)).cancel=!0,event.returnValue=!1},$.cancelEvent(event)},stopEvent:function(event){(event=$.getEvent(event)).stopPropagation?$.stopEvent=function(event){event.stopPropagation()}:$.stopEvent=function(event){(event=$.getEvent(event)).cancelBubble=!0},$.stopEvent(event)},createCallback:function(object,method){for(var initialArgs=[],i=2;i<arguments.length;i++)initialArgs.push(arguments[i]);return function(){for(var args=initialArgs.concat([]),i=0;i<arguments.length;i++)args.push(arguments[i]);return method.apply(object,args)}},getUrlParameter:function(key){key=URLPARAMS[key];return key||null},getUrlProtocol:function(url){url=url.match(/^([a-z]+:)\/\//i);return null===url?window.location.protocol:url[1].toLowerCase()},createAjaxRequest:function(local){var supportActiveX;try{supportActiveX=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(e){supportActiveX=!1}if(supportActiveX)window.XMLHttpRequest?$.createAjaxRequest=function(local){return local?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");$.createAjaxRequest=function(){return new XMLHttpRequest}}return $.createAjaxRequest(local)},makeAjaxRequest:function(url,onSuccess,onError){$.isPlainObject(url)&&(onSuccess=url.success,onError=url.error,withCredentials=url.withCredentials,headers=url.headers,responseType=url.responseType||null,url=url.url);var withCredentials,headers,protocol=$.getUrlProtocol(url),request=$.createAjaxRequest("file:"===protocol);if(!$.isFunction(onSuccess))throw new Error("makeAjaxRequest requires a success callback");request.onreadystatechange=function(){4==request.readyState&&(request.onreadystatechange=function(){},200<=request.status&&request.status<300||0===request.status&&"http:"!==protocol&&"https:"!==protocol?onSuccess(request):($.console.log("AJAX request returned %d: %s",request.status,url),$.isFunction(onError)&&onError(request)))};try{if(request.open("GET",url,!0),responseType&&(request.responseType=responseType),headers)for(var headerName in headers)Object.prototype.hasOwnProperty.call(headers,headerName)&&headers[headerName]&&request.setRequestHeader(headerName,headers[headerName]);withCredentials&&(request.withCredentials=!0),request.send(null)}catch(e){var responseType=e.message;if($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10&&void 0!==e.number&&-2147024891==e.number&&(responseType+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),$.console.log("%s while making AJAX request: %s",e.name,responseType),request.onreadystatechange=function(){},window.XDomainRequest){var xdr=new window.XDomainRequest;if(xdr){xdr.onload=function(e){$.isFunction(onSuccess)&&onSuccess({responseText:xdr.responseText,status:200,statusText:"OK"})},xdr.onerror=function(e){$.isFunction(onError)&&onError({responseText:xdr.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{xdr.open("GET",url),xdr.send()}catch(e2){$.isFunction(onError)&&onError(request,e)}}}else $.isFunction(onError)&&onError(request,e)}return request},jsonp:function(options){var script,url=options.url,head=document.head||document.getElementsByTagName("head")[0]||document.documentElement,jsonpCallback=options.callbackName||"openseadragon"+$.now(),previous=window[jsonpCallback],callbackParam=options.param||"callback",callback=options.callback,url=url.replace(/(\=)\?(&|$)|\?\?/i,"$1"+jsonpCallback+"$2");url+=(/\?/.test(url)?"&":"?")+callbackParam+"="+jsonpCallback,window[jsonpCallback]=function(response){if(previous)window[jsonpCallback]=previous;else try{delete window[jsonpCallback]}catch(e){}callback&&$.isFunction(callback)&&callback(response)},script=document.createElement("script"),void 0===options.async&&!1===options.async||(script.async="async"),options.scriptCharset&&(script.charset=options.scriptCharset),script.src=url,script.onload=script.onreadystatechange=function(_,isAbort){!isAbort&&script.readyState&&!/loaded|complete/.test(script.readyState)||(script.onload=script.onreadystatechange=null,head&&script.parentNode&&head.removeChild(script),script=void 0)},head.insertBefore(script,head.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(string){if(window.DOMParser)$.parseXml=function(string){return(new DOMParser).parseFromString(string,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");$.parseXml=function(string){var xmlDoc=null;return(xmlDoc=new ActiveXObject("Microsoft.XMLDOM")).async=!1,xmlDoc.loadXML(string),xmlDoc}}return $.parseXml(string)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(extension){return!!FILEFORMATS[(extension=extension||"").toLowerCase()]}}),function(msg){}),FILEFORMATS=($.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0},{bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1}),URLPARAMS={};function getOffsetParent(element,isFixed){return isFixed&&element!=document.body?document.body:element.offsetParent}!function(){var ver=navigator.appVersion,ua=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(ua.substring(ua.indexOf("MSIE")+5,ua.indexOf(";",ua.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(0<=ua.indexOf("Firefox")?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(ua.substring(ua.indexOf("Firefox")+8))):0<=ua.indexOf("Safari")?($.Browser.vendor=0<=ua.indexOf("Chrome")?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(ua.substring(ua.substring(0,ua.indexOf("Safari")).lastIndexOf("/")+1,ua.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(ua)&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(ver)}for(var sep,parts=window.location.search.substring(1).split("&"),i=0;i<parts.length;i++)if(0<(sep=(part=parts[i]).indexOf("="))){var key=part.substring(0,sep),part=part.substring(sep+1);try{URLPARAMS[key]=decodeURIComponent(part)}catch(e){$.console.error("Ignoring malformed URL parameter: %s=%s",key,part)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)}(),!function(w){var aAnimQueue,processing,iRequestId,iIntervalId,requestAnimationFrame=w.requestAnimationFrame||w.mozRequestAnimationFrame||w.webkitRequestAnimationFrame||w.msRequestAnimationFrame,cancelAnimationFrame=w.cancelAnimationFrame||w.mozCancelAnimationFrame||w.webkitCancelAnimationFrame||w.msCancelAnimationFrame;requestAnimationFrame&&cancelAnimationFrame?($.requestAnimationFrame=function(){return requestAnimationFrame.apply(w,arguments)},$.cancelAnimationFrame=function(){return cancelAnimationFrame.apply(w,arguments)}):(aAnimQueue=[],processing=[],iRequestId=0,$.requestAnimationFrame=function(callback){return aAnimQueue.push([++iRequestId,callback]),iIntervalId=iIntervalId||setInterval(function(){if(aAnimQueue.length){var time=$.now(),temp=processing;for(processing=aAnimQueue,aAnimQueue=temp;processing.length;)processing.shift()[1](time)}else clearInterval(iIntervalId),iIntervalId=void 0},20),iRequestId},$.cancelAnimationFrame=function(requestId){for(var i=0,j=aAnimQueue.length;i<j;i+=1)if(aAnimQueue[i][0]===requestId)return void aAnimQueue.splice(i,1);for(i=0,j=processing.length;i<j;i+=1)if(processing[i][0]===requestId)return void processing.splice(i,1)})}(window)}(OpenSeadragon),!function(root,factory){"function"==typeof define&&define.amd?define([],factory):"object"==typeof module&&module.exports?module.exports=factory():root.OpenSeadragon=factory()}(this,function(){return OpenSeadragon}),!function($){var fullScreenApi={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.fullscreenElement},fullScreenApi.requestFullScreen=function(element){return element.requestFullscreen()},fullScreenApi.exitFullScreen=function(){document.exitFullscreen()},fullScreenApi.fullScreenEventName="fullscreenchange",fullScreenApi.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.msFullscreenElement},fullScreenApi.requestFullScreen=function(element){return element.msRequestFullscreen()},fullScreenApi.exitFullScreen=function(){document.msExitFullscreen()},fullScreenApi.fullScreenEventName="MSFullscreenChange",fullScreenApi.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.webkitFullscreenElement},fullScreenApi.requestFullScreen=function(element){return element.webkitRequestFullscreen()},fullScreenApi.exitFullScreen=function(){document.webkitExitFullscreen()},fullScreenApi.fullScreenEventName="webkitfullscreenchange",fullScreenApi.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},fullScreenApi.requestFullScreen=function(element){return element.webkitRequestFullScreen()},fullScreenApi.exitFullScreen=function(){document.webkitCancelFullScreen()},fullScreenApi.fullScreenEventName="webkitfullscreenchange",fullScreenApi.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.mozFullScreenElement},fullScreenApi.requestFullScreen=function(element){return element.mozRequestFullScreen()},fullScreenApi.exitFullScreen=function(){document.mozCancelFullScreen()},fullScreenApi.fullScreenEventName="mozfullscreenchange",fullScreenApi.fullScreenErrorEventName="mozfullscreenerror"),fullScreenApi.isFullScreen=function(){return null!==fullScreenApi.getFullScreenElement()},fullScreenApi.cancelFullScreen=function(){$.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),fullScreenApi.exitFullScreen()},$.extend($,fullScreenApi)}(OpenSeadragon),!function($){$.EventSource=function(){this.events={}},$.EventSource.prototype={addOnceHandler:function(eventName,handler,userData,times){function onceHandler(event){++count===times&&self.removeHandler(eventName,onceHandler),handler(event)}var self=this,count=(times=times||1,0);this.addHandler(eventName,onceHandler,userData)},addHandler:function(eventName,handler,userData){var events=this.events[eventName];events||(this.events[eventName]=events=[]),handler&&$.isFunction(handler)&&(events[events.length]={handler:handler,userData:userData||null})},removeHandler:function(eventName,handler){var i,events=this.events[eventName],handlers=[];if(events&&$.isArray(events)){for(i=0;i<events.length;i++)events[i].handler!==handler&&handlers.push(events[i]);this.events[eventName]=handlers}},removeAllHandlers:function(eventName){if(eventName)this.events[eventName]=[];else for(var eventType in this.events)this.events[eventType]=[]},getHandler:function(eventName){var events=this.events[eventName];return events&&events.length?(events=1===events.length?[events[0]]:Array.apply(null,events),function(source,args){for(var length=events.length,i=0;i<length;i++)events[i]&&(args.eventSource=source,args.userData=events[i].userData,events[i].handler(args))}):null},raiseEvent:function(eventName,eventArgs){eventName=this.getHandler(eventName);eventName&&eventName(this,eventArgs=eventArgs||{})}}}(OpenSeadragon),!function($){var trackerPoints,intervalId,lastTime,divElement,MOUSETRACKERS=[],THIS={};function _generateGuid(tracker,gPoint){return tracker.hash.toString()+gPoint.type+gPoint.id.toString()}function _doTracking(){var i,trackPoint,gPoint,distance,len=trackerPoints.length,now=$.now(),elapsedTime=now-lastTime;for(lastTime=now,i=0;i<len;i++)(gPoint=(trackPoint=trackerPoints[i]).gPoint).direction=Math.atan2(gPoint.currentPos.y-trackPoint.lastPos.y,gPoint.currentPos.x-trackPoint.lastPos.x),distance=trackPoint.lastPos.distanceTo(gPoint.currentPos),trackPoint.lastPos=gPoint.currentPos,gPoint.speed=.75*(1e3*distance/(1+elapsedTime))+.25*gPoint.speed}function clearTrackedPointers(tracker){for(var delegate=THIS[tracker.hash],pointerListCount=delegate.activePointersLists.length,i=0;i<pointerListCount;i++)0<delegate.activePointersLists[i].captureCount&&($.removeEvent($.MouseTracker.captureElement,"mousemove",delegate.mousemovecaptured,!0),$.removeEvent($.MouseTracker.captureElement,"mouseup",delegate.mouseupcaptured,!0),$.removeEvent($.MouseTracker.captureElement,$.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",delegate.pointermovecaptured,!0),$.removeEvent($.MouseTracker.captureElement,$.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",delegate.pointerupcaptured,!0),$.removeEvent($.MouseTracker.captureElement,"touchmove",delegate.touchmovecaptured,!0),$.removeEvent($.MouseTracker.captureElement,"touchend",delegate.touchendcaptured,!0),delegate.activePointersLists[i].captureCount=0);for(i=0;i<pointerListCount;i++)delegate.activePointersLists.pop()}function stopTracking(tracker){var event,i,delegate=THIS[tracker.hash];if(delegate.tracking){for(i=0;i<$.MouseTracker.subscribeEvents.length;i++)event=$.MouseTracker.subscribeEvents[i],$.removeEvent(tracker.element,event,delegate[event],!1);clearTrackedPointers(tracker),delegate.tracking=!1}}function getCaptureEventParams(tracker,pointerType){tracker=THIS[tracker.hash];if("pointerevent"===pointerType)return{upName:$.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:tracker.pointerupcaptured,moveName:$.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:tracker.pointermovecaptured};if("mouse"===pointerType)return{upName:"mouseup",upHandler:tracker.mouseupcaptured,moveName:"mousemove",moveHandler:tracker.mousemovecaptured};if("touch"===pointerType)return{upName:"touchend",upHandler:tracker.touchendcaptured,moveName:"touchmove",moveHandler:tracker.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function capturePointer(tracker,pointerType,pointerCount){var pointsList=tracker.getActivePointersListByType(pointerType);pointsList.captureCount+=pointerCount||1,1===pointsList.captureCount&&($.Browser.vendor===$.BROWSERS.IE&&$.Browser.version<9?tracker.element.setCapture(!0):(pointerCount=getCaptureEventParams(tracker,$.MouseTracker.havePointerEvents?"pointerevent":pointerType),isInIframe&&canAccessEvents(window.top)&&$.addEvent(window.top,pointerCount.upName,pointerCount.upHandler,!0),$.addEvent($.MouseTracker.captureElement,pointerCount.upName,pointerCount.upHandler,!0),$.addEvent($.MouseTracker.captureElement,pointerCount.moveName,pointerCount.moveHandler,!0)))}function releasePointer(tracker,pointerType,pointerCount){var pointsList=tracker.getActivePointersListByType(pointerType);pointsList.captureCount-=pointerCount||1,0===pointsList.captureCount&&($.Browser.vendor===$.BROWSERS.IE&&$.Browser.version<9?tracker.element.releaseCapture():(pointerCount=getCaptureEventParams(tracker,$.MouseTracker.havePointerEvents?"pointerevent":pointerType),isInIframe&&canAccessEvents(window.top)&&$.removeEvent(window.top,pointerCount.upName,pointerCount.upHandler,!0),$.removeEvent($.MouseTracker.captureElement,pointerCount.moveName,pointerCount.moveHandler,!0),$.removeEvent($.MouseTracker.captureElement,pointerCount.upName,pointerCount.upHandler,!0)))}function getPointerType(event){var pointerTypeStr;if($.MouseTracker.unprefixedPointerEvents)pointerTypeStr=event.pointerType;else switch(event.pointerType){case 2:pointerTypeStr="touch";break;case 3:pointerTypeStr="pen";break;case 4:pointerTypeStr="mouse";break;default:pointerTypeStr=""}return pointerTypeStr}function getMouseAbsolute(event){return $.getMousePosition(event)}function getMouseRelative(event,element){return getPointRelativeToAbsolute(getMouseAbsolute(event),element)}function getPointRelativeToAbsolute(point,element){element=$.getElementOffset(element);return point.minus(element)}function getCenterPoint(point1,point2){return new $.Point((point1.x+point2.x)/2,(point1.y+point2.y)/2)}function onMouseWheel(tracker,event){var simulatedEvent={target:(event=$.getEvent(event)).target||event.srcElement,type:"wheel",shiftKey:event.shiftKey||!1,clientX:event.clientX,clientY:event.clientY,pageX:event.pageX||event.clientX,pageY:event.pageY||event.clientY,deltaMode:"MozMousePixelScroll"==event.type?0:1,deltaX:0,deltaZ:0};"mousewheel"==$.MouseTracker.wheelEventName?simulatedEvent.deltaY=-event.wheelDelta/$.DEFAULT_SETTINGS.pixelsPerWheelLine:simulatedEvent.deltaY=event.detail,handleWheelEvent(tracker,simulatedEvent,event)}function handleWheelEvent(tracker,event,originalEvent){var nDelta=event.deltaY<0?1:-1;tracker.scrollHandler&&!1===tracker.scrollHandler({eventSource:tracker,pointerType:"mouse",position:getMouseRelative(event,tracker.element),scroll:nDelta,shift:event.shiftKey,isTouchEvent:!1,originalEvent:originalEvent,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(originalEvent)}function isParentChild(parent,child){if(parent!==child){for(;child&&child!==parent;)child=child.parentNode;return child===parent}}function handleMouseEnter(tracker,event){updatePointersEnter(tracker,event,[{id:$.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:getMouseAbsolute(event),currentTime:$.now()}])}function handleMouseExit(tracker,event){updatePointersExit(tracker,event,[{id:$.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:getMouseAbsolute(event),currentTime:$.now()}])}function getStandardizedButton(button){return $.Browser.vendor===$.BROWSERS.IE&&$.Browser.version<9?1===button?0:2===button?2:4===button?1:-1:button}function handleMouseUp(tracker,event){updatePointersUp(tracker,event=$.getEvent(event),[{id:$.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:getMouseAbsolute(event),currentTime:$.now()}],getStandardizedButton(event.button))&&releasePointer(tracker,"mouse")}function handleMouseMove(tracker,event){updatePointersMove(tracker,event=$.getEvent(event),[{id:$.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:getMouseAbsolute(event),currentTime:$.now()}])}function abortContacts(tracker,event,pointsList){var i,gPointCount=pointsList.getLength(),abortGPoints=[];if("touch"===pointsList.type||0<pointsList.contacts){for(i=0;i<gPointCount;i++)abortGPoints.push(pointsList.getByIndex(i));0<abortGPoints.length&&(updatePointersUp(tracker,event,abortGPoints,0),pointsList.captureCount=1,releasePointer(tracker,pointsList.type),updatePointersExit(tracker,event,abortGPoints))}}function handleTouchEnd(tracker,event){for(var j,parentGPoints,touchCount=event.changedTouches.length,gPoints=[],time=$.now(),i=0;i<touchCount;i++)gPoints.push({id:event.changedTouches[i].identifier,type:"touch",currentPos:getMouseAbsolute(event.changedTouches[i]),currentTime:time});for(updatePointersUp(tracker,event,gPoints,0)&&releasePointer(tracker,"touch",touchCount),updatePointersExit(tracker,event,gPoints),i=0;i<MOUSETRACKERS.length;i++)if(MOUSETRACKERS[i]!==tracker&&MOUSETRACKERS[i].isTracking()&&isParentChild(MOUSETRACKERS[i].element,tracker.element)){for(parentGPoints=[],j=0;j<touchCount;j++)parentGPoints.push({id:event.changedTouches[j].identifier,type:"touch",currentPos:getMouseAbsolute(event.changedTouches[j]),currentTime:time});updatePointersExit(MOUSETRACKERS[i],event,parentGPoints)}$.cancelEvent(event)}function handleTouchMove(tracker,event){for(var touchCount=event.changedTouches.length,gPoints=[],i=0;i<touchCount;i++)gPoints.push({id:event.changedTouches[i].identifier,type:"touch",currentPos:getMouseAbsolute(event.changedTouches[i]),currentTime:$.now()});updatePointersMove(tracker,event,gPoints),$.cancelEvent(event)}function onPointerOver(tracker,event){event.currentTarget===event.relatedTarget||isParentChild(event.currentTarget,event.relatedTarget)||updatePointersEnter(tracker,event,[{id:event.pointerId,type:getPointerType(event),isPrimary:event.isPrimary,currentPos:getMouseAbsolute(event),currentTime:$.now()}])}function onPointerOut(tracker,event){event.currentTarget===event.relatedTarget||isParentChild(event.currentTarget,event.relatedTarget)||updatePointersExit(tracker,event,[{id:event.pointerId,type:getPointerType(event),isPrimary:event.isPrimary,currentPos:getMouseAbsolute(event),currentTime:$.now()}])}function onPointerDown(tracker,event){var gPoint={id:event.pointerId,type:getPointerType(event),isPrimary:event.isPrimary,currentPos:getMouseAbsolute(event),currentTime:$.now()};updatePointersDown(tracker,event,[gPoint],event.button)&&($.stopEvent(event),capturePointer(tracker,gPoint.type)),(tracker.clickHandler||tracker.dblClickHandler||tracker.pressHandler||tracker.dragHandler||tracker.dragEndHandler||tracker.pinchHandler)&&$.cancelEvent(event)}function onPointerUp(tracker,event){handlePointerUp(tracker,event)}function handlePointerUp(tracker,event){var gPoint={id:event.pointerId,type:getPointerType(event),isPrimary:event.isPrimary,currentPos:getMouseAbsolute(event),currentTime:$.now()};updatePointersUp(tracker,event,[gPoint],event.button)&&releasePointer(tracker,gPoint.type)}function onPointerMove(tracker,event){handlePointerMove(tracker,event)}function handlePointerMove(tracker,event){updatePointersMove(tracker,event,[{id:event.pointerId,type:getPointerType(event),isPrimary:event.isPrimary,currentPos:getMouseAbsolute(event),currentTime:$.now()}])}function onPointerCancel(tracker,event){!function(tracker,event,gPoints){updatePointersUp(tracker,event,gPoints,0),updatePointersExit(tracker,event,gPoints)}(tracker,event,[{id:event.pointerId,type:getPointerType(event)}])}function startTrackingPointer(pointsList,gPoint){Object.prototype.hasOwnProperty.call(gPoint,"isPrimary")||(0===pointsList.getLength()?gPoint.isPrimary=!0:gPoint.isPrimary=!1),gPoint.speed=0,gPoint.direction=0,gPoint.contactPos=gPoint.currentPos,gPoint.contactTime=gPoint.currentTime,gPoint.lastPos=gPoint.currentPos,gPoint.lastTime=gPoint.currentTime,pointsList.add(gPoint)}function stopTrackingPointer(pointsList,gPoint){pointsList.getById(gPoint.id)?(pointsList.removeById(gPoint.id),Object.prototype.hasOwnProperty.call(gPoint,"isPrimary")||(gPoint=pointsList.getPrimary())||(gPoint=pointsList.getByIndex(0))&&(gPoint.isPrimary=!0)):pointsList.getLength()}function updatePointersEnter(tracker,event,gPoints){for(var curGPoint,updateGPoint,pointsList=tracker.getActivePointersListByType(gPoints[0].type),gPointCount=gPoints.length,i=0;i<gPointCount;i++)curGPoint=gPoints[i],(updateGPoint=pointsList.getById(curGPoint.id))?(updateGPoint.insideElement=!0,updateGPoint.lastPos=updateGPoint.currentPos,updateGPoint.lastTime=updateGPoint.currentTime,updateGPoint.currentPos=curGPoint.currentPos,updateGPoint.currentTime=curGPoint.currentTime,curGPoint=updateGPoint):(curGPoint.captured=!1,curGPoint.insideElementPressed=!1,curGPoint.insideElement=!0,startTrackingPointer(pointsList,curGPoint)),tracker.enterHandler&&!1===tracker.enterHandler({eventSource:tracker,pointerType:curGPoint.type,position:getPointRelativeToAbsolute(curGPoint.currentPos,tracker.element),buttons:pointsList.buttons,pointers:tracker.getActivePointerCount(),insideElementPressed:curGPoint.insideElementPressed,buttonDownAny:0!==pointsList.buttons,isTouchEvent:"touch"===curGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event)}function updatePointersExit(tracker,event,gPoints){for(var curGPoint,updateGPoint,pointsList=tracker.getActivePointersListByType(gPoints[0].type),gPointCount=gPoints.length,i=0;i<gPointCount;i++)curGPoint=gPoints[i],(updateGPoint=pointsList.getById(curGPoint.id))&&(updateGPoint.captured?(updateGPoint.insideElement=!1,updateGPoint.lastPos=updateGPoint.currentPos,updateGPoint.lastTime=updateGPoint.currentTime,updateGPoint.currentPos=curGPoint.currentPos,updateGPoint.currentTime=curGPoint.currentTime):stopTrackingPointer(pointsList,updateGPoint),curGPoint=updateGPoint),tracker.exitHandler&&!1===tracker.exitHandler({eventSource:tracker,pointerType:curGPoint.type,position:curGPoint.currentPos&&getPointRelativeToAbsolute(curGPoint.currentPos,tracker.element),buttons:pointsList.buttons,pointers:tracker.getActivePointerCount(),insideElementPressed:!!updateGPoint&&updateGPoint.insideElementPressed,buttonDownAny:0!==pointsList.buttons,isTouchEvent:"touch"===curGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event)}function updatePointersDown(tracker,event,gPoints,buttonChanged){for(var curGPoint,updateGPoint,delegate=THIS[tracker.hash],pointsList=tracker.getActivePointersListByType(gPoints[0].type),gPointCount=gPoints.length,otherPointsLists=(void 0!==event.buttons?pointsList.buttons=event.buttons:$.Browser.vendor===$.BROWSERS.IE&&$.Browser.version<9?0===buttonChanged?pointsList.buttons+=1:1===buttonChanged?pointsList.buttons+=4:2===buttonChanged?pointsList.buttons+=2:3===buttonChanged?pointsList.buttons+=8:4===buttonChanged?pointsList.buttons+=16:5===buttonChanged&&(pointsList.buttons+=32):0===buttonChanged?pointsList.buttons|=1:1===buttonChanged?pointsList.buttons|=4:2===buttonChanged?pointsList.buttons|=2:3===buttonChanged?pointsList.buttons|=8:4===buttonChanged?pointsList.buttons|=16:5===buttonChanged&&(pointsList.buttons|=32),tracker.getActivePointersListsExceptType(gPoints[0].type)),i=0;i<otherPointsLists.length;i++)abortContacts(tracker,event,otherPointsLists[i]);if(0===buttonChanged){for(i=0;i<gPointCount;i++)curGPoint=gPoints[i],(updateGPoint=pointsList.getById(curGPoint.id))?(updateGPoint.captured=!0,updateGPoint.insideElementPressed=!0,updateGPoint.insideElement=!0,updateGPoint.contactPos=curGPoint.currentPos,updateGPoint.contactTime=curGPoint.currentTime,updateGPoint.lastPos=updateGPoint.currentPos,updateGPoint.lastTime=updateGPoint.currentTime,updateGPoint.currentPos=curGPoint.currentPos,updateGPoint.currentTime=curGPoint.currentTime,curGPoint=updateGPoint):(curGPoint.captured=!0,curGPoint.insideElementPressed=!0,curGPoint.insideElement=!0,startTrackingPointer(pointsList,curGPoint)),pointsList.addContact(),(tracker.dragHandler||tracker.dragEndHandler||tracker.pinchHandler)&&$.MouseTracker.gesturePointVelocityTracker.addPoint(tracker,curGPoint),1===pointsList.contacts?tracker.pressHandler&&!1===tracker.pressHandler({eventSource:tracker,pointerType:curGPoint.type,position:getPointRelativeToAbsolute(curGPoint.contactPos,tracker.element),buttons:pointsList.buttons,isTouchEvent:"touch"===curGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event):2===pointsList.contacts&&tracker.pinchHandler&&"touch"===curGPoint.type&&(delegate.pinchGPoints=pointsList.asArray(),delegate.lastPinchDist=delegate.currentPinchDist=delegate.pinchGPoints[0].currentPos.distanceTo(delegate.pinchGPoints[1].currentPos),delegate.lastPinchCenter=delegate.currentPinchCenter=getCenterPoint(delegate.pinchGPoints[0].currentPos,delegate.pinchGPoints[1].currentPos));return 1}tracker.nonPrimaryPressHandler&&!1===tracker.nonPrimaryPressHandler({eventSource:tracker,pointerType:gPoints[0].type,position:getPointRelativeToAbsolute(gPoints[0].currentPos,tracker.element),button:buttonChanged,buttons:pointsList.buttons,isTouchEvent:"touch"===gPoints[0].type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event)}function updatePointersUp(tracker,event,gPoints,buttonChanged){var i,curGPoint,updateGPoint,releaseTime,delegate=THIS[tracker.hash],pointsList=tracker.getActivePointersListByType(gPoints[0].type),gPointCount=gPoints.length,releaseCapture=!1,wasCaptured=!1;if(void 0!==event.buttons?pointsList.buttons=event.buttons:$.Browser.vendor===$.BROWSERS.IE&&$.Browser.version<9?0===buttonChanged?--pointsList.buttons:1===buttonChanged?pointsList.buttons-=4:2===buttonChanged?pointsList.buttons-=2:3===buttonChanged?pointsList.buttons-=8:4===buttonChanged?pointsList.buttons-=16:5===buttonChanged&&(pointsList.buttons-=32):0===buttonChanged?pointsList.buttons^=-2:1===buttonChanged?pointsList.buttons^=-5:2===buttonChanged?pointsList.buttons^=-3:3===buttonChanged?pointsList.buttons^=-9:4===buttonChanged?pointsList.buttons^=-17:5===buttonChanged&&(pointsList.buttons^=-33),0!==buttonChanged)tracker.nonPrimaryReleaseHandler&&!1===tracker.nonPrimaryReleaseHandler({eventSource:tracker,pointerType:gPoints[0].type,position:getPointRelativeToAbsolute(gPoints[0].currentPos,tracker.element),button:buttonChanged,buttons:pointsList.buttons,isTouchEvent:"touch"===gPoints[0].type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event),buttonChanged=tracker.getActivePointersListByType("mouse"),abortContacts(tracker,event,buttonChanged);else{if(void 0!==gPoints[0].currentPos){for(i=0;i<gPointCount;i++)curGPoint=gPoints[i],(updateGPoint=pointsList.getById(curGPoint.id))&&(updateGPoint.captured&&(wasCaptured=releaseCapture=!(updateGPoint.captured=!1)),updateGPoint.lastPos=updateGPoint.currentPos,updateGPoint.lastTime=updateGPoint.currentTime,updateGPoint.currentPos=curGPoint.currentPos,updateGPoint.currentTime=curGPoint.currentTime,updateGPoint.insideElement||stopTrackingPointer(pointsList,updateGPoint),curGPoint=updateGPoint.currentPos,releaseTime=updateGPoint.currentTime,wasCaptured?(pointsList.removeContact(),(tracker.dragHandler||tracker.dragEndHandler||tracker.pinchHandler)&&$.MouseTracker.gesturePointVelocityTracker.removePoint(tracker,updateGPoint),0===pointsList.contacts?(tracker.releaseHandler&&!1===tracker.releaseHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(curGPoint,tracker.element),buttons:pointsList.buttons,insideElementPressed:updateGPoint.insideElementPressed,insideElementReleased:updateGPoint.insideElement,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event),tracker.dragEndHandler&&!updateGPoint.currentPos.equals(updateGPoint.contactPos)&&!1===tracker.dragEndHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(updateGPoint.currentPos,tracker.element),speed:updateGPoint.speed,direction:updateGPoint.direction,shift:event.shiftKey,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event),(tracker.clickHandler||tracker.dblClickHandler)&&updateGPoint.insideElement&&(releaseTime=releaseTime-updateGPoint.contactTime<=tracker.clickTimeThreshold&&updateGPoint.contactPos.distanceTo(curGPoint)<=tracker.clickDistThreshold,tracker.clickHandler&&!1===tracker.clickHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(updateGPoint.currentPos,tracker.element),quick:releaseTime,shift:event.shiftKey,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event),tracker.dblClickHandler)&&releaseTime&&(pointsList.clicks++,1===pointsList.clicks?(delegate.lastClickPos=curGPoint,delegate.dblClickTimeOut=setTimeout(function(){pointsList.clicks=0},tracker.dblClickTimeThreshold)):2===pointsList.clicks&&(clearTimeout(delegate.dblClickTimeOut),pointsList.clicks=0,delegate.lastClickPos.distanceTo(curGPoint)<=tracker.dblClickDistThreshold&&!1===tracker.dblClickHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(updateGPoint.currentPos,tracker.element),shift:event.shiftKey,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event),delegate.lastClickPos=null))):2===pointsList.contacts&&tracker.pinchHandler&&"touch"===updateGPoint.type&&(delegate.pinchGPoints=pointsList.asArray(),delegate.lastPinchDist=delegate.currentPinchDist=delegate.pinchGPoints[0].currentPos.distanceTo(delegate.pinchGPoints[1].currentPos),delegate.lastPinchCenter=delegate.currentPinchCenter=getCenterPoint(delegate.pinchGPoints[0].currentPos,delegate.pinchGPoints[1].currentPos))):tracker.releaseHandler&&!1===tracker.releaseHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(curGPoint,tracker.element),buttons:pointsList.buttons,insideElementPressed:updateGPoint.insideElementPressed,insideElementReleased:updateGPoint.insideElement,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event));return releaseCapture}abortContacts(tracker,event,pointsList)}}function updatePointersMove(tracker,event,gPoints){var i,curGPoint,updateGPoint,gPointArray,delta,delegate=THIS[tracker.hash],pointsList=tracker.getActivePointersListByType(gPoints[0].type),gPointCount=gPoints.length;for(void 0!==event.buttons&&(pointsList.buttons=event.buttons),i=0;i<gPointCount;i++)curGPoint=gPoints[i],(updateGPoint=pointsList.getById(curGPoint.id))?(Object.prototype.hasOwnProperty.call(curGPoint,"isPrimary")&&(updateGPoint.isPrimary=curGPoint.isPrimary),updateGPoint.lastPos=updateGPoint.currentPos,updateGPoint.lastTime=updateGPoint.currentTime,updateGPoint.currentPos=curGPoint.currentPos,updateGPoint.currentTime=curGPoint.currentTime):(curGPoint.captured=!1,curGPoint.insideElementPressed=!1,curGPoint.insideElement=!0,startTrackingPointer(pointsList,curGPoint));tracker.stopHandler&&"mouse"===gPoints[0].type&&(clearTimeout(tracker.stopTimeOut),tracker.stopTimeOut=setTimeout(function(){!function(tracker,originalMoveEvent,pointerType){tracker.stopHandler&&tracker.stopHandler({eventSource:tracker,pointerType:pointerType,position:getMouseRelative(originalMoveEvent,tracker.element),buttons:tracker.getActivePointersListByType(pointerType).buttons,isTouchEvent:"touch"===pointerType,originalEvent:originalMoveEvent,preventDefaultAction:!1,userData:tracker.userData})}(tracker,event,gPoints[0].type)},tracker.stopDelay)),0===pointsList.contacts?tracker.moveHandler&&!1===tracker.moveHandler({eventSource:tracker,pointerType:gPoints[0].type,position:getPointRelativeToAbsolute(gPoints[0].currentPos,tracker.element),buttons:pointsList.buttons,isTouchEvent:"touch"===gPoints[0].type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event):1===pointsList.contacts?(tracker.moveHandler&&(updateGPoint=pointsList.asArray()[0],!1===tracker.moveHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(updateGPoint.currentPos,tracker.element),buttons:pointsList.buttons,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData}))&&$.cancelEvent(event),tracker.dragHandler&&(delta=(updateGPoint=pointsList.asArray()[0]).currentPos.minus(updateGPoint.lastPos),!1===tracker.dragHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(updateGPoint.currentPos,tracker.element),buttons:pointsList.buttons,delta:delta,speed:updateGPoint.speed,direction:updateGPoint.direction,shift:event.shiftKey,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData}))&&$.cancelEvent(event)):2===pointsList.contacts&&(tracker.moveHandler&&(gPointArray=pointsList.asArray(),!1===tracker.moveHandler({eventSource:tracker,pointerType:gPointArray[0].type,position:getPointRelativeToAbsolute(getCenterPoint(gPointArray[0].currentPos,gPointArray[1].currentPos),tracker.element),buttons:pointsList.buttons,isTouchEvent:"touch"===gPointArray[0].type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData}))&&$.cancelEvent(event),tracker.pinchHandler)&&"touch"===gPoints[0].type&&(delta=delegate.pinchGPoints[0].currentPos.distanceTo(delegate.pinchGPoints[1].currentPos))!=delegate.currentPinchDist&&(delegate.lastPinchDist=delegate.currentPinchDist,delegate.currentPinchDist=delta,delegate.lastPinchCenter=delegate.currentPinchCenter,delegate.currentPinchCenter=getCenterPoint(delegate.pinchGPoints[0].currentPos,delegate.pinchGPoints[1].currentPos),!1===tracker.pinchHandler({eventSource:tracker,pointerType:"touch",gesturePoints:delegate.pinchGPoints,lastCenter:getPointRelativeToAbsolute(delegate.lastPinchCenter,tracker.element),center:getPointRelativeToAbsolute(delegate.currentPinchCenter,tracker.element),lastDistance:delegate.lastPinchDist,distance:delegate.currentPinchDist,shift:event.shiftKey,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData}))&&$.cancelEvent(event)}$.MouseTracker=function(options){MOUSETRACKERS.push(this);var args=arguments,_this=($.isPlainObject(options)||(options={element:args[0],clickTimeThreshold:args[1],clickDistThreshold:args[2]}),this.hash=Math.random(),this.element=$.getElement(options.element),this.clickTimeThreshold=options.clickTimeThreshold||$.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=options.clickDistThreshold||$.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=options.dblClickTimeThreshold||$.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=options.dblClickDistThreshold||$.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=options.userData||null,this.stopDelay=options.stopDelay||50,this.enterHandler=options.enterHandler||null,this.exitHandler=options.exitHandler||null,this.pressHandler=options.pressHandler||null,this.nonPrimaryPressHandler=options.nonPrimaryPressHandler||null,this.releaseHandler=options.releaseHandler||null,this.nonPrimaryReleaseHandler=options.nonPrimaryReleaseHandler||null,this.moveHandler=options.moveHandler||null,this.scrollHandler=options.scrollHandler||null,this.clickHandler=options.clickHandler||null,this.dblClickHandler=options.dblClickHandler||null,this.dragHandler=options.dragHandler||null,this.dragEndHandler=options.dragEndHandler||null,this.pinchHandler=options.pinchHandler||null,this.stopHandler=options.stopHandler||null,this.keyDownHandler=options.keyDownHandler||null,this.keyUpHandler=options.keyUpHandler||null,this.keyHandler=options.keyHandler||null,this.focusHandler=options.focusHandler||null,this.blurHandler=options.blurHandler||null,this);THIS[this.hash]={click:function(event){!function(tracker,event){tracker.clickHandler&&$.cancelEvent(event)}(_this,event)},dblclick:function(event){!function(tracker,event){tracker.dblClickHandler&&$.cancelEvent(event)}(_this,event)},keydown:function(event){!function(tracker,event){!tracker.keyDownHandler||(event=$.getEvent(event),tracker.keyDownHandler({eventSource:tracker,keyCode:event.keyCode||event.charCode,ctrl:event.ctrlKey,shift:event.shiftKey,alt:event.altKey,meta:event.metaKey,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData}))||$.cancelEvent(event)}(_this,event)},keyup:function(event){!function(tracker,event){!tracker.keyUpHandler||(event=$.getEvent(event),tracker.keyUpHandler({eventSource:tracker,keyCode:event.keyCode||event.charCode,ctrl:event.ctrlKey,shift:event.shiftKey,alt:event.altKey,meta:event.metaKey,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData}))||$.cancelEvent(event)}(_this,event)},keypress:function(event){!function(tracker,event){!tracker.keyHandler||(event=$.getEvent(event),tracker.keyHandler({eventSource:tracker,keyCode:event.keyCode||event.charCode,ctrl:event.ctrlKey,shift:event.shiftKey,alt:event.altKey,meta:event.metaKey,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData}))||$.cancelEvent(event)}(_this,event)},focus:function(event){!function(tracker,event){tracker.focusHandler&&(event=$.getEvent(event),!1===tracker.focusHandler({eventSource:tracker,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData}))&&$.cancelEvent(event)}(_this,event)},blur:function(event){!function(tracker,event){tracker.blurHandler&&(event=$.getEvent(event),!1===tracker.blurHandler({eventSource:tracker,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData}))&&$.cancelEvent(event)}(_this,event)},wheel:function(event){!function(tracker,event){handleWheelEvent(tracker,event,event)}(_this,event)},mousewheel:function(event){onMouseWheel(_this,event)},DOMMouseScroll:function(event){onMouseWheel(_this,event)},MozMousePixelScroll:function(event){onMouseWheel(_this,event)},mouseenter:function(event){!function(tracker,event){event=$.getEvent(event),handleMouseEnter(tracker,event)}(_this,event)},mouseleave:function(event){!function(tracker,event){event=$.getEvent(event),handleMouseExit(tracker,event)}(_this,event)},mouseover:function(event){!function(tracker,event){(event=$.getEvent(event)).currentTarget===event.relatedTarget||isParentChild(event.currentTarget,event.relatedTarget)||handleMouseEnter(tracker,event)}(_this,event)},mouseout:function(event){!function(tracker,event){(event=$.getEvent(event)).currentTarget===event.relatedTarget||isParentChild(event.currentTarget,event.relatedTarget)||handleMouseExit(tracker,event)}(_this,event)},mousedown:function(event){!function(tracker,event){var gPoint;event=$.getEvent(event),gPoint={id:$.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:getMouseAbsolute(event),currentTime:$.now()},updatePointersDown(tracker,event,[gPoint],getStandardizedButton(event.button))&&($.stopEvent(event),capturePointer(tracker,"mouse"));(tracker.clickHandler||tracker.dblClickHandler||tracker.pressHandler||tracker.dragHandler||tracker.dragEndHandler)&&$.cancelEvent(event)}(_this,event)},mouseup:function(event){!function(tracker,event){handleMouseUp(tracker,event)}(_this,event)},mouseupcaptured:function(event){!function(tracker,event){handleMouseUp(tracker,event),$.stopEvent(event)}(_this,event)},mousemove:function(event){!function(tracker,event){handleMouseMove(tracker,event)}(_this,event)},mousemovecaptured:function(event){!function(tracker,event){handleMouseMove(tracker,event),$.stopEvent(event)}(_this,event)},touchstart:function(event){!function(tracker,event){var time,i,j,parentGPoints,touchCount=event.changedTouches.length,gPoints=[],pointsList=tracker.getActivePointersListByType("touch");time=$.now(),pointsList.getLength()>event.touches.length-touchCount&&($.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),abortContacts(tracker,event,pointsList));for(i=0;i<touchCount;i++)gPoints.push({id:event.changedTouches[i].identifier,type:"touch",currentPos:getMouseAbsolute(event.changedTouches[i]),currentTime:time});for(updatePointersEnter(tracker,event,gPoints),i=0;i<MOUSETRACKERS.length;i++)if(MOUSETRACKERS[i]!==tracker&&MOUSETRACKERS[i].isTracking()&&isParentChild(MOUSETRACKERS[i].element,tracker.element)){for(parentGPoints=[],j=0;j<touchCount;j++)parentGPoints.push({id:event.changedTouches[j].identifier,type:"touch",currentPos:getMouseAbsolute(event.changedTouches[j]),currentTime:time});updatePointersEnter(MOUSETRACKERS[i],event,parentGPoints)}updatePointersDown(tracker,event,gPoints,0)&&($.stopEvent(event),capturePointer(tracker,"touch",touchCount));$.cancelEvent(event)}(_this,event)},touchend:function(event){!function(tracker,event){handleTouchEnd(tracker,event)}(_this,event)},touchendcaptured:function(event){!function(tracker,event){handleTouchEnd(tracker,event),$.stopEvent(event)}(_this,event)},touchmove:function(event){!function(tracker,event){handleTouchMove(tracker,event)}(_this,event)},touchmovecaptured:function(event){!function(tracker,event){handleTouchMove(tracker,event),$.stopEvent(event)}(_this,event)},touchcancel:function(event){!function(tracker,event){var pointsList=tracker.getActivePointersListByType("touch");abortContacts(tracker,event,pointsList)}(_this,event)},gesturestart:function(event){!function(event){event.stopPropagation(),event.preventDefault()}(event)},gesturechange:function(event){!function(event){event.stopPropagation(),event.preventDefault()}(event)},pointerover:function(event){onPointerOver(_this,event)},MSPointerOver:function(event){onPointerOver(_this,event)},pointerout:function(event){onPointerOut(_this,event)},MSPointerOut:function(event){onPointerOut(_this,event)},pointerdown:function(event){onPointerDown(_this,event)},MSPointerDown:function(event){onPointerDown(_this,event)},pointerup:function(event){onPointerUp(_this,event)},MSPointerUp:function(event){onPointerUp(_this,event)},pointermove:function(event){onPointerMove(_this,event)},MSPointerMove:function(event){onPointerMove(_this,event)},pointercancel:function(event){onPointerCancel(_this,event)},MSPointerCancel:function(event){onPointerCancel(_this,event)},pointerupcaptured:function(event){!function(tracker,event){tracker.getActivePointersListByType(getPointerType(event)).getById(event.pointerId)&&handlePointerUp(tracker,event);$.stopEvent(event)}(_this,event)},pointermovecaptured:function(event){!function(tracker,event){tracker.getActivePointersListByType(getPointerType(event)).getById(event.pointerId)&&handlePointerMove(tracker,event);$.stopEvent(event)}(_this,event)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},options.startDisabled||this.setTracking(!0)},$.MouseTracker.prototype={destroy:function(){var i;for(stopTracking(this),this.element=null,i=0;i<MOUSETRACKERS.length;i++)if(MOUSETRACKERS[i]===this){MOUSETRACKERS.splice(i,1);break}THIS[this.hash]=null,delete THIS[this.hash]},isTracking:function(){return THIS[this.hash].tracking},setTracking:function(track){if(track){var event,i,tracker=this,delegate=THIS[tracker.hash];if(!delegate.tracking){for(i=0;i<$.MouseTracker.subscribeEvents.length;i++)event=$.MouseTracker.subscribeEvents[i],$.addEvent(tracker.element,event,delegate[event],!1);clearTrackedPointers(tracker),delegate.tracking=!0}}else stopTracking(this);return this},getActivePointersListsExceptType:function(type){for(var delegate=THIS[this.hash],listArray=[],i=0;i<delegate.activePointersLists.length;++i)delegate.activePointersLists[i].type!==type&&listArray.push(delegate.activePointersLists[i]);return listArray},getActivePointersListByType:function(type){for(var list,delegate=THIS[this.hash],len=delegate.activePointersLists.length,i=0;i<len;i++)if(delegate.activePointersLists[i].type===type)return delegate.activePointersLists[i];return list=new $.MouseTracker.GesturePointList(type),delegate.activePointersLists.push(list),list},getActivePointerCount:function(){for(var delegate=THIS[this.hash],len=delegate.activePointersLists.length,count=0,i=0;i<len;i++)count+=delegate.activePointersLists[i].getLength();return count},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},$.MouseTracker.resetAllMouseTrackers=function(){for(var i=0;i<MOUSETRACKERS.length;i++)MOUSETRACKERS[i].isTracking()&&(MOUSETRACKERS[i].setTracking(!1),MOUSETRACKERS[i].setTracking(!0))},$.MouseTracker.gesturePointVelocityTracker=(trackerPoints=[],lastTime=intervalId=0,{addPoint:function(tracker,gPoint){tracker=_generateGuid(tracker,gPoint);trackerPoints.push({guid:tracker,gPoint:gPoint,lastPos:gPoint.currentPos}),1===trackerPoints.length&&(lastTime=$.now(),intervalId=window.setInterval(_doTracking,50))},removePoint:function(tracker,gPoint){for(var guid=_generateGuid(tracker,gPoint),len=trackerPoints.length,i=0;i<len;i++)if(trackerPoints[i].guid===guid){trackerPoints.splice(i,1),0===--len&&window.clearInterval(intervalId);break}}}),$.MouseTracker.captureElement=document,$.MouseTracker.wheelEventName=$.Browser.vendor==$.BROWSERS.IE&&8<$.Browser.version||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",$.MouseTracker.supportsMouseCapture=(divElement=document.createElement("div"),$.isFunction(divElement.setCapture)&&$.isFunction(divElement.releaseCapture)),$.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",$.MouseTracker.wheelEventName],"DOMMouseScroll"==$.MouseTracker.wheelEventName&&$.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||$.Browser.vendor!==$.BROWSERS.IE)?($.MouseTracker.havePointerEvents=!0,$.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),$.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?$.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:$.MouseTracker.maxTouchPoints=0,$.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?($.MouseTracker.havePointerEvents=!0,$.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),$.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?$.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:$.MouseTracker.maxTouchPoints=0,$.MouseTracker.haveMouseEnter=!1):($.MouseTracker.havePointerEvents=!1,$.Browser.vendor===$.BROWSERS.IE&&$.Browser.version<9?($.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),$.MouseTracker.haveMouseEnter=!0):($.MouseTracker.subscribeEvents.push("mouseover","mouseout"),$.MouseTracker.haveMouseEnter=!1),$.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&$.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&$.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),$.MouseTracker.mousePointerId="legacy-mouse",$.MouseTracker.maxTouchPoints=10),$.MouseTracker.GesturePointList=function(type){this._gPoints=[],this.type=type,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},$.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(gp){return this._gPoints.push(gp)},removeById:function(id){for(var len=this._gPoints.length,i=0;i<len;i++)if(this._gPoints[i].id===id){this._gPoints.splice(i,1);break}return this._gPoints.length},getByIndex:function(index){return index<this._gPoints.length?this._gPoints[index]:null},getById:function(id){for(var len=this._gPoints.length,i=0;i<len;i++)if(this._gPoints[i].id===id)return this._gPoints[i];return null},getPrimary:function(id){for(var len=this._gPoints.length,i=0;i<len;i++)if(this._gPoints[i].isPrimary)return this._gPoints[i];return null},addContact:function(){++this.contacts,1<this.contacts&&("mouse"===this.type||"pen"===this.type)&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};var isInIframe=function(){try{return window.self!==window.top}catch(e){return!0}}();function canAccessEvents(target){try{return target.addEventListener&&target.removeEventListener}catch(e){}}}(OpenSeadragon),!function($){$.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},$.Control=function(element,options,container){var parent=element.parentNode;"number"==typeof options&&($.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),options={anchor:options}),options.attachToViewer=void 0===options.attachToViewer||options.attachToViewer,this.autoFade=void 0===options.autoFade||options.autoFade,this.element=element,this.anchor=options.anchor,this.container=container,this.anchor==$.ControlAnchor.ABSOLUTE?(this.wrapper=$.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof options.top?options.top+"px":options.top,this.wrapper.style.left="number"==typeof options.left?options.left+"px":options.left,this.wrapper.style.height="number"==typeof options.height?options.height+"px":options.height,this.wrapper.style.width="number"==typeof options.width?options.width+"px":options.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=$.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==$.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),options.attachToViewer?this.anchor==$.ControlAnchor.TOP_RIGHT||this.anchor==$.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):parent.appendChild(this.wrapper)},$.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(visible){this.wrapper.style.display=visible?this.anchor==$.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(opacity){this.element[$.SIGNAL]&&$.Browser.vendor==$.BROWSERS.IE?$.setElementOpacity(this.element,opacity,!0):$.setElementOpacity(this.wrapper,opacity,!0)}}}(OpenSeadragon),!function($){function getControlIndex(dock,element){for(var controls=dock.controls,i=controls.length-1;0<=i;i--)if(controls[i].element==element)return i;return-1}$.ControlDock=function(options){var layout,i,layouts=["topleft","topright","bottomright","bottomleft"];for($.extend(!0,this,{id:"controldock-"+$.now()+"-"+Math.floor(1e6*Math.random()),container:$.makeNeutralElement("div"),controls:[]},options),this.container.onsubmit=function(){return!1},this.element&&(this.element=$.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),i=0;i<layouts.length;i++)this.controls[layout=layouts[i]]=$.makeNeutralElement("div"),this.controls[layout].style.position="absolute",layout.match("left")&&(this.controls[layout].style.left="0px"),layout.match("right")&&(this.controls[layout].style.right="0px"),layout.match("top")&&(this.controls[layout].style.top="0px"),layout.match("bottom")&&(this.controls[layout].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},$.ControlDock.prototype={addControl:function(element,controlOptions){element=$.getElement(element);var div=null;if(!(0<=getControlIndex(this,element))){switch(controlOptions.anchor){case $.ControlAnchor.TOP_RIGHT:div=this.controls.topright,element.style.position="relative",element.style.paddingRight="0px",element.style.paddingTop="0px";break;case $.ControlAnchor.BOTTOM_RIGHT:div=this.controls.bottomright,element.style.position="relative",element.style.paddingRight="0px",element.style.paddingBottom="0px";break;case $.ControlAnchor.BOTTOM_LEFT:div=this.controls.bottomleft,element.style.position="relative",element.style.paddingLeft="0px",element.style.paddingBottom="0px";break;case $.ControlAnchor.TOP_LEFT:div=this.controls.topleft,element.style.position="relative",element.style.paddingLeft="0px",element.style.paddingTop="0px";break;case $.ControlAnchor.ABSOLUTE:div=this.container,element.style.margin="0px",element.style.padding="0px";break;default:case $.ControlAnchor.NONE:div=this.container,element.style.margin="0px",element.style.padding="0px"}this.controls.push(new $.Control(element,controlOptions,div)),element.style.display="inline-block"}},removeControl:function(element){element=getControlIndex(this,element=$.getElement(element));return 0<=element&&(this.controls[element].destroy(),this.controls.splice(element,1)),this},clearControls:function(){for(;0<this.controls.length;)this.controls.pop().destroy();return this},areControlsEnabled:function(){for(var i=this.controls.length-1;0<=i;i--)if(this.controls[i].isVisible())return!0;return!1},setControlsEnabled:function(enabled){for(var i=this.controls.length-1;0<=i;i--)this.controls[i].setVisible(enabled);return this}}}(OpenSeadragon),!function($){$.Placement=$.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),!function($){var THIS={},nextHash=1;function _getSafeElemSize(oElement){return oElement=$.getElement(oElement),new $.Point(0===oElement.clientWidth?1:oElement.clientWidth,0===oElement.clientHeight?1:oElement.clientHeight)}function getOverlayObject(viewer,overlay){var element,id,x,y,width,height;return overlay instanceof $.Overlay?overlay:(element=null,overlay.element?element=$.getElement(overlay.element):(id=overlay.id||"openseadragon-overlay-"+Math.floor(1e7*Math.random()),(element=$.getElement(overlay.id))||((element=document.createElement("a")).href="#/overlay/"+id),element.id=id,$.addClass(element,overlay.className||"openseadragon-overlay")),id=overlay.location,width=overlay.width,height=overlay.height,id||(x=overlay.x,y=overlay.y,void 0!==overlay.px&&(x=(viewer=viewer.viewport.imageToViewportRectangle(new $.Rect(overlay.px,overlay.py,width||0,height||0))).x,y=viewer.y,width=void 0!==width?viewer.width:void 0,height=void 0!==height?viewer.height:void 0),id=new $.Point(x,y)),(viewer=overlay.placement)&&"string"===$.type(viewer)&&(viewer=$.Placement[overlay.placement.toUpperCase()]),new $.Overlay({element:element,location:id,placement:viewer,onDraw:overlay.onDraw,checkResize:overlay.checkResize,width:width,height:height,rotationMode:overlay.rotationMode}))}function getOverlayIndex(overlays,element){for(var i=overlays.length-1;0<=i;i--)if(overlays[i].element===element)return i;return-1}function scheduleUpdate(viewer,updateFunc){return $.requestAnimationFrame(function(){updateFunc(viewer)})}function scheduleControlsFade(viewer){$.requestAnimationFrame(function(){!function(viewer){var currentTime,opacity,i;if(viewer.controlsShouldFade){for(currentTime=$.now(),currentTime=currentTime-viewer.controlsFadeBeginTime,opacity=1-currentTime/viewer.controlsFadeLength,opacity=Math.min(1,opacity),opacity=Math.max(0,opacity),i=viewer.controls.length-1;0<=i;i--)viewer.controls[i].autoFade&&viewer.controls[i].setOpacity(opacity);0<opacity&&scheduleControlsFade(viewer)}}(viewer)})}function beginControlsAutoHide(viewer){viewer.autoHideControls&&(viewer.controlsShouldFade=!0,viewer.controlsFadeBeginTime=$.now()+viewer.controlsFadeDelay,window.setTimeout(function(){scheduleControlsFade(viewer)},viewer.controlsFadeDelay))}function abortControlsAutoHide(viewer){var i;for(viewer.controlsShouldFade=!1,i=viewer.controls.length-1;0<=i;i--)viewer.controls[i].setOpacity(1)}function onFocus(){abortControlsAutoHide(this)}function onBlur(){beginControlsAutoHide(this)}function onCanvasKeyDown(event){var canvasKeyDownEventArgs={originalEvent:event.originalEvent,preventDefaultAction:event.preventDefaultAction,preventVerticalPan:event.preventVerticalPan,preventHorizontalPan:event.preventHorizontalPan};if(this.raiseEvent("canvas-key",canvasKeyDownEventArgs),canvasKeyDownEventArgs.preventDefaultAction||event.ctrl||event.alt||event.meta)return!0;switch(event.keyCode){case 38:return canvasKeyDownEventArgs.preventVerticalPan||(event.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return canvasKeyDownEventArgs.preventVerticalPan||(event.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return canvasKeyDownEventArgs.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return canvasKeyDownEventArgs.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}}function onCanvasKeyPress(event){var canvasKeyPressEventArgs={originalEvent:event.originalEvent,preventDefaultAction:event.preventDefaultAction,preventVerticalPan:event.preventVerticalPan,preventHorizontalPan:event.preventHorizontalPan};if(this.raiseEvent("canvas-key",canvasKeyPressEventArgs),canvasKeyPressEventArgs.preventDefaultAction||event.ctrl||event.alt||event.meta)return!0;switch(event.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return canvasKeyPressEventArgs.preventVerticalPan||(event.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return canvasKeyPressEventArgs.preventVerticalPan||(event.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return canvasKeyPressEventArgs.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return canvasKeyPressEventArgs.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation($.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation($.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation($.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation($.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}}function onCanvasClick(event){document.activeElement!=this.canvas&&this.canvas.focus(),this.viewport.flipped&&(event.position.x=this.viewport.getContainerSize().x-event.position.x);var canvasClickEventArgs={tracker:event.eventSource,position:event.position,quick:event.quick,shift:event.shift,originalEvent:event.originalEvent,preventDefaultAction:event.preventDefaultAction};this.raiseEvent("canvas-click",canvasClickEventArgs),!canvasClickEventArgs.preventDefaultAction&&this.viewport&&event.quick&&(canvasClickEventArgs=this.gestureSettingsByDeviceType(event.pointerType)).clickToZoom&&(this.viewport.zoomBy(event.shift?1/this.zoomPerClick:this.zoomPerClick,canvasClickEventArgs.zoomToRefPoint?this.viewport.pointFromPixel(event.position,!0):null),this.viewport.applyConstraints())}function onCanvasDblClick(event){var canvasDblClickEventArgs={tracker:event.eventSource,position:event.position,shift:event.shift,originalEvent:event.originalEvent,preventDefaultAction:event.preventDefaultAction};this.raiseEvent("canvas-double-click",canvasDblClickEventArgs),!canvasDblClickEventArgs.preventDefaultAction&&this.viewport&&(canvasDblClickEventArgs=this.gestureSettingsByDeviceType(event.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(event.shift?1/this.zoomPerClick:this.zoomPerClick,canvasDblClickEventArgs.zoomToRefPoint?this.viewport.pointFromPixel(event.position,!0):null),this.viewport.applyConstraints())}function onCanvasDrag(event){var delta,bounds,constrainedBounds,canvasDragEventArgs={tracker:event.eventSource,position:event.position,delta:event.delta,speed:event.speed,direction:event.direction,shift:event.shift,originalEvent:event.originalEvent,preventDefaultAction:event.preventDefaultAction};this.raiseEvent("canvas-drag",canvasDragEventArgs),!canvasDragEventArgs.preventDefaultAction&&this.viewport&&(canvasDragEventArgs=this.gestureSettingsByDeviceType(event.pointerType),this.panHorizontal||(event.delta.x=0),this.panVertical||(event.delta.y=0),this.viewport.flipped&&(event.delta.x=-event.delta.x),this.constrainDuringPan&&(delta=this.viewport.deltaPointsFromPixels(event.delta.negate()),this.viewport.centerSpringX.target.value+=delta.x,this.viewport.centerSpringY.target.value+=delta.y,bounds=this.viewport.getBounds(),constrainedBounds=this.viewport.getConstrainedBounds(),this.viewport.centerSpringX.target.value-=delta.x,this.viewport.centerSpringY.target.value-=delta.y,bounds.x!=constrainedBounds.x&&(event.delta.x=0),bounds.y!=constrainedBounds.y)&&(event.delta.y=0),this.viewport.panBy(this.viewport.deltaPointsFromPixels(event.delta.negate()),canvasDragEventArgs.flickEnabled&&!this.constrainDuringPan))}function onCanvasDragEnd(event){var amplitudeY,gestureSettings,amplitudeX;!event.preventDefaultAction&&this.viewport&&((gestureSettings=this.gestureSettingsByDeviceType(event.pointerType)).flickEnabled&&event.speed>=gestureSettings.flickMinSpeed&&(amplitudeX=0,this.panHorizontal&&(amplitudeX=gestureSettings.flickMomentum*event.speed*Math.cos(event.direction)),amplitudeY=0,this.panVertical&&(amplitudeY=gestureSettings.flickMomentum*event.speed*Math.sin(event.direction)),gestureSettings=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),amplitudeX=this.viewport.pointFromPixel(new $.Point(gestureSettings.x-amplitudeX,gestureSettings.y-amplitudeY)),this.viewport.panTo(amplitudeX,!1)),this.viewport.applyConstraints()),this.raiseEvent("canvas-drag-end",{tracker:event.eventSource,position:event.position,speed:event.speed,direction:event.direction,shift:event.shift,originalEvent:event.originalEvent})}function onCanvasEnter(event){this.raiseEvent("canvas-enter",{tracker:event.eventSource,pointerType:event.pointerType,position:event.position,buttons:event.buttons,pointers:event.pointers,insideElementPressed:event.insideElementPressed,buttonDownAny:event.buttonDownAny,originalEvent:event.originalEvent})}function onCanvasExit(event){window.location!=window.parent.location&&$.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:event.eventSource,pointerType:event.pointerType,position:event.position,buttons:event.buttons,pointers:event.pointers,insideElementPressed:event.insideElementPressed,buttonDownAny:event.buttonDownAny,originalEvent:event.originalEvent})}function onCanvasPress(event){this.raiseEvent("canvas-press",{tracker:event.eventSource,pointerType:event.pointerType,position:event.position,insideElementPressed:event.insideElementPressed,insideElementReleased:event.insideElementReleased,originalEvent:event.originalEvent})}function onCanvasRelease(event){this.raiseEvent("canvas-release",{tracker:event.eventSource,pointerType:event.pointerType,position:event.position,insideElementPressed:event.insideElementPressed,insideElementReleased:event.insideElementReleased,originalEvent:event.originalEvent})}function onCanvasNonPrimaryPress(event){this.raiseEvent("canvas-nonprimary-press",{tracker:event.eventSource,position:event.position,pointerType:event.pointerType,button:event.button,buttons:event.buttons,originalEvent:event.originalEvent})}function onCanvasNonPrimaryRelease(event){this.raiseEvent("canvas-nonprimary-release",{tracker:event.eventSource,position:event.position,pointerType:event.pointerType,button:event.button,buttons:event.buttons,originalEvent:event.originalEvent})}function onCanvasPinch(event){var centerPt,panByPt,gestureSettings;return!event.preventDefaultAction&&this.viewport&&((gestureSettings=this.gestureSettingsByDeviceType(event.pointerType)).pinchToZoom&&(centerPt=this.viewport.pointFromPixel(event.center,!0),panByPt=this.viewport.pointFromPixel(event.lastCenter,!0).minus(centerPt),this.panHorizontal||(panByPt.x=0),this.panVertical||(panByPt.y=0),this.viewport.zoomBy(event.distance/event.lastDistance,centerPt,!0),gestureSettings.zoomToRefPoint&&this.viewport.panBy(panByPt,!0),this.viewport.applyConstraints()),gestureSettings.pinchRotate)&&(centerPt=Math.atan2(event.gesturePoints[0].currentPos.y-event.gesturePoints[1].currentPos.y,event.gesturePoints[0].currentPos.x-event.gesturePoints[1].currentPos.x),panByPt=Math.atan2(event.gesturePoints[0].lastPos.y-event.gesturePoints[1].lastPos.y,event.gesturePoints[0].lastPos.x-event.gesturePoints[1].lastPos.x),this.viewport.setRotation(this.viewport.getRotation()+(centerPt-panByPt)*(180/Math.PI))),this.raiseEvent("canvas-pinch",{tracker:event.eventSource,gesturePoints:event.gesturePoints,lastCenter:event.lastCenter,center:event.center,lastDistance:event.lastDistance,distance:event.distance,shift:event.shift,originalEvent:event.originalEvent}),!1}function onCanvasScroll(event){var gestureSettings,thisScrollTime=$.now();if(thisScrollTime-this._lastScrollTime>this.minScrollDeltaTime){if(this._lastScrollTime=thisScrollTime,this.viewport.flipped&&(event.position.x=this.viewport.getContainerSize().x-event.position.x),!event.preventDefaultAction&&this.viewport&&(gestureSettings=this.gestureSettingsByDeviceType(event.pointerType)).scrollToZoom&&(thisScrollTime=Math.pow(this.zoomPerScroll,event.scroll),this.viewport.zoomBy(thisScrollTime,gestureSettings.zoomToRefPoint?this.viewport.pointFromPixel(event.position,!0):null),this.viewport.applyConstraints()),this.raiseEvent("canvas-scroll",{tracker:event.eventSource,position:event.position,scroll:event.scroll,shift:event.shift,originalEvent:event.originalEvent}),gestureSettings&&gestureSettings.scrollToZoom)return!1}else if((gestureSettings=this.gestureSettingsByDeviceType(event.pointerType))&&gestureSettings.scrollToZoom)return!1}function onContainerEnter(event){THIS[this.hash].mouseInside=!0,abortControlsAutoHide(this),this.raiseEvent("container-enter",{tracker:event.eventSource,position:event.position,buttons:event.buttons,pointers:event.pointers,insideElementPressed:event.insideElementPressed,buttonDownAny:event.buttonDownAny,originalEvent:event.originalEvent})}function onContainerExit(event){event.pointers<1&&(THIS[this.hash].mouseInside=!1,THIS[this.hash].animating||beginControlsAutoHide(this)),this.raiseEvent("container-exit",{tracker:event.eventSource,position:event.position,buttons:event.buttons,pointers:event.pointers,insideElementPressed:event.insideElementPressed,buttonDownAny:event.buttonDownAny,originalEvent:event.originalEvent})}function updateMulti(viewer){!function(viewer){var containerSize,prevContainerSize,center,viewport;viewer._opening||(viewer.autoResize&&(containerSize=_getSafeElemSize(viewer.container),prevContainerSize=THIS[viewer.hash].prevContainerSize,containerSize.equals(prevContainerSize)||(viewport=viewer.viewport,viewer.preserveImageSizeOnResize?(prevContainerSize=prevContainerSize.x/containerSize.x,prevContainerSize=viewport.getZoom()*prevContainerSize,center=viewport.getCenter(),viewport.resize(containerSize,!1),viewport.zoomTo(prevContainerSize,null,!0),viewport.panTo(center,!0)):(prevContainerSize=viewport.getBounds(),viewport.resize(containerSize,!0),viewport.fitBoundsWithConstraints(prevContainerSize,!0)),THIS[viewer.hash].prevContainerSize=containerSize,THIS[viewer.hash].forceRedraw=!0)),center=viewer.viewport.update(),viewport=viewer.world.update()||center,center&&viewer.raiseEvent("viewport-change"),viewer.referenceStrip&&(viewport=viewer.referenceStrip.update(viewer.viewport)||viewport),!THIS[viewer.hash].animating&&viewport&&(viewer.raiseEvent("animation-start"),abortControlsAutoHide(viewer)),(viewport||THIS[viewer.hash].forceRedraw||viewer.world.needsDraw())&&(function(viewer){viewer.imageLoader.clear(),viewer.drawer.clear(),viewer.world.draw(),viewer.raiseEvent("update-viewport",{})}(viewer),viewer._drawOverlays(),viewer.navigator&&viewer.navigator.update(viewer.viewport),THIS[viewer.hash].forceRedraw=!1,viewport)&&viewer.raiseEvent("animation"),THIS[viewer.hash].animating&&!viewport&&(viewer.raiseEvent("animation-finish"),THIS[viewer.hash].mouseInside||beginControlsAutoHide(viewer)),THIS[viewer.hash].animating=viewport)}(viewer),viewer.isOpen()?viewer._updateRequestId=scheduleUpdate(viewer,updateMulti):viewer._updateRequestId=!1}function resolveUrl(prefix,url){return prefix?prefix+url:url}function beginZoomingIn(){THIS[this.hash].lastZoomTime=$.now(),THIS[this.hash].zoomFactor=this.zoomPerSecond,THIS[this.hash].zooming=!0,scheduleZoom(this)}function beginZoomingOut(){THIS[this.hash].lastZoomTime=$.now(),THIS[this.hash].zoomFactor=1/this.zoomPerSecond,THIS[this.hash].zooming=!0,scheduleZoom(this)}function endZooming(){THIS[this.hash].zooming=!1}function scheduleZoom(viewer){$.requestAnimationFrame($.delegate(viewer,doZoom))}function doZoom(){var currentTime,deltaTime;THIS[this.hash].zooming&&this.viewport&&(deltaTime=(currentTime=$.now())-THIS[this.hash].lastZoomTime,deltaTime=Math.pow(THIS[this.hash].zoomFactor,deltaTime/1e3),this.viewport.zoomBy(deltaTime),this.viewport.applyConstraints(),THIS[this.hash].lastZoomTime=currentTime,scheduleZoom(this))}function doSingleZoomIn(){this.viewport&&(THIS[this.hash].zooming=!1,this.viewport.zoomBy(+this.zoomPerClick),this.viewport.applyConstraints())}function doSingleZoomOut(){this.viewport&&(THIS[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function lightUp(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function onHome(){this.viewport&&this.viewport.goHome()}function onFullScreen(){this.isFullPage()&&!$.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function onRotateLeft(){var currRotation;this.viewport&&(currRotation=this.viewport.getRotation(),currRotation=this.viewport.flipped?$.positiveModulo(currRotation+this.rotationIncrement,360):$.positiveModulo(currRotation-this.rotationIncrement,360),this.viewport.setRotation(currRotation))}function onRotateRight(){var currRotation;this.viewport&&(currRotation=this.viewport.getRotation(),currRotation=this.viewport.flipped?$.positiveModulo(currRotation-this.rotationIncrement,360):$.positiveModulo(currRotation+this.rotationIncrement,360),this.viewport.setRotation(currRotation))}function onFlip(){this.viewport.toggleFlip()}function onPrevious(){var previous=this._sequenceIndex-1;this.navPrevNextWrap&&previous<0&&(previous+=this.tileSources.length),this.goToPage(previous)}function onNext(){var next=this._sequenceIndex+1;this.navPrevNextWrap&&next>=this.tileSources.length&&(next=0),this.goToPage(next)}$.Viewer=function(options){var i,args=arguments,_this=this;if((options=$.isPlainObject(options)?options:{id:args[0],xmlPath:1<args.length?args[1]:void 0,prefixUrl:2<args.length?args[2]:void 0,controls:3<args.length?args[3]:void 0,overlays:4<args.length?args[4]:void 0}).config&&($.extend(!0,options,options.config),delete options.config),$.extend(!0,this,{id:options.id,hash:options.hash||nextHash++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},$.DEFAULT_SETTINGS,options),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==THIS[this.hash]&&$.console.warn("Hash "+this.hash+" has already been used."),THIS[this.hash]={fsBoundsDelta:new $.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=$.now(),$.EventSource.call(this),this.addHandler("open-failed",function(event){event=$.getString("Errors.OpenFailed",event.eventSource,event.message);_this._showMessage(event)}),$.ControlDock.call(this,options),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=$.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",(args=this.canvas.style).width="100%",args.height="100%",args.overflow="hidden",args.position="absolute",args.top="0px",args.left="0px",$.setElementTouchActionNone(this.canvas),""!==options.tabIndex&&(this.canvas.tabIndex=void 0===options.tabIndex?0:options.tabIndex),this.container.className="openseadragon-container",!function(style){style.width="100%",style.height="100%",style.position="relative",style.overflow="hidden",style.left="0px",style.top="0px",style.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new $.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:$.delegate(this,onCanvasKeyDown),keyHandler:$.delegate(this,onCanvasKeyPress),clickHandler:$.delegate(this,onCanvasClick),dblClickHandler:$.delegate(this,onCanvasDblClick),dragHandler:$.delegate(this,onCanvasDrag),dragEndHandler:$.delegate(this,onCanvasDragEnd),enterHandler:$.delegate(this,onCanvasEnter),exitHandler:$.delegate(this,onCanvasExit),pressHandler:$.delegate(this,onCanvasPress),releaseHandler:$.delegate(this,onCanvasRelease),nonPrimaryPressHandler:$.delegate(this,onCanvasNonPrimaryPress),nonPrimaryReleaseHandler:$.delegate(this,onCanvasNonPrimaryRelease),scrollHandler:$.delegate(this,onCanvasScroll),pinchHandler:$.delegate(this,onCanvasPinch)}),this.outerTracker=new $.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:$.delegate(this,onContainerEnter),exitHandler:$.delegate(this,onContainerExit)}),this.toolbar&&(this.toolbar=new $.ControlDock({element:this.toolbar})),this.bindStandardControls(),THIS[this.hash].prevContainerSize=_getSafeElemSize(this.container),this.world=new $.World({viewer:this}),this.world.addHandler("add-item",function(event){_this.source=_this.world.getItemAt(0).source,THIS[_this.hash].forceRedraw=!0,_this._updateRequestId||(_this._updateRequestId=scheduleUpdate(_this,updateMulti))}),this.world.addHandler("remove-item",function(event){_this.world.getItemCount()?_this.source=_this.world.getItemAt(0).source:_this.source=null,THIS[_this.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(event){_this.viewport&&_this.viewport._setContentBounds(_this.world.getHomeBounds(),_this.world.getContentFactor())}),this.world.addHandler("item-index-change",function(event){_this.source=_this.world.getItemAt(0).source}),this.viewport=new $.Viewport({containerSize:THIS[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new $.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:options.timeout}),this.tileCache=new $.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new $.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=$.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(i=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(i,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(i=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(i,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new $.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),i=0;i<this.customControls.length;i++)this.addControl(this.customControls[i].id,{anchor:this.customControls[i].anchor});$.requestAnimationFrame(function(){beginControlsAutoHide(_this)}),void 0===this.imageSmoothingEnabled||this.imageSmoothingEnabled||this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},$.extend($.Viewer.prototype,$.EventSource.prototype,$.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(dzi){return $.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(dzi)},openTileSource:function(tileSource){return $.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(tileSource)},open:function(tileSources,initialPage){var _this=this;if(this.close(),tileSources)if(this.sequenceMode&&$.isArray(tileSources))this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===initialPage||isNaN(initialPage)||(this.initialPage=initialPage),this.tileSources=tileSources,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip)&&this.addReferenceStrip(),this._updateSequenceButtons(this._sequenceIndex);else if((tileSources=$.isArray(tileSources)?tileSources:[tileSources]).length){this._opening=!0;for(var failEvent,expected=tileSources.length,successes=0,failures=0,checkCompletion=function(){if(successes+failures===expected)if(successes){!_this._firstOpen&&_this.preserveViewport||(_this.viewport.goHome(!0),_this.viewport.update()),_this._firstOpen=!1;var source=tileSources[0];if(source.tileSource&&(source=source.tileSource),_this.overlays&&!_this.preserveOverlays)for(var i=0;i<_this.overlays.length;i++)_this.currentOverlays[i]=getOverlayObject(_this,_this.overlays[i]);_this._drawOverlays(),_this._opening=!1,_this.raiseEvent("open",{source:source})}else _this._opening=!1,_this.raiseEvent("open-failed",failEvent)},i=0;i<tileSources.length;i++)!function(options){void 0!==(options=$.isPlainObject(options)&&options.tileSource?options:{tileSource:options}).index&&($.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete options.index),void 0===options.collectionImmediately&&(options.collectionImmediately=!0);var originalSuccess=options.success,originalError=(options.success=function(event){if(successes++,options.tileSource.overlays)for(var i=0;i<options.tileSource.overlays.length;i++)_this.addOverlay(options.tileSource.overlays[i]);originalSuccess&&originalSuccess(event),checkCompletion()},options.error);options.error=function(event){failures++,failEvent=failEvent||event,originalError&&originalError(event),checkCompletion()},_this.addTiledImage(options)}(tileSources[i]);return this}},close:function(){return THIS[this.hash]&&(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),THIS[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close")),this},destroy:function(){if(THIS[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&($.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),THIS[this.hash]=null,delete THIS[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(enabled){return this.innerTracker.setTracking(enabled),this.outerTracker.setTracking(enabled),this.raiseEvent("mouse-enabled",{enabled:enabled}),this},areControlsEnabled:function(){for(var enabled=this.controls.length,i=0;i<this.controls.length;i++)enabled=enabled&&this.controls[i].isVisible();return enabled},setControlsEnabled:function(enabled){return(enabled?abortControlsAutoHide:beginControlsAutoHide)(this),this.raiseEvent("controls-enabled",{enabled:enabled}),this},setDebugMode:function(debugMode){for(var i=0;i<this.world.getItemCount();i++)this.world.getItemAt(i).debugMode=debugMode;this.debugMode=debugMode,this.forceRedraw()},isFullPage:function(){return THIS[this.hash].fullPage},setFullPage:function(fullPage){var nodes,i,body=document.body,bodyStyle=body.style,docStyle=document.documentElement.style,_this=this;if(fullPage!=this.isFullPage()){var fullPageEventArgs={fullPage:fullPage,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",fullPageEventArgs),!fullPageEventArgs.preventDefaultAction){if(fullPage){for(this.elementSize=$.getElementSize(this.element),this.pageScroll=$.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=bodyStyle.margin,this.docMargin=docStyle.margin,bodyStyle.margin="0",docStyle.margin="0",this.bodyPadding=bodyStyle.padding,this.docPadding=docStyle.padding,bodyStyle.padding="0",docStyle.padding="0",this.bodyWidth=bodyStyle.width,this.docWidth=docStyle.width,bodyStyle.width="100%",docStyle.width="100%",this.bodyHeight=bodyStyle.height,this.docHeight=docStyle.height,bodyStyle.height="100%",docStyle.height="100%",this.previousBody=[],THIS[this.hash].prevElementParent=this.element.parentNode,THIS[this.hash].prevNextSibling=this.element.nextSibling,THIS[this.hash].prevElementWidth=this.element.style.width,THIS[this.hash].prevElementHeight=this.element.style.height,nodes=body.childNodes.length,i=0;i<nodes;i++)this.previousBody.push(body.childNodes[0]),body.removeChild(body.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,body.appendChild(this.toolbar.element),$.addClass(this.toolbar.element,"fullpage")),$.addClass(this.element,"fullpage"),body.appendChild(this.element),this.element.style.height=$.getWindowSize().y+"px",this.element.style.width=$.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=$.getElementSize(this.element).y-$.getElementSize(this.toolbar.element).y+"px"),THIS[this.hash].fullPage=!0,$.delegate(this,onContainerEnter)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,bodyStyle.margin=this.bodyMargin,docStyle.margin=this.docMargin,bodyStyle.padding=this.bodyPadding,docStyle.padding=this.docPadding,bodyStyle.width=this.bodyWidth,docStyle.width=this.docWidth,bodyStyle.height=this.bodyHeight,docStyle.height=this.docHeight,body.removeChild(this.element),nodes=this.previousBody.length,i=0;i<nodes;i++)body.appendChild(this.previousBody.shift());$.removeClass(this.element,"fullpage"),THIS[this.hash].prevElementParent.insertBefore(this.element,THIS[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(body.removeChild(this.toolbar.element),$.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=THIS[this.hash].prevElementWidth,this.element.style.height=THIS[this.hash].prevElementHeight;var restoreScrollCounter=0,restoreScroll=function(){$.setPageScroll(_this.pageScroll);var pageScroll=$.getPageScroll();++restoreScrollCounter<10&&(pageScroll.x!==_this.pageScroll.x||pageScroll.y!==_this.pageScroll.y)&&$.requestAnimationFrame(restoreScroll)};$.requestAnimationFrame(restoreScroll),THIS[this.hash].fullPage=!1,$.delegate(this,onContainerExit)({})}this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:fullPage})}}return this},setFullScreen:function(fullScreen){var _this=this;if(!$.supportsFullScreen)return this.setFullPage(fullScreen);if($.isFullScreen()!==fullScreen){var fullScreeEventArgs={fullScreen:fullScreen,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",fullScreeEventArgs),!fullScreeEventArgs.preventDefaultAction)if(fullScreen){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var onFullScreenChange=function(){var isFullScreen=$.isFullScreen();isFullScreen||($.removeEvent(document,$.fullScreenEventName,onFullScreenChange),$.removeEvent(document,$.fullScreenErrorEventName,onFullScreenChange),_this.setFullPage(!1),_this.isFullPage()&&(_this.element.style.width=_this.fullPageStyleWidth,_this.element.style.height=_this.fullPageStyleHeight)),_this.navigator&&_this.viewport&&setTimeout(function(){_this.navigator.update(_this.viewport)}),_this.raiseEvent("full-screen",{fullScreen:isFullScreen})};$.addEvent(document,$.fullScreenEventName,onFullScreenChange),$.addEvent(document,$.fullScreenErrorEventName,onFullScreenChange),$.requestFullScreen(document.body)}else $.exitFullScreen()}return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(visible){return this.container.style.visibility=visible?"":"hidden",this.raiseEvent("visible",{visible:visible}),this},addTiledImage:function(options){$.console.assert(options,"[Viewer.addTiledImage] options is required"),$.console.assert(options.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),$.console.assert(!options.replace||-1<options.index&&options.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var _this=this,myQueueItem=(options.replace&&(options.replaceItem=_this.world.getItemAt(options.index)),this._hideMessage(),void 0===options.placeholderFillStyle&&(options.placeholderFillStyle=this.placeholderFillStyle),void 0===options.opacity&&(options.opacity=this.opacity),void 0===options.preload&&(options.preload=this.preload),void 0===options.compositeOperation&&(options.compositeOperation=this.compositeOperation),void 0===options.crossOriginPolicy&&(options.crossOriginPolicy=(void 0!==options.tileSource.crossOriginPolicy?options.tileSource:this).crossOriginPolicy),void 0===options.ajaxWithCredentials&&(options.ajaxWithCredentials=this.ajaxWithCredentials),void 0===options.loadTilesWithAjax&&(options.loadTilesWithAjax=this.loadTilesWithAjax),void 0===options.ajaxHeaders||null===options.ajaxHeaders?options.ajaxHeaders=this.ajaxHeaders:$.isPlainObject(options.ajaxHeaders)&&$.isPlainObject(this.ajaxHeaders)&&(options.ajaxHeaders=$.extend({},this.ajaxHeaders,options.ajaxHeaders)),{options:options});function raiseAddItemFailed(event){for(var i=0;i<_this._loadQueue.length;i++)if(_this._loadQueue[i]===myQueueItem){_this._loadQueue.splice(i,1);break}0===_this._loadQueue.length&&refreshWorld(myQueueItem),_this.raiseEvent("add-item-failed",event),options.error&&options.error(event)}function refreshWorld(theItem){_this.collectionMode&&(_this.world.arrange({immediately:theItem.options.collectionImmediately,rows:_this.collectionRows,columns:_this.collectionColumns,layout:_this.collectionLayout,tileSize:_this.collectionTileSize,tileMargin:_this.collectionTileMargin}),_this.world.setAutoRefigureSizes(!0))}function processReadyItems(){for(var queueItem,optionsClone,newIndex;_this._loadQueue.length&&(queueItem=_this._loadQueue[0]).tileSource;)_this._loadQueue.splice(0,1),queueItem.options.replace&&(-1!=(newIndex=_this.world.getIndexOfItem(queueItem.options.replaceItem))&&(queueItem.options.index=newIndex),_this.world.removeItem(queueItem.options.replaceItem)),newIndex=new $.TiledImage({viewer:_this,source:queueItem.tileSource,viewport:_this.viewport,drawer:_this.drawer,tileCache:_this.tileCache,imageLoader:_this.imageLoader,x:queueItem.options.x,y:queueItem.options.y,width:queueItem.options.width,height:queueItem.options.height,fitBounds:queueItem.options.fitBounds,fitBoundsPlacement:queueItem.options.fitBoundsPlacement,clip:queueItem.options.clip,placeholderFillStyle:queueItem.options.placeholderFillStyle,opacity:queueItem.options.opacity,preload:queueItem.options.preload,degrees:queueItem.options.degrees,compositeOperation:queueItem.options.compositeOperation,springStiffness:_this.springStiffness,animationTime:_this.animationTime,minZoomImageRatio:_this.minZoomImageRatio,wrapHorizontal:_this.wrapHorizontal,wrapVertical:_this.wrapVertical,immediateRender:_this.immediateRender,blendTime:_this.blendTime,alwaysBlend:_this.alwaysBlend,minPixelRatio:_this.minPixelRatio,smoothTileEdgesMinZoom:_this.smoothTileEdgesMinZoom,iOSDevice:_this.iOSDevice,crossOriginPolicy:queueItem.options.crossOriginPolicy,ajaxWithCredentials:queueItem.options.ajaxWithCredentials,loadTilesWithAjax:queueItem.options.loadTilesWithAjax,ajaxHeaders:queueItem.options.ajaxHeaders,debugMode:_this.debugMode}),_this.collectionMode&&_this.world.setAutoRefigureSizes(!1),_this.world.addItem(newIndex,{index:queueItem.options.index}),0===_this._loadQueue.length&&refreshWorld(queueItem),1!==_this.world.getItemCount()||_this.preserveViewport||_this.viewport.goHome(!0),_this.navigator&&(optionsClone=$.extend({},queueItem.options,{replace:!1,originalTiledImage:newIndex,tileSource:queueItem.tileSource}),_this.navigator.addTiledImage(optionsClone)),queueItem.options.success&&queueItem.options.success({item:newIndex})}$.isArray(options.tileSource)?setTimeout(function(){raiseAddItemFailed({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:options.tileSource,options:options})}):(this._loadQueue.push(myQueueItem),function(viewer,tileSource,imgOptions,successCallback,failCallback){var _this=viewer;if("string"==$.type(tileSource))if(tileSource.match(/^\s*<.*>\s*$/))tileSource=$.parseXml(tileSource);else if(tileSource.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var tileSourceJ=$.parseJSON(tileSource);tileSource=tileSourceJ}catch(e){}function waitUntilReady(tileSource,originalTileSource){tileSource.ready?successCallback(tileSource):(tileSource.addHandler("ready",function(){successCallback(tileSource)}),tileSource.addHandler("open-failed",function(event){failCallback({message:event.message,source:originalTileSource})}))}setTimeout(function(){var customTileSource,options;"string"==$.type(tileSource)?(tileSource=new $.TileSource({url:tileSource,crossOriginPolicy:(void 0!==imgOptions.crossOriginPolicy?imgOptions:viewer).crossOriginPolicy,ajaxWithCredentials:viewer.ajaxWithCredentials,ajaxHeaders:viewer.ajaxHeaders,useCanvas:viewer.useCanvas,success:function(event){successCallback(event.tileSource)}})).addHandler("open-failed",function(event){failCallback(event)}):$.isPlainObject(tileSource)||tileSource.nodeType?(void 0!==tileSource.crossOriginPolicy||void 0===imgOptions.crossOriginPolicy&&void 0===viewer.crossOriginPolicy||(tileSource.crossOriginPolicy=(void 0!==imgOptions.crossOriginPolicy?imgOptions:viewer).crossOriginPolicy),void 0===tileSource.ajaxWithCredentials&&(tileSource.ajaxWithCredentials=viewer.ajaxWithCredentials),void 0===tileSource.useCanvas&&(tileSource.useCanvas=viewer.useCanvas),$.isFunction(tileSource.getTileUrl)?((customTileSource=new $.TileSource(tileSource)).getTileUrl=tileSource.getTileUrl,successCallback(customTileSource)):(customTileSource=$.TileSource.determineType(_this,tileSource))?(options=customTileSource.prototype.configure.apply(_this,[tileSource]),waitUntilReady(new customTileSource(options),tileSource)):failCallback({message:"Unable to load TileSource",source:tileSource})):waitUntilReady(tileSource,tileSource)})}(this,options.tileSource,options,function(tileSource){myQueueItem.tileSource=tileSource,processReadyItems()},function(event){event.options=options,raiseAddItemFailed(event),processReadyItems()}))},addSimpleImage:function(options){$.console.assert(options,"[Viewer.addSimpleImage] options is required"),$.console.assert(options.url,"[Viewer.addSimpleImage] options.url is required");options=$.extend({},options,{tileSource:{type:"image",url:options.url}});delete options.url,this.addTiledImage(options)},addLayer:function(options){var _this=this,optionsClone=($.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead."),$.extend({},options,{success:function(event){_this.raiseEvent("add-layer",{options:options,drawer:event.item})},error:function(event){_this.raiseEvent("add-layer-failed",event)}}));return this.addTiledImage(optionsClone),this},getLayerAtLevel:function(level){return $.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(level)},getLevelOfLayer:function(drawer){return $.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(drawer)},getLayersCount:function(){return $.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(drawer,level){return $.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(drawer,level)},removeLayer:function(drawer){return $.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(drawer)},forceRedraw:function(){return THIS[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var onFocusHandler=$.delegate(this,onFocus),onBlurHandler=$.delegate(this,onBlur),onNextHandler=$.delegate(this,onNext),onPreviousHandler=$.delegate(this,onPrevious),navImages=this.navImages,useGroup=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(useGroup=!1),this.previousButton=new $.Button({element:this.previousButton?$.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.PreviousPage"),srcRest:resolveUrl(this.prefixUrl,navImages.previous.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.previous.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.previous.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.previous.DOWN),onRelease:onPreviousHandler,onFocus:onFocusHandler,onBlur:onBlurHandler}),this.nextButton=new $.Button({element:this.nextButton?$.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.NextPage"),srcRest:resolveUrl(this.prefixUrl,navImages.next.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.next.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.next.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.next.DOWN),onRelease:onNextHandler,onFocus:onFocusHandler,onBlur:onBlurHandler}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),useGroup)&&(this.paging=new $.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:$.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||$.ControlAnchor.TOP_LEFT})),this},bindStandardControls:function(){var beginZoomingInHandler=$.delegate(this,beginZoomingIn),endZoomingHandler=$.delegate(this,endZooming),doSingleZoomInHandler=$.delegate(this,doSingleZoomIn),beginZoomingOutHandler=$.delegate(this,beginZoomingOut),doSingleZoomOutHandler=$.delegate(this,doSingleZoomOut),onHomeHandler=$.delegate(this,onHome),onFullScreenHandler=$.delegate(this,onFullScreen),onRotateLeftHandler=$.delegate(this,onRotateLeft),onRotateRightHandler=$.delegate(this,onRotateRight),onFlipHandler=$.delegate(this,onFlip),onFocusHandler=$.delegate(this,onFocus),onBlurHandler=$.delegate(this,onBlur),navImages=this.navImages,buttons=[],useGroup=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(useGroup=!1),this.showZoomControl&&(buttons.push(this.zoomInButton=new $.Button({element:this.zoomInButton?$.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.ZoomIn"),srcRest:resolveUrl(this.prefixUrl,navImages.zoomIn.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.zoomIn.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.zoomIn.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.zoomIn.DOWN),onPress:beginZoomingInHandler,onRelease:endZoomingHandler,onClick:doSingleZoomInHandler,onEnter:beginZoomingInHandler,onExit:endZoomingHandler,onFocus:onFocusHandler,onBlur:onBlurHandler})),buttons.push(this.zoomOutButton=new $.Button({element:this.zoomOutButton?$.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.ZoomOut"),srcRest:resolveUrl(this.prefixUrl,navImages.zoomOut.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.zoomOut.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.zoomOut.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.zoomOut.DOWN),onPress:beginZoomingOutHandler,onRelease:endZoomingHandler,onClick:doSingleZoomOutHandler,onEnter:beginZoomingOutHandler,onExit:endZoomingHandler,onFocus:onFocusHandler,onBlur:onBlurHandler}))),this.showHomeControl&&buttons.push(this.homeButton=new $.Button({element:this.homeButton?$.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.Home"),srcRest:resolveUrl(this.prefixUrl,navImages.home.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.home.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.home.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.home.DOWN),onRelease:onHomeHandler,onFocus:onFocusHandler,onBlur:onBlurHandler})),this.showFullPageControl&&buttons.push(this.fullPageButton=new $.Button({element:this.fullPageButton?$.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.FullPage"),srcRest:resolveUrl(this.prefixUrl,navImages.fullpage.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.fullpage.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.fullpage.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.fullpage.DOWN),onRelease:onFullScreenHandler,onFocus:onFocusHandler,onBlur:onBlurHandler})),this.showRotationControl&&(buttons.push(this.rotateLeftButton=new $.Button({element:this.rotateLeftButton?$.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.RotateLeft"),srcRest:resolveUrl(this.prefixUrl,navImages.rotateleft.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.rotateleft.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.rotateleft.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.rotateleft.DOWN),onRelease:onRotateLeftHandler,onFocus:onFocusHandler,onBlur:onBlurHandler})),buttons.push(this.rotateRightButton=new $.Button({element:this.rotateRightButton?$.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.RotateRight"),srcRest:resolveUrl(this.prefixUrl,navImages.rotateright.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.rotateright.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.rotateright.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.rotateright.DOWN),onRelease:onRotateRightHandler,onFocus:onFocusHandler,onBlur:onBlurHandler}))),this.showFlipControl&&buttons.push(this.flipButton=new $.Button({element:this.flipButton?$.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.Flip"),srcRest:resolveUrl(this.prefixUrl,navImages.flip.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.flip.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.flip.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.flip.DOWN),onRelease:onFlipHandler,onFocus:onFocusHandler,onBlur:onBlurHandler})),useGroup)&&(this.buttons=new $.ButtonGroup({buttons:buttons,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",$.delegate(this,lightUp)),(this.toolbar||this).addControl(this.navControl,{anchor:this.navigationControlAnchor||$.ControlAnchor.TOP_LEFT})),this},currentPage:function(){return this._sequenceIndex},goToPage:function(page){return this.tileSources&&0<=page&&page<this.tileSources.length&&(this._sequenceIndex=page,this._updateSequenceButtons(page),this.open(this.tileSources[page]),this.referenceStrip&&this.referenceStrip.setFocus(page),this.raiseEvent("page",{page:page})),this},addOverlay:function(element,location,placement,onDraw){location=$.isPlainObject(element)?element:{element:element,location:location,placement:placement,onDraw:onDraw};return element=$.getElement(location.element),0<=getOverlayIndex(this.currentOverlays,element)||(placement=getOverlayObject(this,location),this.currentOverlays.push(placement),placement.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:element,location:location.location,placement:location.placement})),this},updateOverlay:function(element,location,placement){var i;return element=$.getElement(element),0<=(i=getOverlayIndex(this.currentOverlays,element))&&(this.currentOverlays[i].update(location,placement),THIS[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:element,location:location,placement:placement})),this},removeOverlay:function(element){var i;return element=$.getElement(element),0<=(i=getOverlayIndex(this.currentOverlays,element))&&(this.currentOverlays[i].destroy(),this.currentOverlays.splice(i,1),THIS[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:element})),this},clearOverlays:function(){for(;0<this.currentOverlays.length;)this.currentOverlays.pop().destroy();return THIS[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(element){return element=$.getElement(element),0<=(element=getOverlayIndex(this.currentOverlays,element))?this.currentOverlays[element]:null},_updateSequenceButtons:function(page){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==page?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(0<page?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(message){this._hideMessage();var div=$.makeNeutralElement("div");div.appendChild(document.createTextNode(message)),this.messageDiv=$.makeCenteredNode(div),$.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var div=this.messageDiv;div&&(div.parentNode.removeChild(div),delete this.messageDiv)},gestureSettingsByDeviceType:function(type){switch(type){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){for(var length=this.currentOverlays.length,i=0;i<length;i++)this.currentOverlays[i].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){this.showReferenceStrip=!0,this.sequenceMode?this.referenceStrip||this.tileSources.length&&1<this.tileSources.length&&(this.referenceStrip=new $.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex)):$.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}})}(OpenSeadragon),!function($){function onCanvasClick(event){var canvasClickEventArgs={tracker:event.eventSource,position:event.position,quick:event.quick,shift:event.shift,originalEvent:event.originalEvent,preventDefaultAction:event.preventDefaultAction};this.viewer.raiseEvent("navigator-click",canvasClickEventArgs),!canvasClickEventArgs.preventDefaultAction&&event.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)&&(this.viewer.viewport.flipped&&(event.position.x=this.viewport.getContainerSize().x-event.position.x),canvasClickEventArgs=this.viewport.pointFromPixel(event.position),this.panVertical?this.panHorizontal||(canvasClickEventArgs.x=this.viewer.viewport.getCenter(!0).x):canvasClickEventArgs.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(canvasClickEventArgs),this.viewer.viewport.applyConstraints())}function onCanvasDrag(event){var canvasDragEventArgs={tracker:event.eventSource,position:event.position,delta:event.delta,speed:event.speed,direction:event.direction,shift:event.shift,originalEvent:event.originalEvent,preventDefaultAction:event.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",canvasDragEventArgs),!canvasDragEventArgs.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(event.delta.x=0),this.panVertical||(event.delta.y=0),this.viewer.viewport.flipped&&(event.delta.x=-event.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(event.delta)),this.viewer.constrainDuringPan)&&this.viewer.viewport.applyConstraints()}function onCanvasRelease(event){event.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function onCanvasScroll(event){return this.viewer.raiseEvent("navigator-scroll",{tracker:event.eventSource,position:event.position,scroll:event.scroll,shift:event.shift,originalEvent:event.originalEvent}),!1}function _setTransformRotate(element,degrees){setElementTransform(element,"rotate("+degrees+"deg)")}function setElementTransform(element,rule){element.style.webkitTransform=rule,element.style.mozTransform=rule,element.style.msTransform=rule,element.style.oTransform=rule,element.style.transform=rule}$.Navigator=function(options){var style,borderWidth,viewer=options.viewer,_this=this;function rotate(degrees){_setTransformRotate(_this.displayRegionContainer,degrees),_setTransformRotate(_this.displayRegion,-degrees),_this.viewport.setRotation(degrees)}options.id?(this.element=document.getElementById(options.id),options.controlOptions={anchor:$.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(options.id="navigator-"+$.now(),this.element=$.makeNeutralElement("div"),options.controlOptions={anchor:$.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:options.autoFade},options.position&&("BOTTOM_RIGHT"==options.position?options.controlOptions.anchor=$.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==options.position?options.controlOptions.anchor=$.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==options.position?options.controlOptions.anchor=$.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==options.position?options.controlOptions.anchor=$.ControlAnchor.TOP_LEFT:"ABSOLUTE"==options.position&&(options.controlOptions.anchor=$.ControlAnchor.ABSOLUTE,options.controlOptions.top=options.top,options.controlOptions.left=options.left,options.controlOptions.height=options.height,options.controlOptions.width=options.width))),this.element.id=options.id,this.element.className+=" navigator",(options=$.extend(!0,{sizeRatio:$.DEFAULT_SETTINGS.navigatorSizeRatio},options,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:options.autoResize,minZoomImageRatio:1,background:options.background,opacity:options.opacity,borderColor:options.borderColor,displayRegionColor:options.displayRegionColor})).minPixelRatio=this.minPixelRatio=viewer.minPixelRatio,$.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new $.Point(1,1),this.totalBorderWidths=new $.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),options.controlOptions.anchor!=$.ControlAnchor.NONE&&(style=this.element.style,borderWidth=this.borderWidth,style.margin="0px",style.border=borderWidth+"px solid "+options.borderColor,style.padding="0px",style.background=options.background,style.opacity=options.opacity,style.overflow="hidden"),this.displayRegion=$.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(style,borderWidth){style.position="relative",style.top="0px",style.left="0px",style.fontSize="0px",style.overflow="hidden",style.border=borderWidth+"px solid "+options.displayRegionColor,style.margin="0px",style.padding="0px",style.background="transparent",style.float="left",style.cssFloat="left",style.styleFloat="left",style.zIndex=999999999,style.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=$.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",viewer.addControl(this.element,options.controlOptions),this._resizeWithViewer=options.controlOptions.anchor!=$.ControlAnchor.ABSOLUTE&&options.controlOptions.anchor!=$.ControlAnchor.NONE,options.width&&options.height?(this.setWidth(options.width),this.setHeight(options.height)):this._resizeWithViewer&&(borderWidth=$.getElementSize(viewer.element),this.element.style.height=Math.round(borderWidth.y*options.sizeRatio)+"px",this.element.style.width=Math.round(borderWidth.x*options.sizeRatio)+"px",this.oldViewerSize=borderWidth,style=$.getElementSize(this.element),this.elementArea=style.x*style.y),this.oldContainerSize=new $.Point(0,0),$.Viewer.apply(this,[options]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),options.navigatorRotate&&(rotate(options.viewer.viewport?options.viewer.viewport.getRotation():options.viewer.degrees||0),options.viewer.addHandler("rotate",function(args){rotate(args.degrees)})),this.innerTracker.destroy(),this.innerTracker=new $.MouseTracker({element:this.element,dragHandler:$.delegate(this,onCanvasDrag),clickHandler:$.delegate(this,onCanvasClick),releaseHandler:$.delegate(this,onCanvasRelease),scrollHandler:$.delegate(this,onCanvasScroll)}),this.addHandler("reset-size",function(){_this.viewport&&_this.viewport.goHome(!0)}),viewer.world.addHandler("item-index-change",function(event){window.setTimeout(function(){var item=_this.world.getItemAt(event.previousIndex);_this.world.setItemIndex(item,event.newIndex)},1)}),viewer.world.addHandler("remove-item",function(event){event=event.item,event=_this._getMatchingItem(event);event&&_this.world.removeItem(event)}),this.update(viewer.viewport)},$.extend($.Navigator.prototype,$.EventSource.prototype,$.Viewer.prototype,{updateSize:function(){var containerSize;this.viewport&&!(containerSize=new $.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight)).equals(this.oldContainerSize)&&(this.viewport.resize(containerSize,!0),this.viewport.goHome(!0),this.oldContainerSize=containerSize,this.drawer.clear(),this.world.draw())},setWidth:function(width){this.width=width,this.element.style.width="number"==typeof width?width+"px":width,this._resizeWithViewer=!1},setHeight:function(height){this.height=height,this.element.style.height="number"==typeof height?height+"px":height,this._resizeWithViewer=!1},setFlip:function(state){return this.viewport.setFlip(state),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(rule){setElementTransform(this.displayRegion,rule),setElementTransform(this.canvas,rule),setElementTransform(this.element,rule)},update:function(viewport){var newWidth,width,viewerSize=$.getElementSize(this.viewer.element);this._resizeWithViewer&&viewerSize.x&&viewerSize.y&&!viewerSize.equals(this.oldViewerSize)&&(this.oldViewerSize=viewerSize,viewerSize=this.maintainSizeRatio||!this.elementArea?(newWidth=viewerSize.x*this.sizeRatio,viewerSize.y*this.sizeRatio):(newWidth=Math.sqrt(this.elementArea*(viewerSize.x/viewerSize.y)),this.elementArea/newWidth),this.element.style.width=Math.round(newWidth)+"px",this.element.style.height=Math.round(viewerSize)+"px",this.elementArea||(this.elementArea=newWidth*viewerSize),this.updateSize()),viewport&&this.viewport&&(newWidth=viewport.getBoundsNoRotate(!0),viewerSize=this.viewport.pixelFromPointNoRotate(newWidth.getTopLeft(),!1),viewport=this.viewport.pixelFromPointNoRotate(newWidth.getBottomRight(),!1).minus(this.totalBorderWidths),(newWidth=this.displayRegion.style).display=this.world.getItemCount()?"block":"none",newWidth.top=Math.round(viewerSize.y)+"px",newWidth.left=Math.round(viewerSize.x)+"px",width=Math.abs(viewerSize.x-viewport.x),viewerSize=Math.abs(viewerSize.y-viewport.y),newWidth.width=Math.round(Math.max(width,0))+"px",newWidth.height=Math.round(Math.max(viewerSize,0))+"px")},addTiledImage:function(options){var _this=this,original=options.originalTiledImage,options=(delete options.original,$.extend({},options,{success:function(event){var myItem=event.item;function matchBounds(){_this._matchBounds(myItem,original)}myItem._originalForNavigator=original,_this._matchBounds(myItem,original,!0),original.addHandler("bounds-change",matchBounds),original.addHandler("clip-change",matchBounds),original.addHandler("opacity-change",function(){_this._matchOpacity(myItem,original)}),original.addHandler("composite-operation-change",function(){_this._matchCompositeOperation(myItem,original)})}}));return $.Viewer.prototype.addTiledImage.apply(this,[options])},_getMatchingItem:function(theirItem){for(var item,count=this.world.getItemCount(),i=0;i<count;i++)if((item=this.world.getItemAt(i))._originalForNavigator===theirItem)return item;return null},_matchBounds:function(myItem,theirItem,immediately){var bounds=theirItem.getBoundsNoRotate();myItem.setPosition(bounds.getTopLeft(),immediately),myItem.setWidth(bounds.width,immediately),myItem.setRotation(theirItem.getRotation(),immediately),myItem.setClip(theirItem.getClip())},_matchOpacity:function(myItem,theirItem){myItem.setOpacity(theirItem.opacity)},_matchCompositeOperation:function(myItem,theirItem){myItem.setCompositeOperation(theirItem.compositeOperation)}})}(OpenSeadragon),!function($){var I18N={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};$.extend($,{getString:function(prop){for(var props=prop.split("."),string=null,args=arguments,container=I18N,i=0;i<props.length-1;i++)container=container[props[i]]||{};return"string"!=typeof(string=container[props[i]])&&($.console.log("Untranslated source string:",prop),string=""),string.replace(/\{\d+\}/g,function(capture){capture=parseInt(capture.match(/\d+/),10)+1;return capture<args.length?args[capture]:""})},setString:function(prop,value){for(var props=prop.split("."),container=I18N,i=0;i<props.length-1;i++)container[props[i]]||(container[props[i]]={}),container=container[props[i]];container[props[i]]=value}})}(OpenSeadragon),!function($){$.Point=function(x,y){this.x="number"==typeof x?x:0,this.y="number"==typeof y?y:0},$.Point.prototype={clone:function(){return new $.Point(this.x,this.y)},plus:function(point){return new $.Point(this.x+point.x,this.y+point.y)},minus:function(point){return new $.Point(this.x-point.x,this.y-point.y)},times:function(factor){return new $.Point(this.x*factor,this.y*factor)},divide:function(factor){return new $.Point(this.x/factor,this.y/factor)},negate:function(){return new $.Point(-this.x,-this.y)},distanceTo:function(point){return Math.sqrt(Math.pow(this.x-point.x,2)+Math.pow(this.y-point.y,2))},squaredDistanceTo:function(point){return Math.pow(this.x-point.x,2)+Math.pow(this.y-point.y,2)},apply:function(func){return new $.Point(func(this.x),func(this.y))},equals:function(point){return point instanceof $.Point&&this.x===point.x&&this.y===point.y},rotate:function(degrees,pivot){if(pivot=pivot||new $.Point(0,0),degrees%90==0)switch($.positiveModulo(degrees,360)){case 0:cos=1,sin=0;break;case 90:cos=0,sin=1;break;case 180:cos=-1,sin=0;break;case 270:cos=0,sin=-1}else var degrees=degrees*Math.PI/180,cos=Math.cos(degrees),sin=Math.sin(degrees);degrees=cos*(this.x-pivot.x)-sin*(this.y-pivot.y)+pivot.x,pivot=sin*(this.x-pivot.x)+cos*(this.y-pivot.y)+pivot.y;return new $.Point(degrees,pivot)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),!function($){$.TileSource=function(width,height,tileSize,tileOverlap,minLevel,maxLevel){var i,_this=this,args=arguments,args=$.isPlainObject(width)?width:{width:args[0],height:args[1],tileSize:args[2],tileOverlap:args[3],minLevel:args[4],maxLevel:args[5]};if($.EventSource.call(this),$.extend(!0,this,args),!this.success)for(i=0;i<arguments.length;i++)if($.isFunction(arguments[i])){this.success=arguments[i];break}this.success&&this.addHandler("ready",function(event){_this.success(event)}),"string"==$.type(width)&&(this.url=width),this.url?(this.aspectRatio=1,this.dimensions=new $.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=args.width&&args.height?args.width/args.height:1,this.dimensions=new $.Point(args.width,args.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=args.tileOverlap||0,this.minLevel=args.minLevel||0,this.maxLevel=void 0!==args.maxLevel&&null!==args.maxLevel?args.maxLevel:args.width&&args.height?Math.ceil(Math.log(Math.max(args.width,args.height))/Math.log(2)):0,this.success&&$.isFunction(this.success)&&this.success(this))},$.TileSource.prototype={getTileSize:function(level){return $.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(level){return this._tileWidth||this.getTileSize(level)},getTileHeight:function(level){return this._tileHeight||this.getTileSize(level)},getLevelScale:function(level){for(var levelScaleCache={},i=0;i<=this.maxLevel;i++)levelScaleCache[i]=1/Math.pow(2,this.maxLevel-i);return this.getLevelScale=function(_level){return levelScaleCache[_level]},this.getLevelScale(level)},getNumTiles:function(level){var scale=this.getLevelScale(level),x=Math.ceil(scale*this.dimensions.x/this.getTileWidth(level)),scale=Math.ceil(scale*this.dimensions.y/this.getTileHeight(level));return new $.Point(x,scale)},getPixelRatio:function(level){var level=this.dimensions.times(this.getLevelScale(level)),rx=1/level.x,level=1/level.y;return new $.Point(rx,level)},getClosestLevel:function(){for(var tiles,i=this.minLevel+1;i<=this.maxLevel&&!(1<(tiles=this.getNumTiles(i)).x||1<tiles.y);i++);return i-1},getTileAtPoint:function(level,point){var validPoint=0<=point.x&&point.x<=1&&0<=point.y&&point.y<=1/this.aspectRatio,validPoint=($.console.assert(validPoint,"[TileSource.getTileAtPoint] must be called with a valid point."),this.dimensions.x*this.getLevelScale(level)),pixelX=point.x*validPoint,validPoint=point.y*validPoint,pixelX=Math.floor(pixelX/this.getTileWidth(level)),validPoint=Math.floor(validPoint/this.getTileHeight(level));1<=point.x&&(pixelX=this.getNumTiles(level).x-1);return point.y>=1/this.aspectRatio-1e-15&&(validPoint=this.getNumTiles(level).y-1),new $.Point(pixelX,validPoint)},getTileBounds:function(level,x,y,isSource){var dimensionsScaled=this.dimensions.times(this.getLevelScale(level)),tileWidth=this.getTileWidth(level),level=this.getTileHeight(level),px=0===x?0:tileWidth*x-this.tileOverlap,py=0===y?0:level*y-this.tileOverlap,tileWidth=tileWidth+(0===x?1:2)*this.tileOverlap,x=level+(0===y?1:2)*this.tileOverlap,level=1/dimensionsScaled.x,tileWidth=Math.min(tileWidth,dimensionsScaled.x-px),x=Math.min(x,dimensionsScaled.y-py);return isSource?new $.Rect(0,0,tileWidth,x):new $.Rect(px*level,py*level,tileWidth*level,x*level)},getImageInfo:function(url){var callback,options,urlParts,filename,lastDot,_this=this;url&&-1<(lastDot=(filename=(urlParts=url.split("/"))[urlParts.length-1]).lastIndexOf("."))&&(urlParts[urlParts.length-1]=filename.slice(0,lastDot)),callback=function(data){"string"==typeof data&&(data=$.parseXml(data));var $TileSource=$.TileSource.determineType(_this,data,url);$TileSource?(void 0===(options=$TileSource.prototype.configure.apply(_this,[data,url])).ajaxWithCredentials&&(options.ajaxWithCredentials=_this.ajaxWithCredentials),options=new $TileSource(options),_this.ready=!0,_this.raiseEvent("ready",{tileSource:options})):_this.raiseEvent("open-failed",{message:"Unable to load TileSource",source:url})},url.match(/\.js$/)?(urlParts=url.split("/").pop().replace(".js",""),$.jsonp({url:url,async:!1,callbackName:urlParts,callback:callback})):$.makeAjaxRequest({url:url,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(xhr){xhr=function(xhr){var statusText,data,responseText=xhr.responseText,status=xhr.status;{if(!xhr)throw new Error($.getString("Errors.Security"));if(200!==xhr.status&&0!==xhr.status)throw status=xhr.status,statusText=404==status?"Not Found":xhr.statusText,new Error($.getString("Errors.Status",status,statusText))}if(responseText.match(/\s*<.*/))try{data=xhr.responseXML&&xhr.responseXML.documentElement?xhr.responseXML:$.parseXml(responseText)}catch(e){data=xhr.responseText}else if(responseText.match(/\s*[\{\[].*/))try{data=$.parseJSON(responseText)}catch(e){data=responseText}else data=responseText;return data}(xhr);callback(xhr)},error:function(xhr,exc){try{msg="HTTP "+xhr.status+" attempting to load TileSource"}catch(e){var xhr=void 0!==exc&&exc.toString?exc.toString():"Unknown error",msg=xhr+" attempting to load TileSource"}_this.raiseEvent("open-failed",{message:msg,source:url})}})},supports:function(data,url){return!1},configure:function(data,url){throw new Error("Method not implemented.")},getTileUrl:function(level,x,y){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(level,x,y){return{}},tileExists:function(level,x,y){var numTiles=this.getNumTiles(level);return level>=this.minLevel&&level<=this.maxLevel&&0<=x&&0<=y&&x<numTiles.x&&y<numTiles.y}},$.extend(!0,$.TileSource.prototype,$.EventSource.prototype),$.TileSource.determineType=function(tileSource,data,url){for(var property in OpenSeadragon)if(property.match(/.+TileSource$/)&&$.isFunction(OpenSeadragon[property])&&$.isFunction(OpenSeadragon[property].prototype.supports)&&OpenSeadragon[property].prototype.supports.call(tileSource,data,url))return OpenSeadragon[property];$.console.error("No TileSource was able to open %s %s",url,data)}}(OpenSeadragon),!function($){function configureFromObject(tileSource,configuration){for(var rectData,imageData=configuration.Image,tilesUrl=imageData.Url,fileFormat=imageData.Format,sizeData=imageData.Size,dispRectData=imageData.DisplayRect||[],width=parseInt(sizeData.Width,10),sizeData=parseInt(sizeData.Height,10),tileSize=parseInt(imageData.TileSize,10),imageData=parseInt(imageData.Overlap,10),displayRects=[],i=0;i<dispRectData.length;i++)rectData=dispRectData[i].Rect,displayRects.push(new $.DisplayRect(parseInt(rectData.X,10),parseInt(rectData.Y,10),parseInt(rectData.Width,10),parseInt(rectData.Height,10),parseInt(rectData.MinLevel,10),parseInt(rectData.MaxLevel,10)));return $.extend(!0,{width:width,height:sizeData,tileSize:tileSize,tileOverlap:imageData,minLevel:null,maxLevel:null,tilesUrl:tilesUrl,fileFormat:fileFormat,displayRects:displayRects},configuration)}$.DziTileSource=function(width,height,tileSize,tileOverlap,tilesUrl,fileFormat,displayRects,minLevel,maxLevel){var i,rect,level,options=$.isPlainObject(width)?width:{width:width,height:height,tileSize:tileSize,tileOverlap:tileOverlap,tilesUrl:tilesUrl,fileFormat:fileFormat,displayRects:displayRects,minLevel:minLevel,maxLevel:maxLevel};if(this._levelRects={},this.tilesUrl=options.tilesUrl,this.fileFormat=options.fileFormat,this.displayRects=options.displayRects,this.displayRects)for(i=this.displayRects.length-1;0<=i;i--)for(level=(rect=this.displayRects[i]).minLevel;level<=rect.maxLevel;level++)this._levelRects[level]||(this._levelRects[level]=[]),this._levelRects[level].push(rect);$.TileSource.apply(this,[options])},$.extend($.DziTileSource.prototype,$.TileSource.prototype,{supports:function(data,url){var ns;return data.Image?ns=data.Image.xmlns:!data.documentElement||"Image"!=data.documentElement.localName&&"Image"!=data.documentElement.tagName||(ns=data.documentElement.namespaceURI),-1!==(ns=(ns||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==ns.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(data,url){data=($.isPlainObject(data)?configureFromObject:function(tileSource,xmlDoc){if(!xmlDoc||!xmlDoc.documentElement)throw new Error($.getString("Errors.Xml"));var dispRectNodes,dispRectNode,rectNode,i,root=xmlDoc.documentElement,rootName=root.localName||root.tagName,ns=xmlDoc.documentElement.namespaceURI,xmlDoc=null,displayRects=[];if("Image"==rootName)try{if(void 0===(sizeNode=root.getElementsByTagName("Size")[0])&&(sizeNode=root.getElementsByTagNameNS(ns,"Size")[0]),xmlDoc={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:root.getAttribute("Url"),Format:root.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(root.getAttribute("Overlap"),10),TileSize:parseInt(root.getAttribute("TileSize"),10),Size:{Height:parseInt(sizeNode.getAttribute("Height"),10),Width:parseInt(sizeNode.getAttribute("Width"),10)}}},!$.imageFormatSupported(xmlDoc.Image.Format))throw new Error($.getString("Errors.ImageFormat",xmlDoc.Image.Format.toUpperCase()));for(void 0===(dispRectNodes=root.getElementsByTagName("DisplayRect"))&&(dispRectNodes=root.getElementsByTagNameNS(ns,"DisplayRect")[0]),i=0;i<dispRectNodes.length;i++)dispRectNode=dispRectNodes[i],void 0===(rectNode=dispRectNode.getElementsByTagName("Rect")[0])&&(rectNode=dispRectNode.getElementsByTagNameNS(ns,"Rect")[0]),displayRects.push({Rect:{X:parseInt(rectNode.getAttribute("X"),10),Y:parseInt(rectNode.getAttribute("Y"),10),Width:parseInt(rectNode.getAttribute("Width"),10),Height:parseInt(rectNode.getAttribute("Height"),10),MinLevel:parseInt(dispRectNode.getAttribute("MinLevel"),10),MaxLevel:parseInt(dispRectNode.getAttribute("MaxLevel"),10)}});return displayRects.length&&(xmlDoc.Image.DisplayRect=displayRects),configureFromObject(0,xmlDoc)}catch(e){throw e instanceof Error?e:new Error($.getString("Errors.Dzi"))}else{if("Collection"==rootName)throw new Error($.getString("Errors.Dzc"));var sizeNode;if("Error"==rootName)throw sizeNode=root.getElementsByTagName("Message")[0].firstChild.nodeValue,new Error(sizeNode)}throw new Error($.getString("Errors.Dzi"))})(this,data);return url&&!data.tilesUrl&&(data.tilesUrl=url.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),-1!=url.search(/\.(dzi|xml|js)\?/)?data.queryParams=url.match(/\?.*/):data.queryParams=""),data},getTileUrl:function(level,x,y){return[this.tilesUrl,level,"/",x,"_",y,".",this.fileFormat,this.queryParams].join("")},tileExists:function(level,x,y){var scale,xMin,yMin,xMax,rect,i,rects=this._levelRects[level];if(!(this.minLevel&&level<this.minLevel||this.maxLevel&&level>this.maxLevel)){if(!rects||!rects.length)return!0;for(i=rects.length-1;0<=i;i--)if(!(level<(rect=rects[i]).minLevel||level>rect.maxLevel)&&(scale=this.getLevelScale(level),xMin=rect.x*scale,yMin=rect.y*scale,xMax=xMin+rect.width*scale,rect=yMin+rect.height*scale,xMin=Math.floor(xMin/this._tileWidth),yMin=Math.floor(yMin/this._tileWidth),xMax=Math.ceil(xMax/this._tileWidth),rect=Math.ceil(rect/this._tileWidth),xMin<=x)&&x<xMax&&yMin<=y&&y<rect)return!0}return!1}})}(OpenSeadragon),!function($){function canBeTiled(options){var profileLevel=Array.isArray(options.profile)?options.profile[0]:options.profile,profileLevel=-1!==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"].indexOf(profileLevel),hasCanoncicalSizeFeature=!1;return 2===options.version&&1<options.profile.length&&options.profile[1].supports&&(hasCanoncicalSizeFeature=-1!==options.profile[1].supports.indexOf("sizeByW")),3===options.version&&options.extraFeatures&&(hasCanoncicalSizeFeature=-1!==options.extraFeatures.indexOf("sizeByWh")),!profileLevel||hasCanoncicalSizeFeature}function constructLevels(options){for(var levels=[],i=0;i<options.sizes.length;i++)levels.push({url:options["@id"]+"/full/"+options.sizes[i].width+","+(3===options.version?options.sizes[i].height:"")+"/0/default."+options.tileFormat,width:options.sizes[i].width,height:options.sizes[i].height});return levels.sort(function(a,b){return a.width-b.width})}$.IIIFTileSource=function(options){if($.extend(!0,this,options),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(options.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=options.version,this.tile_width&&this.tile_height)options.tileWidth=this.tile_width,options.tileHeight=this.tile_height;else if(this.tile_width)options.tileSize=this.tile_width;else if(this.tile_height)options.tileSize=this.tile_height;else if(this.tiles)if(1==this.tiles.length)options.tileWidth=this.tiles[0].width,options.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var t=0;t<this.tiles.length;t++)for(var sf=0;sf<this.tiles[t].scaleFactors.length;sf++){var scaleFactor=this.tiles[t].scaleFactors[sf];this.scale_factors.push(scaleFactor),options.tileSizePerScaleFactor[scaleFactor]={width:this.tiles[t].width,height:this.tiles[t].height||this.tiles[t].width}}}else if(canBeTiled(options)){for(var shortDim=Math.min(this.height,this.width),tileOptions=[256,512,1024],smallerTiles=[],c=0;c<tileOptions.length;c++)tileOptions[c]<=shortDim&&smallerTiles.push(tileOptions[c]);options.tileSize=0<smallerTiles.length?Math.max.apply(null,smallerTiles):shortDim}else this.sizes&&0<this.sizes.length?(this.emulateLegacyImagePyramid=!0,options.levels=constructLevels(this),$.extend(!0,options,{width:options.levels[options.levels.length-1].width,height:options.levels[options.levels.length-1].height,tileSize:Math.max(options.height,options.width),tileOverlap:0,minLevel:0,maxLevel:options.levels.length-1}),this.levels=options.levels):$.console.error("Nothing in the info.json to construct image pyramids from");var maxScaleFactor;options.maxLevel||this.emulateLegacyImagePyramid||(this.scale_factors?(maxScaleFactor=Math.max.apply(null,this.scale_factors),options.maxLevel=Math.round(Math.log(maxScaleFactor)*Math.LOG2E)):options.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)))),$.TileSource.apply(this,[options])},$.extend($.IIIFTileSource.prototype,$.TileSource.prototype,{supports:function(data,url){return!(!data.protocol||"http://iiif.io/api/image"!=data.protocol)||!!(data["@context"]&&("http://library.stanford.edu/iiif/image-api/1.1/context.json"==data["@context"]||"http://iiif.io/api/image/1/context.json"==data["@context"])||data.profile&&0===data.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")||data.identifier&&data.width&&data.height||data.documentElement&&"info"==data.documentElement.tagName&&"http://library.stanford.edu/iiif/image-api/ns/"==data.documentElement.namespaceURI)},configure:function(data,url){var options;if($.isPlainObject(data)){if(data["@context"]){var context=data["@context"];if(Array.isArray(context))for(var i=0;i<context.length;i++)if("string"==typeof context[i]&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(context[i])||"http://library.stanford.edu/iiif/image-api/1.1/context.json"===context[i])){context=context[i];break}switch(context){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":data.version=1;break;case"http://iiif.io/api/image/2/context.json":data.version=2;break;case"http://iiif.io/api/image/3/context.json":data.version=3;break;default:$.console.error("Data has a @context property which contains no known IIIF context URI.")}}else data["@context"]="http://iiif.io/api/image/1.0/context.json",data["@id"]=url.replace("/info.json",""),data.version=1;if(!data["@id"]&&data.id&&(data["@id"]=data.id),data.preferredFormats)for(var f=0;f<data.preferredFormats.length;f++)if(OpenSeadragon.imageFormatSupported(data.preferredFormats[f])){data.tileFormat=data.preferredFormats[f];break}return data}return(options=function(xmlDoc){if(!xmlDoc||!xmlDoc.documentElement)throw new Error($.getString("Errors.Xml"));var xmlDoc=xmlDoc.documentElement,rootName=xmlDoc.tagName,configuration=null;if("info"==rootName)try{return function parseXML10(node,configuration,property){var i,value;if(3==node.nodeType&&property)(value=node.nodeValue.trim()).match(/^\d*$/)&&(value=Number(value)),configuration[property]?($.isArray(configuration[property])||(configuration[property]=[configuration[property]]),configuration[property].push(value)):configuration[property]=value;else if(1==node.nodeType)for(i=0;i<node.childNodes.length;i++)parseXML10(node.childNodes[i],configuration,node.nodeName)}(xmlDoc,configuration={}),configuration}catch(e){throw e instanceof Error?e:new Error($.getString("Errors.IIIF"))}throw new Error($.getString("Errors.IIIF"))}(data))["@context"]="http://iiif.io/api/image/1.0/context.json",options["@id"]=url.replace("/info.xml",""),options.version=1,options},getTileWidth:function(level){return this.emulateLegacyImagePyramid?$.TileSource.prototype.getTileWidth.call(this,level):(level=Math.pow(2,this.maxLevel-level),this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[level]?this.tileSizePerScaleFactor[level].width:this._tileWidth)},getTileHeight:function(level){return this.emulateLegacyImagePyramid?$.TileSource.prototype.getTileHeight.call(this,level):(level=Math.pow(2,this.maxLevel-level),this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[level]?this.tileSizePerScaleFactor[level].height:this._tileHeight)},getLevelScale:function(level){var levelScale;return this.emulateLegacyImagePyramid?(levelScale=NaN,0<this.levels.length&&level>=this.minLevel&&level<=this.maxLevel?this.levels[level].width/this.levels[this.maxLevel].width:levelScale):$.TileSource.prototype.getLevelScale.call(this,level)},getNumTiles:function(level){return this.emulateLegacyImagePyramid?this.getLevelScale(level)?new $.Point(1,1):new $.Point(0,0):$.TileSource.prototype.getNumTiles.call(this,level)},getTileAtPoint:function(level,point){return this.emulateLegacyImagePyramid?new $.Point(0,0):$.TileSource.prototype.getTileAtPoint.call(this,level,point)},getTileUrl:function(level,x,y){var url,iiifRegion,levelHeight,levelWidth,iiifSize,tileWidth,iiifTileSizeWidth,iiifTileSizeHeight,iiifQuality;return this.emulateLegacyImagePyramid?(url=null,0<this.levels.length&&level>=this.minLevel&&level<=this.maxLevel?this.levels[level].url:url):(url=Math.pow(.5,this.maxLevel-level),levelWidth=Math.ceil(this.width*url),levelHeight=Math.ceil(this.height*url),tileWidth=this.getTileWidth(level),level=this.getTileHeight(level),iiifTileSizeWidth=Math.ceil(tileWidth/url),iiifTileSizeHeight=Math.ceil(level/url),iiifQuality=1===this.version?"native."+this.tileFormat:"default."+this.tileFormat,levelWidth<tileWidth&&levelHeight<level?(iiifSize=2===this.version&&levelWidth===this.width||3===this.version&&levelWidth===this.width&&levelHeight===this.height?"max":3===this.version?levelWidth+","+levelHeight:levelWidth+",",iiifRegion="full"):(tileWidth=x*iiifTileSizeWidth,level=y*iiifTileSizeHeight,levelHeight=Math.min(iiifTileSizeWidth,this.width-tileWidth),levelWidth=Math.min(iiifTileSizeHeight,this.height-level),iiifRegion=0===x&&0===y&&levelHeight===this.width&&levelWidth===this.height?"full":[tileWidth,level,levelHeight,levelWidth].join(","),iiifTileSizeWidth=Math.ceil(levelHeight*url),iiifTileSizeHeight=Math.ceil(levelWidth*url),iiifSize=2===this.version&&iiifTileSizeWidth===this.width||3===this.version&&iiifTileSizeWidth===this.width&&iiifTileSizeHeight===this.height?"max":3===this.version?iiifTileSizeWidth+","+iiifTileSizeHeight:iiifTileSizeWidth+","),[this["@id"],iiifRegion,iiifSize,"0",iiifQuality].join("/"))},__testonly__:{canBeTiled:canBeTiled,constructLevels:constructLevels}})}(OpenSeadragon),!function($){$.OsmTileSource=function(width,height,tileSize,tileOverlap,tilesUrl){var options=$.isPlainObject(width)?width:{width:width,height:height,tileSize:tileSize,tileOverlap:tileOverlap,tilesUrl:tilesUrl};options.width&&options.height||(options.width=65572864,options.height=65572864),options.tileSize||(options.tileSize=256,options.tileOverlap=0),options.tilesUrl||(options.tilesUrl="http://tile.openstreetmap.org/"),options.minLevel=8,$.TileSource.apply(this,[options])},$.extend($.OsmTileSource.prototype,$.TileSource.prototype,{supports:function(data,url){return data.type&&"openstreetmaps"==data.type},configure:function(data,url){return data},getTileUrl:function(level,x,y){return this.tilesUrl+(level-8)+"/"+x+"/"+y+".png"}})}(OpenSeadragon),!function($){$.TmsTileSource=function(width,height,tileSize,tileOverlap,tilesUrl){var options=$.isPlainObject(width)?width:{width:width,height:height,tileSize:tileSize,tileOverlap:tileOverlap,tilesUrl:tilesUrl},bufferedWidth=256*Math.ceil(options.width/256),bufferedHeight=256*Math.ceil(options.height/256),max=bufferedHeight<bufferedWidth?bufferedWidth/256:bufferedHeight/256;options.maxLevel=Math.ceil(Math.log(max)/Math.log(2))-1,options.tileSize=256,options.width=bufferedWidth,options.height=bufferedHeight,$.TileSource.apply(this,[options])},$.extend($.TmsTileSource.prototype,$.TileSource.prototype,{supports:function(data,url){return data.type&&"tiledmapservice"==data.type},configure:function(data,url){return data},getTileUrl:function(level,x,y){var yTiles=this.getNumTiles(level).y-1;return this.tilesUrl+level+"/"+x+"/"+(yTiles-y)+".png"}})}(OpenSeadragon),!function($){$.ZoomifyTileSource=function(options){options.tileSize=256;var currentImageSize={x:options.width,y:options.height};for(options.imageSizes=[{x:options.width,y:options.height}],options.gridSize=[this._getGridSize(options.width,options.height,options.tileSize)];parseInt(currentImageSize.x,10)>options.tileSize||parseInt(currentImageSize.y,10)>options.tileSize;)currentImageSize.x=Math.floor(currentImageSize.x/2),currentImageSize.y=Math.floor(currentImageSize.y/2),options.imageSizes.push({x:currentImageSize.x,y:currentImageSize.y}),options.gridSize.push(this._getGridSize(currentImageSize.x,currentImageSize.y,options.tileSize));options.imageSizes.reverse(),options.gridSize.reverse(),options.minLevel=0,options.maxLevel=options.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[options])},$.extend($.ZoomifyTileSource.prototype,$.TileSource.prototype,{_getGridSize:function(width,height,tileSize){return{x:Math.ceil(width/tileSize),y:Math.ceil(height/tileSize)}},_calculateAbsoluteTileNumber:function(level,x,y){for(var num=0,size={},z=0;z<level;z++)num+=(size=this.gridSize[z]).x*size.y;return num+=(size=this.gridSize[level]).x*y+x},supports:function(data,url){return data.type&&"zoomifytileservice"==data.type},configure:function(data,url){return data},getTileUrl:function(level,x,y){var num=this._calculateAbsoluteTileNumber(level,x,y),num=Math.floor(num/256);return this.tilesUrl+"TileGroup"+num+"/"+level+"-"+x+"-"+y+".jpg"}})}(OpenSeadragon),!function($){$.LegacyTileSource=function(levels){var options,width,height;(options=$.isArray(levels)?{type:"legacy-image-pyramid",levels:levels}:options).levels=function(files){var file,i,filtered=[];for(i=0;i<files.length;i++)(file=files[i]).height&&file.width&&file.url?filtered.push({url:file.url,width:Number(file.width),height:Number(file.height)}):$.console.error("Unsupported image format: %s",file.url||"<no URL>");return filtered.sort(function(a,b){return a.height-b.height})}(options.levels),0<options.levels.length?(width=options.levels[options.levels.length-1].width,height=options.levels[options.levels.length-1].height):(height=width=0,$.console.error("No supported image formats found")),$.extend(!0,options,{width:width,height:height,tileSize:Math.max(height,width),tileOverlap:0,minLevel:0,maxLevel:0<options.levels.length?options.levels.length-1:0}),$.TileSource.apply(this,[options]),this.levels=options.levels},$.extend($.LegacyTileSource.prototype,$.TileSource.prototype,{supports:function(data,url){return data.type&&"legacy-image-pyramid"==data.type||data.documentElement&&"legacy-image-pyramid"==data.documentElement.getAttribute("type")},configure:function(configuration,dataUrl){configuration=$.isPlainObject(configuration)?configuration.levels:function(xmlDoc){if(!xmlDoc||!xmlDoc.documentElement)throw new Error($.getString("Errors.Xml"));var level,i,root=xmlDoc.documentElement,rootName=root.tagName,conf=null,levels=[];if("image"==rootName)try{for(conf={type:root.getAttribute("type"),levels:[]},levels=root.getElementsByTagName("level"),i=0;i<levels.length;i++)level=levels[i],conf.levels.push({url:level.getAttribute("url"),width:parseInt(level.getAttribute("width"),10),height:parseInt(level.getAttribute("height"),10)});return conf.levels}catch(e){throw e instanceof Error?e:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==rootName)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==rootName)throw new Error("Error: "+xmlDoc)}throw new Error("Unknown element "+rootName)}(configuration);return configuration},getLevelScale:function(level){var levelScale=NaN;return levelScale=0<this.levels.length&&level>=this.minLevel&&level<=this.maxLevel?this.levels[level].width/this.levels[this.maxLevel].width:levelScale},getNumTiles:function(level){return this.getLevelScale(level)?new $.Point(1,1):new $.Point(0,0)},getTileUrl:function(level,x,y){var url=null;return url=0<this.levels.length&&level>=this.minLevel&&level<=this.maxLevel?this.levels[level].url:url}})}(OpenSeadragon),!function($){$.ImageTileSource=function(options){options=$.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},options),$.TileSource.apply(this,[options])},$.extend($.ImageTileSource.prototype,$.TileSource.prototype,{supports:function(data,url){return data.type&&"image"===data.type},configure:function(options,dataUrl){return options},getImageInfo:function(url){var image=this._image=new Image,_this=this;this.crossOriginPolicy&&(image.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(image.useCredentials=this.ajaxWithCredentials),$.addEvent(image,"load",function(){_this.width=Object.prototype.hasOwnProperty.call(image,"naturalWidth")?image.naturalWidth:image.width,_this.height=Object.prototype.hasOwnProperty.call(image,"naturalHeight")?image.naturalHeight:image.height,_this.aspectRatio=_this.width/_this.height,_this.dimensions=new $.Point(_this.width,_this.height),_this._tileWidth=_this.width,_this._tileHeight=_this.height,_this.tileOverlap=0,_this.minLevel=0,_this.levels=_this._buildLevels(),_this.maxLevel=_this.levels.length-1,_this.ready=!0,_this.raiseEvent("ready",{tileSource:_this})}),$.addEvent(image,"error",function(){_this.raiseEvent("open-failed",{message:"Error loading image at "+url,source:url})}),image.src=url},getLevelScale:function(level){var levelScale=NaN;return levelScale=level>=this.minLevel&&level<=this.maxLevel?this.levels[level].width/this.levels[this.maxLevel].width:levelScale},getNumTiles:function(level){return this.getLevelScale(level)?new $.Point(1,1):new $.Point(0,0)},getTileUrl:function(level,x,y){var url=null;return url=level>=this.minLevel&&level<=this.maxLevel?this.levels[level].url:url},getContext2D:function(level,x,y){var context=null;return context=level>=this.minLevel&&level<=this.maxLevel?this.levels[level].context2D:context},_buildLevels:function(){var levels=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(this.buildPyramid&&$.supportsCanvas&&this.useCanvas){var currentWidth=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,currentHeight=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,bigCanvas=document.createElement("canvas"),bigContext=bigCanvas.getContext("2d");if(bigCanvas.width=currentWidth,bigCanvas.height=currentHeight,bigContext.drawImage(this._image,0,0,currentWidth,currentHeight),levels[0].context2D=bigContext,delete this._image,!$.isCanvasTainted(bigCanvas))for(;2<=currentWidth&&2<=currentHeight;){var currentWidth=Math.floor(currentWidth/2),currentHeight=Math.floor(currentHeight/2),smallCanvas=document.createElement("canvas"),smallContext=smallCanvas.getContext("2d");smallCanvas.width=currentWidth,smallCanvas.height=currentHeight,smallContext.drawImage(bigCanvas,0,0,currentWidth,currentHeight),levels.splice(0,0,{context2D:smallContext,width:currentWidth,height:currentHeight}),bigCanvas=smallCanvas,bigContext=smallContext}}else delete this._image;return levels}})}(OpenSeadragon),!function($){$.TileSourceCollection=function(tileSize,tileSources,rows,layout){$.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),!function($){function scheduleFade(button){$.requestAnimationFrame(function(){!function(button){var currentTime;button.shouldFade&&(currentTime=$.now(),currentTime=currentTime-button.fadeBeginTime,currentTime=1-currentTime/button.fadeLength,currentTime=Math.min(1,currentTime),currentTime=Math.max(0,currentTime),button.imgGroup&&$.setElementOpacity(button.imgGroup,currentTime,!0),0<currentTime)&&scheduleFade(button)}(button)})}function inTo(button,newState){button.element.disabled||(newState>=$.ButtonState.GROUP&&button.currentState==$.ButtonState.REST&&(!function(button){button.shouldFade=!1,button.imgGroup&&$.setElementOpacity(button.imgGroup,1,!0)}(button),button.currentState=$.ButtonState.GROUP),newState>=$.ButtonState.HOVER&&button.currentState==$.ButtonState.GROUP&&(button.imgHover&&(button.imgHover.style.visibility=""),button.currentState=$.ButtonState.HOVER),newState>=$.ButtonState.DOWN&&button.currentState==$.ButtonState.HOVER&&(button.imgDown&&(button.imgDown.style.visibility=""),button.currentState=$.ButtonState.DOWN))}function outTo(button,newState){button.element.disabled||(newState<=$.ButtonState.HOVER&&button.currentState==$.ButtonState.DOWN&&(button.imgDown&&(button.imgDown.style.visibility="hidden"),button.currentState=$.ButtonState.HOVER),newState<=$.ButtonState.GROUP&&button.currentState==$.ButtonState.HOVER&&(button.imgHover&&(button.imgHover.style.visibility="hidden"),button.currentState=$.ButtonState.GROUP),newState<=$.ButtonState.REST&&button.currentState==$.ButtonState.GROUP&&(function(button){button.shouldFade=!0,button.fadeBeginTime=$.now()+button.fadeDelay,window.setTimeout(function(){scheduleFade(button)},button.fadeDelay)}(button),button.currentState=$.ButtonState.REST))}$.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},$.Button=function(options){var _this=this;$.EventSource.call(this),$.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:$.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:$.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},options),this.element=options.element||$.makeNeutralElement("div"),options.element||(this.imgRest=$.makeTransparentImage(this.srcRest),this.imgGroup=$.makeTransparentImage(this.srcGroup),this.imgHover=$.makeTransparentImage(this.srcHover),this.imgDown=$.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",$.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",$.Browser.vendor==$.BROWSERS.FIREFOX&&$.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=$.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new $.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(event){event.insideElementPressed?(inTo(_this,$.ButtonState.DOWN),_this.raiseEvent("enter",{originalEvent:event.originalEvent})):event.buttonDownAny||inTo(_this,$.ButtonState.HOVER)},focusHandler:function(event){this.enterHandler(event),_this.raiseEvent("focus",{originalEvent:event.originalEvent})},exitHandler:function(event){outTo(_this,$.ButtonState.GROUP),event.insideElementPressed&&_this.raiseEvent("exit",{originalEvent:event.originalEvent})},blurHandler:function(event){this.exitHandler(event),_this.raiseEvent("blur",{originalEvent:event.originalEvent})},pressHandler:function(event){inTo(_this,$.ButtonState.DOWN),_this.raiseEvent("press",{originalEvent:event.originalEvent})},releaseHandler:function(event){event.insideElementPressed&&event.insideElementReleased?(outTo(_this,$.ButtonState.HOVER),_this.raiseEvent("release",{originalEvent:event.originalEvent})):event.insideElementPressed?outTo(_this,$.ButtonState.GROUP):inTo(_this,$.ButtonState.HOVER)},clickHandler:function(event){event.quick&&_this.raiseEvent("click",{originalEvent:event.originalEvent})},keyHandler:function(event){return 13!==event.keyCode||(_this.raiseEvent("click",{originalEvent:event.originalEvent}),_this.raiseEvent("release",{originalEvent:event.originalEvent}),!1)}}),outTo(this,$.ButtonState.REST)},$.extend($.Button.prototype,$.EventSource.prototype,{notifyGroupEnter:function(){inTo(this,$.ButtonState.GROUP)},notifyGroupExit:function(){outTo(this,$.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,$.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,$.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),!function($){$.ButtonGroup=function(options){$.extend(!0,this,{buttons:[],clickTimeThreshold:$.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:$.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},options);var i,buttons=this.buttons.concat([]),_this=this;if(this.element=options.element||$.makeNeutralElement("div"),!options.group)for(this.element.style.display="inline-block",i=0;i<buttons.length;i++)this.element.appendChild(buttons[i].element);$.setElementTouchActionNone(this.element),this.tracker=new $.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(event){for(var i=0;i<_this.buttons.length;i++)_this.buttons[i].notifyGroupEnter()},exitHandler:function(event){var i;if(!event.insideElementPressed)for(i=0;i<_this.buttons.length;i++)_this.buttons[i].notifyGroupExit()}})},$.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),!function($){$.Rect=function(x,y,width,height,degrees){var newTopLeft,newWidth;this.x="number"==typeof x?x:0,this.y="number"==typeof y?y:0,this.width="number"==typeof width?width:0,this.height="number"==typeof height?height:0,this.degrees="number"==typeof degrees?degrees:0,this.degrees=$.positiveModulo(this.degrees,360),270<=this.degrees?(newTopLeft=this.getTopRight(),this.x=newTopLeft.x,this.y=newTopLeft.y,newWidth=this.height,this.height=this.width,this.width=newWidth,this.degrees-=270):180<=this.degrees?(newTopLeft=this.getBottomRight(),this.x=newTopLeft.x,this.y=newTopLeft.y,this.degrees-=180):90<=this.degrees&&(newTopLeft=this.getBottomLeft(),this.x=newTopLeft.x,this.y=newTopLeft.y,newWidth=this.height,this.height=this.width,this.width=newWidth,this.degrees-=90)},$.Rect.fromSummits=function(topLeft,topRight,bottomLeft){var width=topLeft.distanceTo(topRight),bottomLeft=topLeft.distanceTo(bottomLeft),topRight=topRight.minus(topLeft),radians=Math.atan(topRight.y/topRight.x);return topRight.x<0?radians+=Math.PI:topRight.y<0&&(radians+=2*Math.PI),new $.Rect(topLeft.x,topLeft.y,width,bottomLeft,radians/Math.PI*180)},$.Rect.prototype={clone:function(){return new $.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new $.Point(this.x,this.y)},getBottomRight:function(){return new $.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new $.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new $.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new $.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new $.Point(this.width,this.height)},equals:function(other){return other instanceof $.Rect&&this.x===other.x&&this.y===other.y&&this.width===other.width&&this.height===other.height&&this.degrees===other.degrees},times:function(factor){return new $.Rect(this.x*factor,this.y*factor,this.width*factor,this.height*factor,this.degrees)},translate:function(delta){return new $.Rect(this.x+delta.x,this.y+delta.y,this.width,this.height,this.degrees)},union:function(rect){var thisBoundingBox=this.getBoundingBox(),rect=rect.getBoundingBox(),left=Math.min(thisBoundingBox.x,rect.x),top=Math.min(thisBoundingBox.y,rect.y),right=Math.max(thisBoundingBox.x+thisBoundingBox.width,rect.x+rect.width),thisBoundingBox=Math.max(thisBoundingBox.y+thisBoundingBox.height,rect.y+rect.height);return new $.Rect(left,top,right-left,thisBoundingBox-top)},intersection:function(rect){for(var EPSILON=1e-10,intersectionPoints=[],thisTopLeft=this.getTopLeft(),thisTopLeft=(rect.containsPoint(thisTopLeft,EPSILON)&&intersectionPoints.push(thisTopLeft),this.getTopRight()),thisTopLeft=(rect.containsPoint(thisTopLeft,EPSILON)&&intersectionPoints.push(thisTopLeft),this.getBottomLeft()),thisTopLeft=(rect.containsPoint(thisTopLeft,EPSILON)&&intersectionPoints.push(thisTopLeft),this.getBottomRight()),thisTopLeft=(rect.containsPoint(thisTopLeft,EPSILON)&&intersectionPoints.push(thisTopLeft),rect.getTopLeft()),thisTopLeft=(this.containsPoint(thisTopLeft,EPSILON)&&intersectionPoints.push(thisTopLeft),rect.getTopRight()),thisTopLeft=(this.containsPoint(thisTopLeft,EPSILON)&&intersectionPoints.push(thisTopLeft),rect.getBottomLeft()),thisTopLeft=(this.containsPoint(thisTopLeft,EPSILON)&&intersectionPoints.push(thisTopLeft),rect.getBottomRight()),thisSegments=(this.containsPoint(thisTopLeft,EPSILON)&&intersectionPoints.push(thisTopLeft),this._getSegments()),rectSegments=rect._getSegments(),i=0;i<thisSegments.length;i++)for(var thisSegment=thisSegments[i],j=0;j<rectSegments.length;j++){var rectSegment=rectSegments[j],rectSegment=function(a,b,c,d){var b=b.minus(a),d=d.minus(c),denom=-d.x*b.y+b.x*d.y;if(0!=denom){var s=(b.x*(a.y-c.y)-b.y*(a.x-c.x))/denom,d=(d.x*(a.y-c.y)-d.y*(a.x-c.x))/denom;if(-EPSILON<=s&&s<=1-EPSILON&&-EPSILON<=d&&d<=1-EPSILON)return new $.Point(a.x+d*b.x,a.y+d*b.y)}return null}(thisSegment[0],thisSegment[1],rectSegment[0],rectSegment[1]);rectSegment&&intersectionPoints.push(rectSegment)}if(0===intersectionPoints.length)return null;for(var minX=intersectionPoints[0].x,maxX=intersectionPoints[0].x,minY=intersectionPoints[0].y,maxY=intersectionPoints[0].y,k=1;k<intersectionPoints.length;k++){var point=intersectionPoints[k];point.x<minX&&(minX=point.x),point.x>maxX&&(maxX=point.x),point.y<minY&&(minY=point.y),point.y>maxY&&(maxY=point.y)}return new $.Rect(minX,minY,maxX-minX,maxY-minY)},_getSegments:function(){var topLeft=this.getTopLeft(),topRight=this.getTopRight(),bottomLeft=this.getBottomLeft(),bottomRight=this.getBottomRight();return[[topLeft,topRight],[topRight,bottomRight],[bottomRight,bottomLeft],[bottomLeft,topLeft]]},rotate:function(degrees,pivot){if(0===(degrees=$.positiveModulo(degrees,360)))return this.clone();pivot=pivot||this.getCenter();var newTopLeft=this.getTopLeft().rotate(degrees,pivot),degrees=(degrees=this.getTopRight().rotate(degrees,pivot).minus(newTopLeft)).apply(function(x){return Math.abs(x)<1e-15?0:x}),pivot=Math.atan(degrees.y/degrees.x);return degrees.x<0?pivot+=Math.PI:degrees.y<0&&(pivot+=2*Math.PI),new $.Rect(newTopLeft.x,newTopLeft.y,this.width,this.height,pivot/Math.PI*180)},getBoundingBox:function(){var topRight,bottomLeft,bottomRight,minX,maxX,minY,topLeft;return 0===this.degrees?this.clone():(topLeft=this.getTopLeft(),topRight=this.getTopRight(),bottomLeft=this.getBottomLeft(),bottomRight=this.getBottomRight(),minX=Math.min(topLeft.x,topRight.x,bottomLeft.x,bottomRight.x),maxX=Math.max(topLeft.x,topRight.x,bottomLeft.x,bottomRight.x),minY=Math.min(topLeft.y,topRight.y,bottomLeft.y,bottomRight.y),topLeft=Math.max(topLeft.y,topRight.y,bottomLeft.y,bottomRight.y),new $.Rect(minX,minY,maxX-minX,topLeft-minY))},getIntegerBoundingBox:function(){var boundingBox=this.getBoundingBox(),x=Math.floor(boundingBox.x),y=Math.floor(boundingBox.y),width=Math.ceil(boundingBox.width+boundingBox.x-x),boundingBox=Math.ceil(boundingBox.height+boundingBox.y-y);return new $.Rect(x,y,width,boundingBox)},containsPoint:function(point,epsilon){epsilon=epsilon||0;var topLeft=this.getTopLeft(),topRight=this.getTopRight(),bottomLeft=this.getBottomLeft(),topDiff=topRight.minus(topLeft),leftDiff=bottomLeft.minus(topLeft);return(point.x-topLeft.x)*topDiff.x+(point.y-topLeft.y)*topDiff.y>=-epsilon&&(point.x-topRight.x)*topDiff.x+(point.y-topRight.y)*topDiff.y<=epsilon&&(point.x-topLeft.x)*leftDiff.x+(point.y-topLeft.y)*leftDiff.y>=-epsilon&&(point.x-bottomLeft.x)*leftDiff.x+(point.y-bottomLeft.y)*leftDiff.y<=epsilon},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),!function($){var THIS={};function onStripDrag(event){var offsetLeft=Number(this.element.style.marginLeft.replace("px","")),offsetTop=Number(this.element.style.marginTop.replace("px","")),scrollWidth=Number(this.element.style.width.replace("px","")),scrollHeight=Number(this.element.style.height.replace("px","")),viewerSize=$.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?0<-event.delta.x?offsetLeft>-(scrollWidth-viewerSize.x)&&(this.element.style.marginLeft=offsetLeft+2*event.delta.x+"px",loadPanels(this,viewerSize.x,offsetLeft+2*event.delta.x)):-event.delta.x<0&&offsetLeft<0&&(this.element.style.marginLeft=offsetLeft+2*event.delta.x+"px",loadPanels(this,viewerSize.x,offsetLeft+2*event.delta.x)):0<-event.delta.y?offsetTop>-(scrollHeight-viewerSize.y)&&(this.element.style.marginTop=offsetTop+2*event.delta.y+"px",loadPanels(this,viewerSize.y,offsetTop+2*event.delta.y)):-event.delta.y<0&&offsetTop<0&&(this.element.style.marginTop=offsetTop+2*event.delta.y+"px",loadPanels(this,viewerSize.y,offsetTop+2*event.delta.y))),!1}function onStripScroll(event){var offsetLeft=Number(this.element.style.marginLeft.replace("px","")),offsetTop=Number(this.element.style.marginTop.replace("px","")),scrollWidth=Number(this.element.style.width.replace("px","")),scrollHeight=Number(this.element.style.height.replace("px","")),viewerSize=$.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?0<event.scroll?offsetLeft>-(scrollWidth-viewerSize.x)&&(this.element.style.marginLeft=offsetLeft-60*event.scroll+"px",loadPanels(this,viewerSize.x,offsetLeft-60*event.scroll)):event.scroll<0&&offsetLeft<0&&(this.element.style.marginLeft=offsetLeft-60*event.scroll+"px",loadPanels(this,viewerSize.x,offsetLeft-60*event.scroll)):event.scroll<0?offsetTop>viewerSize.y-scrollHeight&&(this.element.style.marginTop=offsetTop+60*event.scroll+"px",loadPanels(this,viewerSize.y,offsetTop+60*event.scroll)):0<event.scroll&&offsetTop<0&&(this.element.style.marginTop=offsetTop+60*event.scroll+"px",loadPanels(this,viewerSize.y,offsetTop+60*event.scroll))),!1}function loadPanels(strip,viewerSize,scroll){for(var style,originalTileSource,element,panelSize="horizontal"==strip.scroll?strip.panelWidth:strip.panelHeight,activePanelsStart=Math.ceil(viewerSize/panelSize)+5,activePanelsEnd=Math.ceil((Math.abs(scroll)+viewerSize)/panelSize)+1,i=(activePanelsStart=activePanelsEnd-activePanelsStart)<0?0:activePanelsStart;i<activePanelsEnd&&i<strip.panels.length;i++)(element=strip.panels[i]).activePanel||(originalTileSource=(originalTileSource=strip.viewer.tileSources[i]).referenceStripThumbnailUrl?{type:"image",url:originalTileSource.referenceStripThumbnailUrl}:originalTileSource,(originalTileSource=new $.Viewer({id:element.id,tileSources:[originalTileSource],element:element,navigatorSizeRatio:strip.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:strip.viewer.loadTilesWithAjax,ajaxHeaders:strip.viewer.ajaxHeaders,useCanvas:strip.useCanvas})).displayRegion=$.makeNeutralElement("div"),originalTileSource.displayRegion.id=element.id+"-displayregion",originalTileSource.displayRegion.className="displayregion",(style=originalTileSource.displayRegion.style).position="relative",style.top="0px",style.left="0px",style.fontSize="0px",style.overflow="hidden",style.float="left",style.cssFloat="left",style.styleFloat="left",style.zIndex=999999999,style.cursor="default",style.width=strip.panelWidth-4+"px",style.height=strip.panelHeight-4+"px",originalTileSource.displayRegion.innerTracker=new $.MouseTracker({element:originalTileSource.displayRegion,startDisabled:!0}),element.getElementsByTagName("div")[0].appendChild(originalTileSource.displayRegion),strip.miniViewers[element.id]=originalTileSource,element.activePanel=!0)}function onStripEnter(event){event=event.eventSource.element;return"horizontal"==this.scroll?event.style.marginBottom="0px":event.style.marginLeft="0px",!1}function onStripExit(event){event=event.eventSource.element;return"horizontal"==this.scroll?event.style.marginBottom="-"+$.getElementSize(event).y/2+"px":event.style.marginLeft="-"+$.getElementSize(event).x/2+"px",!1}function onKeyDown(event){if(event.preventDefaultAction||event.ctrl||event.alt||event.meta)return!0;switch(event.keyCode){case 38:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:case 37:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}function onKeyPress(event){if(event.preventDefaultAction||event.ctrl||event.alt||event.meta)return!0;switch(event.keyCode){case 61:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:case 97:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}$.ReferenceStrip=function(options){var element,style,i,viewer=options.viewer,viewerSize=$.getElementSize(viewer.element);for(options.id||(options.id="referencestrip-"+$.now(),this.element=$.makeNeutralElement("div"),this.element.id=options.id,this.element.className="referencestrip"),options=$.extend(!0,{sizeRatio:$.DEFAULT_SETTINGS.referenceStripSizeRatio,position:$.DEFAULT_SETTINGS.referenceStripPosition,scroll:$.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:$.DEFAULT_SETTINGS.clickTimeThreshold},options,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),$.extend(this,options),THIS[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,(style=this.element.style).marginTop="0px",style.marginRight="0px",style.marginBottom="0px",style.marginLeft="0px",style.left="0px",style.bottom="0px",style.border="0px",style.background="#000",style.position="relative",$.setElementTouchActionNone(this.element),$.setElementOpacity(this.element,.8),this.viewer=viewer,this.innerTracker=new $.MouseTracker({element:this.element,dragHandler:$.delegate(this,onStripDrag),scrollHandler:$.delegate(this,onStripScroll),enterHandler:$.delegate(this,onStripEnter),exitHandler:$.delegate(this,onStripExit),keyDownHandler:$.delegate(this,onKeyDown),keyHandler:$.delegate(this,onKeyPress)}),options.width&&options.height?(this.element.style.width=options.width+"px",this.element.style.height=options.height+"px",viewer.addControl(this.element,{anchor:$.ControlAnchor.BOTTOM_LEFT})):"horizontal"==options.scroll?(this.element.style.width=viewerSize.x*options.sizeRatio*viewer.tileSources.length+12*viewer.tileSources.length+"px",this.element.style.height=viewerSize.y*options.sizeRatio+"px",viewer.addControl(this.element,{anchor:$.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=viewerSize.y*options.sizeRatio*viewer.tileSources.length+12*viewer.tileSources.length+"px",this.element.style.width=viewerSize.x*options.sizeRatio+"px",viewer.addControl(this.element,{anchor:$.ControlAnchor.TOP_LEFT})),this.panelWidth=viewerSize.x*this.sizeRatio+8,this.panelHeight=viewerSize.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},i=0;i<viewer.tileSources.length;i++)(element=$.makeNeutralElement("div")).id=this.element.id+"-"+i,element.style.width=this.panelWidth+"px",element.style.height=this.panelHeight+"px",element.style.display="inline",element.style.float="left",element.style.cssFloat="left",element.style.styleFloat="left",element.style.padding="2px",$.setElementTouchActionNone(element),element.innerTracker=new $.MouseTracker({element:element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(event){event.eventSource.dragging=$.now()},releaseHandler:function(event){var tracker=event.eventSource,id=tracker.element.id,id=Number(id.split("-")[2]),now=$.now();event.insideElementPressed&&event.insideElementReleased&&tracker.dragging&&now-tracker.dragging<tracker.clickTimeThreshold&&(tracker.dragging=null,viewer.goToPage(id))}}),this.element.appendChild(element),element.activePanel=!1,this.panels.push(element);loadPanels(this,"vertical"==this.scroll?viewerSize.y:viewerSize.x,0),this.setFocus(0)},$.extend($.ReferenceStrip.prototype,$.EventSource.prototype,$.Viewer.prototype,{setFocus:function(page){var offset,element=this.element.querySelector("#"+this.element.id+"-"+page),viewerSize=$.getElementSize(this.viewer.canvas),scrollWidth=Number(this.element.style.width.replace("px","")),scrollHeight=Number(this.element.style.height.replace("px","")),offsetLeft=-Number(this.element.style.marginLeft.replace("px","")),offsetTop=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==element&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=element,this.currentSelected.style.background="#999","horizontal"==this.scroll?(offset=Number(page)*(this.panelWidth+3))>offsetLeft+viewerSize.x-this.panelWidth?(offset=Math.min(offset,scrollWidth-viewerSize.x),this.element.style.marginLeft=-offset+"px",loadPanels(this,viewerSize.x,-offset)):offset<offsetLeft&&(offset=Math.max(0,offset-viewerSize.x/2),this.element.style.marginLeft=-offset+"px",loadPanels(this,viewerSize.x,-offset)):(offset=Number(page)*(this.panelHeight+3))>offsetTop+viewerSize.y-this.panelHeight?(offset=Math.min(offset,scrollHeight-viewerSize.y),this.element.style.marginTop=-offset+"px",loadPanels(this,viewerSize.y,-offset)):offset<offsetTop&&(offset=Math.max(0,offset-viewerSize.y/2),this.element.style.marginTop=-offset+"px",loadPanels(this,viewerSize.y,-offset)),this.currentPage=page,onStripEnter.call(this,{eventSource:this.innerTracker}))},update:function(){return!!THIS[this.id].animating&&($.console.log("image reference strip update"),!0)},destroy:function(){if(this.miniViewers)for(var key in this.miniViewers)this.miniViewers[key].destroy();this.element&&this.element.parentNode.removeChild(this.element)}})}(OpenSeadragon),!function($){$.DisplayRect=function(x,y,width,height,minLevel,maxLevel){$.Rect.apply(this,[x,y,width,height]),this.minLevel=minLevel,this.maxLevel=maxLevel},$.extend($.DisplayRect.prototype,$.Rect.prototype)}(OpenSeadragon),!function($){$.Spring=function(options){var args=arguments;"object"!=typeof options&&(options={initial:args.length&&"number"==typeof args[0]?args[0]:void 0,springStiffness:1<args.length?args[1].springStiffness:5,animationTime:1<args.length?args[1].animationTime:1.5}),$.console.assert("number"==typeof options.springStiffness&&0!==options.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),$.console.assert("number"==typeof options.animationTime&&0<=options.animationTime,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),options.exponential&&(this._exponential=!0,delete options.exponential),$.extend(!0,this,options),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:$.now()},$.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},$.Spring.prototype={resetTo:function(target){$.console.assert(!this._exponential||0!==target,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=target,this.start.time=this.target.time=this.current.time=$.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(target){$.console.assert(!this._exponential||0!==target,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=target,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(delta){this.start.value+=delta,this.target.value+=delta,this._exponential&&($.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(value){this._exponential=value,this._exponential&&($.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=$.now(),targetValue=this._exponential?(startValue=this.start._logValue,this.target._logValue):(startValue=this.start.value,this.target.value);var startValue,targetValue=this.current.time>=this.target.time?targetValue:startValue+(targetValue-startValue)*(targetValue=this.springStiffness,startValue=(this.current.time-this.start.time)/(this.target.time-this.start.time),(1-Math.exp(targetValue*-startValue))/(1-Math.exp(-targetValue))),oldValue=this.current.value;return this._exponential?this.current.value=Math.exp(targetValue):this.current.value=targetValue,oldValue!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),!function($){function ImageJob(options){$.extend(!0,this,{timeout:$.DEFAULT_SETTINGS.timeout,jobId:null},options),this.image=null}ImageJob.prototype={errorMsg:null,start:function(){var self=this,selfAbort=this.abort;this.image=new Image,this.image.onload=function(){self.finish(!0)},this.image.onabort=this.image.onerror=function(){self.errorMsg="Image load aborted",self.finish(!1)},this.jobId=window.setTimeout(function(){self.errorMsg="Image load exceeded timeout ("+self.timeout+" ms)",self.finish(!1)},this.timeout),this.loadWithAjax?(this.request=$.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(request){var blb;try{blb=new window.Blob([request.response])}catch(e){var BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;"TypeError"===e.name&&BlobBuilder&&((BlobBuilder=new BlobBuilder).append(request.response),blb=BlobBuilder.getBlob())}0===blb.size&&(self.errorMsg="Empty image response.",self.finish(!1));request=(window.URL||window.webkitURL).createObjectURL(blb);self.image.src=request},error:function(request){self.errorMsg="Image load aborted - XHR error",self.finish(!1)}}),this.abort=function(){self.request.abort(),"function"==typeof selfAbort&&selfAbort()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(successful){this.image.onload=this.image.onerror=this.image.onabort=null,successful||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},$.ImageLoader=function(options){$.extend(!0,this,{jobLimit:$.DEFAULT_SETTINGS.imageLoaderLimit,timeout:$.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},options)},$.ImageLoader.prototype={addJob:function(options){var _this=this,newJob=new ImageJob({src:options.src,loadWithAjax:options.loadWithAjax,ajaxHeaders:options.loadWithAjax?options.ajaxHeaders:null,crossOriginPolicy:options.crossOriginPolicy,ajaxWithCredentials:options.ajaxWithCredentials,callback:function(job){!function(loader,job,callback){loader.jobsInProgress--,(!loader.jobLimit||loader.jobsInProgress<loader.jobLimit)&&0<loader.jobQueue.length&&(loader.jobQueue.shift().start(),loader.jobsInProgress++);callback(job.image,job.errorMsg,job.request)}(_this,job,options.callback)},abort:options.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(newJob.start(),this.jobsInProgress++):this.jobQueue.push(newJob)},clear:function(){for(var i=0;i<this.jobQueue.length;i++){var job=this.jobQueue[i];"function"==typeof job.abort&&job.abort()}this.jobQueue=[]}}}(OpenSeadragon),!function($){$.Tile=function(level,x,y,bounds,exists,url,context2D,loadWithAjax,ajaxHeaders,sourceBounds){this.level=level,this.x=x,this.y=y,this.bounds=bounds,this.sourceBounds=sourceBounds,this.exists=exists,this.url=url,this.context2D=context2D,this.loadWithAjax=loadWithAjax,this.ajaxHeaders=ajaxHeaders,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},$.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(container){this.cacheImageRecord?this.loaded?(this.element||(this.element=$.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=container&&container.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",$.setElementOpacity(this.element,this.opacity)):$.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):$.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(context,drawingHandler,scale,translate){var sourceWidth,rendered,position=this.position.times($.pixelDensityRatio),size=this.size.times($.pixelDensityRatio);this.context2D||this.cacheImageRecord?(rendered=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&rendered?(context.save(),context.globalAlpha=this.opacity,"number"==typeof scale&&1!==scale&&(position=position.times(scale),size=size.times(scale)),translate instanceof $.Point&&(position=position.plus(translate)),1===context.globalAlpha&&this._hasTransparencyChannel()&&context.clearRect(position.x,position.y,size.x,size.y),drawingHandler({context:context,tile:this,rendered:rendered}),scale=this.sourceBounds?(sourceWidth=Math.min(this.sourceBounds.width,rendered.canvas.width),Math.min(this.sourceBounds.height,rendered.canvas.height)):(sourceWidth=rendered.canvas.width,rendered.canvas.height),context.drawImage(rendered.canvas,0,0,sourceWidth,scale,position.x,position.y,size.x,size.y),context.restore()):$.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):$.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var context;if(this.cacheImageRecord)context=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return $.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;context=this.context2D}return context.canvas.width/(this.size.x*$.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(scale,canvasSize,sketchCanvasSize){var x=Math.max(1,Math.ceil((sketchCanvasSize.x-canvasSize.x)/2)),sketchCanvasSize=Math.max(1,Math.ceil((sketchCanvasSize.y-canvasSize.y)/2));return new $.Point(x,sketchCanvasSize).minus(this.position.times($.pixelDensityRatio).times(scale||1).apply(function(x){return x%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),!function($){$.OverlayPlacement=$.Placement,$.OverlayRotationMode=$.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),$.Overlay=function(element,location,placement){element=$.isPlainObject(element)?element:{element:element,location:location,placement:placement};this.element=element.element,this.style=element.element.style,this._init(element)},$.Overlay.prototype={_init:function(options){this.location=options.location,this.placement=void 0===options.placement?$.Placement.TOP_LEFT:options.placement,this.onDraw=options.onDraw,this.checkResize=void 0===options.checkResize||options.checkResize,this.width=void 0===options.width?null:options.width,this.height=void 0===options.height?null:options.height,this.rotationMode=options.rotationMode||$.OverlayRotationMode.EXACT,this.location instanceof $.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=$.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new $.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(position,size){var properties=$.Placement.properties[this.placement];properties&&(properties.isHorizontallyCentered?position.x-=size.x/2:properties.isRight&&(position.x-=size.x),properties.isVerticallyCentered?position.y-=size.y/2:properties.isBottom&&(position.y-=size.y))},destroy:function(){var element=this.element,style=this.style,element=(element.parentNode&&(element.parentNode.removeChild(element),element.prevElementParent)&&(style.display="none",document.body.appendChild(element)),this.onDraw=null,style.top="",style.left="",style.position="",null!==this.width&&(style.width=""),null!==this.height&&(style.height=""),$.getCssPropertyWithVendorPrefix("transformOrigin")),transformProp=$.getCssPropertyWithVendorPrefix("transform");element&&transformProp&&(style[element]="",style[transformProp]="")},drawHTML:function(container,viewport){var style,element=this.element,container=(element.parentNode!==container&&(element.prevElementParent=element.parentNode,element.prevNextSibling=element.nextSibling,container.appendChild(element),this.style.position="absolute",this.size=$.getElementSize(element)),this._getOverlayPositionAndSize(viewport)),element=container.position,viewport=this.size=container.size,container=container.rotate;this.onDraw?this.onDraw(element,viewport,this.element):((style=this.style).left=element.x+"px",style.top=element.y+"px",null!==this.width&&(style.width=viewport.x+"px"),null!==this.height&&(style.height=viewport.y+"px"),element=$.getCssPropertyWithVendorPrefix("transformOrigin"),viewport=$.getCssPropertyWithVendorPrefix("transform"),element&&viewport&&(container?(style[element]=this._getTransformOrigin(),style[viewport]="rotate("+container+"deg)"):(style[element]="",style[viewport]="")),"none"!==style.display&&(style.display="block"))},_getOverlayPositionAndSize:function(viewport){var rect,position=viewport.pixelFromPoint(this.location,!0),size=this._getSizeInPixels(viewport),rotate=(this.adjust(position,size),0);return viewport.degrees&&this.rotationMode!==$.OverlayRotationMode.NO_ROTATION&&(this.rotationMode===$.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height?(rect=new $.Rect(position.x,position.y,size.x,size.y),position=(rect=this._getBoundingBox(rect,viewport.degrees)).getTopLeft(),size=rect.getSize()):rotate=viewport.degrees),{position:position,size:size,rotate:rotate}},_getSizeInPixels:function(viewport){var width=this.size.x,height=this.size.y;return null===this.width&&null===this.height||(viewport=viewport.deltaPixelsFromPointsNoRotate(new $.Point(this.width||0,this.height||0),!0),null!==this.width&&(width=viewport.x),null!==this.height&&(height=viewport.y)),!this.checkResize||null!==this.width&&null!==this.height||(viewport=this.size=$.getElementSize(this.element),null===this.width&&(width=viewport.x),null===this.height&&(height=viewport.y)),new $.Point(width,height)},_getBoundingBox:function(rect,degrees){var refPoint=this._getPlacementPoint(rect);return rect.rotate(degrees,refPoint).getBoundingBox()},_getPlacementPoint:function(rect){var result=new $.Point(rect.x,rect.y),properties=$.Placement.properties[this.placement];return properties&&(properties.isHorizontallyCentered?result.x+=rect.width/2:properties.isRight&&(result.x+=rect.width),properties.isVerticallyCentered?result.y+=rect.height/2:properties.isBottom&&(result.y+=rect.height)),result},_getTransformOrigin:function(){var result="",properties=$.Placement.properties[this.placement];return properties&&(properties.isLeft?result="left":properties.isRight&&(result="right"),properties.isTop?result+=" top":properties.isBottom&&(result+=" bottom")),result},update:function(location,placement){location=$.isPlainObject(location)?location:{location:location,placement:placement};this._init({location:location.location||this.location,placement:(void 0!==location.placement?location:this).placement,onDraw:location.onDraw||this.onDraw,checkResize:location.checkResize||this.checkResize,width:(void 0!==location.width?location:this).width,height:(void 0!==location.height?location:this).height,rotationMode:location.rotationMode||this.rotationMode})},getBounds:function(viewport){$.console.assert(viewport,"A viewport must now be passed to Overlay.getBounds.");var width=this.width,height=this.height,size=(null!==width&&null!==height||(size=viewport.deltaPointsFromPixelsNoRotate(this.size,!0),null===width&&(width=size.x),null===height&&(height=size.y)),this.location.clone());return this.adjust(size,new $.Point(width,height)),this._adjustBoundsForRotation(viewport,new $.Rect(size.x,size.y,width,height))},_adjustBoundsForRotation:function(viewport,bounds){var positionAndSize;return viewport&&0!==viewport.degrees&&this.rotationMode!==$.OverlayRotationMode.EXACT?this.rotationMode===$.OverlayRotationMode.BOUNDING_BOX?null===this.width||null===this.height?bounds:(positionAndSize=this._getOverlayPositionAndSize(viewport),viewport.viewerElementToViewportRectangle(new $.Rect(positionAndSize.position.x,positionAndSize.position.y,positionAndSize.size.x,positionAndSize.size.y))):bounds.rotate(-viewport.degrees,this._getPlacementPoint(bounds)):bounds}}}(OpenSeadragon),!function($){$.Drawer=function(options){$.console.assert(options.viewer,"[Drawer] options.viewer is required");var args=arguments;$.isPlainObject(options)||(options={source:args[0],viewport:args[1],element:args[2]}),$.console.assert(options.viewport,"[Drawer] options.viewport is required"),$.console.assert(options.element,"[Drawer] options.element is required"),options.source&&$.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=options.viewer,this.viewport=options.viewport,this.debugGridColor="string"==typeof options.debugGridColor?[options.debugGridColor]:options.debugGridColor||$.DEFAULT_SETTINGS.debugGridColor,options.opacity&&$.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=$.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=$.getElement(options.element),this.canvas=$.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas&&(args=this._calculateCanvasSize(),this.canvas.width=args.x,this.canvas.height=args.y),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",$.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},$.Drawer.prototype={addOverlay:function(element,location,placement,onDraw){return $.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(element,location,placement,onDraw),this},updateOverlay:function(element,location,placement){return $.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(element,location,placement),this},removeOverlay:function(element){return $.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(element),this},clearOverlays:function(){return $.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(point){point=this.viewport.pixelFromPointNoRotate(point,!0);return new $.Point(point.x*$.pixelDensityRatio,point.y*$.pixelDensityRatio)},clipWithPolygons:function(polygons,useSketch){var context;this.useCanvas&&((context=this._getContext(useSketch)).beginPath(),polygons.forEach(function(polygon){polygon.forEach(function(coord,i){context[0===i?"moveTo":"lineTo"](coord.x,coord.y)})}),context.clip())},setOpacity:function(opacity){$.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var world=this.viewer.world,i=0;i<world.getItemCount();i++)world.getItemAt(i).setOpacity(opacity);return this},getOpacity:function(){$.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var world=this.viewer.world,maxOpacity=0,i=0;i<world.getItemCount();i++){var opacity=world.getItemAt(i).getOpacity();maxOpacity<opacity&&(maxOpacity=opacity)}return maxOpacity},needsUpdate:function(){return $.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return $.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return $.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return $.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){var viewportSize;this.canvas.innerHTML="",this.useCanvas&&(viewportSize=this._calculateCanvasSize(),this.canvas.width==viewportSize.x&&this.canvas.height==viewportSize.y||(this.canvas.width=viewportSize.x,this.canvas.height=viewportSize.y,this._updateImageSmoothingEnabled(this.context),null!==this.sketchCanvas&&(viewportSize=this._calculateSketchCanvasSize(),this.sketchCanvas.width=viewportSize.x,this.sketchCanvas.height=viewportSize.y,this._updateImageSmoothingEnabled(this.sketchContext))),this._clear())},_clear:function(useSketch,bounds){this.useCanvas&&(useSketch=this._getContext(useSketch),bounds?useSketch.clearRect(bounds.x,bounds.y,bounds.width,bounds.height):(bounds=useSketch.canvas,useSketch.clearRect(0,0,bounds.width,bounds.height)))},viewportToDrawerRectangle:function(rectangle){var topLeft=this.viewport.pixelFromPointNoRotate(rectangle.getTopLeft(),!0),rectangle=this.viewport.deltaPixelsFromPointsNoRotate(rectangle.getSize(),!0);return new $.Rect(topLeft.x*$.pixelDensityRatio,topLeft.y*$.pixelDensityRatio,rectangle.x*$.pixelDensityRatio,rectangle.y*$.pixelDensityRatio)},drawTile:function(tile,drawingHandler,useSketch,scale,translate){$.console.assert(tile,"[Drawer.drawTile] tile is required"),$.console.assert(drawingHandler,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas?(useSketch=this._getContext(useSketch),tile.drawCanvas(useSketch,drawingHandler,scale=scale||1,translate)):tile.drawHTML(this.canvas)},_getContext:function(useSketch){var self,context=this.context;return useSketch&&(null===this.sketchCanvas&&(this.sketchCanvas=document.createElement("canvas"),useSketch=this._calculateSketchCanvasSize(),this.sketchCanvas.width=useSketch.x,this.sketchCanvas.height=useSketch.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()&&(self=this).viewer.addHandler("rotate",function resizeSketchCanvas(){var sketchCanvasSize;0!==self.viewport.getRotation()&&(self.viewer.removeHandler("rotate",resizeSketchCanvas),sketchCanvasSize=self._calculateSketchCanvasSize(),self.sketchCanvas.width=sketchCanvasSize.x,self.sketchCanvas.height=sketchCanvasSize.y)}),this._updateImageSmoothingEnabled(this.sketchContext)),context=this.sketchContext),context},saveContext:function(useSketch){this.useCanvas&&this._getContext(useSketch).save()},restoreContext:function(useSketch){this.useCanvas&&this._getContext(useSketch).restore()},setClip:function(rect,useSketch){this.useCanvas&&((useSketch=this._getContext(useSketch)).beginPath(),useSketch.rect(rect.x,rect.y,rect.width,rect.height),useSketch.clip())},drawRectangle:function(rect,fillStyle,useSketch){this.useCanvas&&((useSketch=this._getContext(useSketch)).save(),useSketch.fillStyle=fillStyle,useSketch.fillRect(rect.x,rect.y,rect.width,rect.height),useSketch.restore())},blendSketch:function(opacity,scale,translate,compositeOperation){var bounds,options=opacity;$.isPlainObject(options)||(options={opacity:opacity,scale:scale,translate:translate,compositeOperation:compositeOperation}),this.useCanvas&&this.sketchCanvas&&(opacity=options.opacity,compositeOperation=options.compositeOperation,bounds=options.bounds,this.context.save(),this.context.globalAlpha=opacity,compositeOperation&&(this.context.globalCompositeOperation=compositeOperation),bounds?(bounds.x<0&&(bounds.width+=bounds.x,bounds.x=0),bounds.x+bounds.width>this.canvas.width&&(bounds.width=this.canvas.width-bounds.x),bounds.y<0&&(bounds.height+=bounds.y,bounds.y=0),bounds.y+bounds.height>this.canvas.height&&(bounds.height=this.canvas.height-bounds.y),this.context.drawImage(this.sketchCanvas,bounds.x,bounds.y,bounds.width,bounds.height,bounds.x,bounds.y,bounds.width,bounds.height)):(scale=options.scale||1,opacity=(translate=options.translate)instanceof $.Point?translate:new $.Point(0,0),bounds=compositeOperation=0,translate&&(options=this.sketchCanvas.width-this.canvas.width,translate=this.sketchCanvas.height-this.canvas.height,compositeOperation=Math.round(options/2),bounds=Math.round(translate/2)),this.context.drawImage(this.sketchCanvas,opacity.x-compositeOperation*scale,opacity.y-bounds*scale,(this.canvas.width+2*compositeOperation)*scale,(this.canvas.height+2*bounds)*scale,-compositeOperation,-bounds,this.canvas.width+2*compositeOperation,this.canvas.height+2*bounds)),this.context.restore())},drawDebugInfo:function(tile,count,i,tiledImage){var context,colorIndex,tileCenterY;this.useCanvas&&(colorIndex=this.viewer.world.getIndexOfItem(tiledImage)%this.debugGridColor.length,(context=this.context).save(),context.lineWidth=2*$.pixelDensityRatio,context.font="small-caps bold "+13*$.pixelDensityRatio+"px arial",context.strokeStyle=this.debugGridColor[colorIndex],context.fillStyle=this.debugGridColor[colorIndex],0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),tiledImage.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:tiledImage.getRotation(!0),point:tiledImage.viewport.pixelFromPointNoRotate(tiledImage._getRotationPoint(!0),!0)}),0===tiledImage.viewport.degrees&&tiledImage.getRotation(!0)%360==0&&tiledImage._drawer.viewer.viewport.getFlip()&&tiledImage._drawer._flip(),context.strokeRect(tile.position.x*$.pixelDensityRatio,tile.position.y*$.pixelDensityRatio,tile.size.x*$.pixelDensityRatio,tile.size.y*$.pixelDensityRatio),colorIndex=(tile.position.x+tile.size.x/2)*$.pixelDensityRatio,tileCenterY=(tile.position.y+tile.size.y/2)*$.pixelDensityRatio,context.translate(colorIndex,tileCenterY),context.rotate(Math.PI/180*-this.viewport.degrees),context.translate(-colorIndex,-tileCenterY),0===tile.x&&0===tile.y&&(context.fillText("Zoom: "+this.viewport.getZoom(),tile.position.x*$.pixelDensityRatio,(tile.position.y-30)*$.pixelDensityRatio),context.fillText("Pan: "+this.viewport.getBounds().toString(),tile.position.x*$.pixelDensityRatio,(tile.position.y-20)*$.pixelDensityRatio)),context.fillText("Level: "+tile.level,(tile.position.x+10)*$.pixelDensityRatio,(tile.position.y+20)*$.pixelDensityRatio),context.fillText("Column: "+tile.x,(tile.position.x+10)*$.pixelDensityRatio,(tile.position.y+30)*$.pixelDensityRatio),context.fillText("Row: "+tile.y,(tile.position.x+10)*$.pixelDensityRatio,(tile.position.y+40)*$.pixelDensityRatio),context.fillText("Order: "+i+" of "+count,(tile.position.x+10)*$.pixelDensityRatio,(tile.position.y+50)*$.pixelDensityRatio),context.fillText("Size: "+tile.size.toString(),(tile.position.x+10)*$.pixelDensityRatio,(tile.position.y+60)*$.pixelDensityRatio),context.fillText("Position: "+tile.position.toString(),(tile.position.x+10)*$.pixelDensityRatio,(tile.position.y+70)*$.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),tiledImage.getRotation(!0)%360!=0&&this._restoreRotationChanges(),0===tiledImage.viewport.degrees&&tiledImage.getRotation(!0)%360==0&&tiledImage._drawer.viewer.viewport.getFlip()&&tiledImage._drawer._flip(),context.restore())},debugRect:function(rect){var context;this.useCanvas&&((context=this.context).save(),context.lineWidth=2*$.pixelDensityRatio,context.strokeStyle=this.debugGridColor[0],context.fillStyle=this.debugGridColor[0],context.strokeRect(rect.x*$.pixelDensityRatio,rect.y*$.pixelDensityRatio,rect.width*$.pixelDensityRatio,rect.height*$.pixelDensityRatio),context.restore())},setImageSmoothingEnabled:function(imageSmoothingEnabled){this.useCanvas&&(this._imageSmoothingEnabled=imageSmoothingEnabled,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(context){context.msImageSmoothingEnabled=this._imageSmoothingEnabled,context.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(sketch){sketch=this._getContext(sketch).canvas;return new $.Point(sketch.width,sketch.height)},getCanvasCenter:function(){return new $.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(options){var point=options.point?options.point.times($.pixelDensityRatio):this.getCanvasCenter(),context=this._getContext(options.useSketch);context.save(),context.translate(point.x,point.y),this.viewer.viewport.flipped?(context.rotate(Math.PI/180*-options.degrees),context.scale(-1,1)):context.rotate(Math.PI/180*options.degrees),context.translate(-point.x,-point.y)},_flip:function(options){var point=(options=options||{}).point?options.point.times($.pixelDensityRatio):this.getCanvasCenter(),options=this._getContext(options.useSketch);options.translate(point.x,0),options.scale(-1,1),options.translate(-point.x,0)},_restoreRotationChanges:function(useSketch){this._getContext(useSketch).restore()},_calculateCanvasSize:function(){var pixelDensityRatio=$.pixelDensityRatio,viewportSize=this.viewport.getContainerSize();return{x:Math.round(viewportSize.x*pixelDensityRatio),y:Math.round(viewportSize.y*pixelDensityRatio)}},_calculateSketchCanvasSize:function(){var canvasSize=this._calculateCanvasSize();return 0===this.viewport.getRotation()?canvasSize:{x:canvasSize=Math.ceil(Math.sqrt(canvasSize.x*canvasSize.x+canvasSize.y*canvasSize.y)),y:canvasSize}}}}(OpenSeadragon),!function($){$.Viewport=function(options){var args=arguments;(options=args.length&&args[0]instanceof $.Point?{containerSize:args[0],contentSize:args[1],config:args[2]}:options).config&&($.extend(!0,options,options.config),delete options.config),this._margins=$.extend({left:0,top:0,right:0,bottom:0},options.margins||{}),delete options.margins,$.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:$.DEFAULT_SETTINGS.springStiffness,animationTime:$.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:$.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:$.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:$.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:$.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:$.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:$.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:$.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:$.DEFAULT_SETTINGS.maxZoomLevel,degrees:$.DEFAULT_SETTINGS.degrees,flipped:$.DEFAULT_SETTINGS.flipped,homeFillsViewer:$.DEFAULT_SETTINGS.homeFillsViewer},options),this._updateContainerInnerSize(),this.centerSpringX=new $.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new $.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new $.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new $.Rect(0,0,1,1),1),this.goHome(!0),this.update()},$.Viewport.prototype={resetContentSize:function(contentSize){return $.console.assert(contentSize,"[Viewport.resetContentSize] contentSize is required"),$.console.assert(contentSize instanceof $.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),$.console.assert(0<contentSize.x,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),$.console.assert(0<contentSize.y,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new $.Rect(0,0,1,contentSize.y/contentSize.x),contentSize.x),this},setHomeBounds:function(bounds,contentFactor){$.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(bounds,contentFactor)},_setContentBounds:function(bounds,contentFactor){$.console.assert(bounds,"[Viewport._setContentBounds] bounds is required"),$.console.assert(bounds instanceof $.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),$.console.assert(0<bounds.width,"[Viewport._setContentBounds] bounds.width must be greater than 0"),$.console.assert(0<bounds.height,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=bounds.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(contentFactor),this._contentBounds=bounds.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(contentFactor),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:contentFactor,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){var aspectFactor;return this.defaultZoomLevel||(aspectFactor=this._contentAspectRatio/this.getAspectRatio(),(this.homeFillsViewer?1<=aspectFactor?aspectFactor:1:1<=aspectFactor?1:aspectFactor)/this._contentBounds.width)},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var center=this._contentBounds.getCenter(),width=1/this.getHomeZoom(),height=width/this.getAspectRatio();return new $.Rect(center.x-width/2,center.y-height/2,width,height)},goHome:function(immediately){return this.viewer&&this.viewer.raiseEvent("home",{immediately:immediately}),this.fitBounds(this.getHomeBounds(),immediately)},getMinZoom:function(){var homeZoom=this.getHomeZoom();return this.minZoomLevel||this.minZoomImageRatio*homeZoom},getMaxZoom:function(){var zoom=this.maxZoomLevel;return zoom||(zoom=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,zoom/=this._contentBounds.width),Math.max(zoom,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new $.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return $.extend({},this._margins)},setMargins:function(margins){$.console.assert("object"===$.type(margins),"[Viewport.setMargins] margins must be an object"),this._margins=$.extend({left:0,top:0,right:0,bottom:0},margins),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(current){return this.getBoundsNoRotate(current).rotate(-this.getRotation())},getBoundsNoRotate:function(current){var center=this.getCenter(current),current=1/this.getZoom(current),height=current/this.getAspectRatio();return new $.Rect(center.x-current/2,center.y-height/2,current,height)},getBoundsWithMargins:function(current){return this.getBoundsNoRotateWithMargins(current).rotate(-this.getRotation(),this.getCenter(current))},getBoundsNoRotateWithMargins:function(current){var bounds=this.getBoundsNoRotate(current),current=this._containerInnerSize.x*this.getZoom(current);return bounds.x-=this._margins.left/current,bounds.y-=this._margins.top/current,bounds.width+=(this._margins.left+this._margins.right)/current,bounds.height+=(this._margins.top+this._margins.bottom)/current,bounds},getCenter:function(current){var zoom,height,width,centerCurrent=new $.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),centerTarget=new $.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return current?centerCurrent:this.zoomPoint?(current=this.pixelFromPoint(this.zoomPoint,!0),height=(width=1/(zoom=this.getZoom()))/this.getAspectRatio(),centerCurrent=new $.Rect(centerCurrent.x-width/2,centerCurrent.y-height/2,width,height),width=this._pixelFromPoint(this.zoomPoint,centerCurrent).minus(current).divide(this._containerInnerSize.x*zoom),centerTarget.plus(width)):centerTarget},getZoom:function(current){return(current?this.zoomSpring.current:this.zoomSpring.target).value},_applyZoomConstraints:function(zoom){return Math.max(Math.min(zoom,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(bounds){var horizontalThreshold,contentRight,boundsRight,bounds=new $.Rect(bounds.x,bounds.y,bounds.width,bounds.height);return this.wrapHorizontal||(horizontalThreshold=this.visibilityRatio*bounds.width,boundsRight=bounds.x+bounds.width,contentRight=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,boundsRight=this._contentBoundsNoRotate.x-boundsRight+horizontalThreshold,contentRight=contentRight-bounds.x-horizontalThreshold,horizontalThreshold>this._contentBoundsNoRotate.width?bounds.x+=(boundsRight+contentRight)/2:contentRight<0?bounds.x+=contentRight:0<boundsRight&&(bounds.x+=boundsRight)),this.wrapVertical||(horizontalThreshold=this.visibilityRatio*bounds.height,contentRight=bounds.y+bounds.height,boundsRight=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,contentRight=this._contentBoundsNoRotate.y-contentRight+horizontalThreshold,boundsRight=boundsRight-bounds.y-horizontalThreshold,horizontalThreshold>this._contentBoundsNoRotate.height?bounds.y+=(contentRight+boundsRight)/2:boundsRight<0?bounds.y+=boundsRight:0<contentRight&&(bounds.y+=contentRight)),bounds},_raiseConstraintsEvent:function(immediately){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:immediately})},applyConstraints:function(immediately){var actualZoom=this.getZoom(),constrainedZoom=this._applyZoomConstraints(actualZoom),actualZoom=(actualZoom!==constrainedZoom&&this.zoomTo(constrainedZoom,this.zoomPoint,immediately),this.getBoundsNoRotate()),constrainedZoom=this._applyBoundaryConstraints(actualZoom);return this._raiseConstraintsEvent(immediately),actualZoom.x===constrainedZoom.x&&actualZoom.y===constrainedZoom.y&&!immediately||this.fitBounds(constrainedZoom.rotate(-this.getRotation()),immediately),this},ensureVisible:function(immediately){return this.applyConstraints(immediately)},_fitBounds:function(bounds,options){var immediately=(options=options||{}).immediately||!1,options=options.constraints||!1,aspect=this.getAspectRatio(),center=bounds.getCenter(),bounds=new $.Rect(bounds.x,bounds.y,bounds.width,bounds.height,bounds.degrees+this.getRotation()).getBoundingBox(),aspect=(bounds.getAspectRatio()>=aspect?bounds.height=bounds.width/aspect:bounds.width=bounds.height*aspect,bounds.x=center.x-bounds.width/2,bounds.y=center.y-bounds.height/2,1/bounds.width);if(options&&(options=bounds.getAspectRatio(),aspect!==(newConstrainedZoom=this._applyZoomConstraints(aspect))&&(bounds.width=1/(aspect=newConstrainedZoom),bounds.x=center.x-bounds.width/2,bounds.height=bounds.width/options,bounds.y=center.y-bounds.height/2),center=(bounds=this._applyBoundaryConstraints(bounds)).getCenter(),this._raiseConstraintsEvent(immediately)),immediately)return this.panTo(center,!0),this.zoomTo(aspect,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var newConstrainedZoom=this.getBounds(),options=this.getZoom();return 0===options||Math.abs(aspect/options-1)<1e-8?(this.zoomTo(aspect,!0),this.panTo(center,immediately)):(center=(bounds=bounds.rotate(-this.getRotation())).getTopLeft().times(aspect).minus(newConstrainedZoom.getTopLeft().times(options)).divide(aspect-options),this.zoomTo(aspect,center,immediately))},fitBounds:function(bounds,immediately){return this._fitBounds(bounds,{immediately:immediately,constraints:!1})},fitBoundsWithConstraints:function(bounds,immediately){return this._fitBounds(bounds,{immediately:immediately,constraints:!0})},fitVertically:function(immediately){var box=new $.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(box,immediately)},fitHorizontally:function(immediately){var box=new $.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(box,immediately)},getConstrainedBounds:function(current){current=this.getBounds(current);return this._applyBoundaryConstraints(current)},panBy:function(delta,immediately){var center=new $.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(center.plus(delta),immediately)},panTo:function(center,immediately){return immediately?(this.centerSpringX.resetTo(center.x),this.centerSpringY.resetTo(center.y)):(this.centerSpringX.springTo(center.x),this.centerSpringY.springTo(center.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:center,immediately:immediately}),this},zoomBy:function(factor,refPoint,immediately){return this.zoomTo(this.zoomSpring.target.value*factor,refPoint,immediately)},zoomTo:function(zoom,refPoint,immediately){var _this=this;return this.zoomPoint=refPoint instanceof $.Point&&!isNaN(refPoint.x)&&!isNaN(refPoint.y)?refPoint:null,immediately?this._adjustCenterSpringsForZoomPoint(function(){_this.zoomSpring.resetTo(zoom)}):this.zoomSpring.springTo(zoom),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:zoom,refPoint:refPoint,immediately:immediately}),this},setRotation:function(degrees){return this.viewer&&this.viewer.drawer.canRotate()&&(this.degrees=$.positiveModulo(degrees,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:degrees})),this},getRotation:function(){return this.degrees},resize:function(newContainerSize,maintain){var widthDeltaFactor,oldBounds=this.getBoundsNoRotate(),newBounds=oldBounds;return this.containerSize.x=newContainerSize.x,this.containerSize.y=newContainerSize.y,this._updateContainerInnerSize(),maintain&&(widthDeltaFactor=newContainerSize.x/this.containerSize.x,newBounds.width=oldBounds.width*widthDeltaFactor,newBounds.height=newBounds.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:newContainerSize,maintain:maintain}),this.fitBounds(newBounds,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new $.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var _this=this,changed=(this._adjustCenterSpringsForZoomPoint(function(){_this.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update(),this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom);return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,changed},_adjustCenterSpringsForZoomPoint:function(zoomSpringHandler){var oldZoomPixel;this.zoomPoint?(oldZoomPixel=this.pixelFromPoint(this.zoomPoint,!0),zoomSpringHandler(),oldZoomPixel=this.pixelFromPoint(this.zoomPoint,!0).minus(oldZoomPixel),oldZoomPixel=this.deltaPointsFromPixels(oldZoomPixel,!0),this.centerSpringX.shiftBy(oldZoomPixel.x),this.centerSpringY.shiftBy(oldZoomPixel.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)):zoomSpringHandler()},deltaPixelsFromPointsNoRotate:function(deltaPoints,current){return deltaPoints.times(this._containerInnerSize.x*this.getZoom(current))},deltaPixelsFromPoints:function(deltaPoints,current){return this.deltaPixelsFromPointsNoRotate(deltaPoints.rotate(this.getRotation()),current)},deltaPointsFromPixelsNoRotate:function(deltaPixels,current){return deltaPixels.divide(this._containerInnerSize.x*this.getZoom(current))},deltaPointsFromPixels:function(deltaPixels,current){return this.deltaPointsFromPixelsNoRotate(deltaPixels,current).rotate(-this.getRotation())},pixelFromPointNoRotate:function(point,current){return this._pixelFromPointNoRotate(point,this.getBoundsNoRotate(current))},pixelFromPoint:function(point,current){return this._pixelFromPoint(point,this.getBoundsNoRotate(current))},_pixelFromPointNoRotate:function(point,bounds){return point.minus(bounds.getTopLeft()).times(this._containerInnerSize.x/bounds.width).plus(new $.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(point,bounds){return this._pixelFromPointNoRotate(point.rotate(this.getRotation(),this.getCenter(!0)),bounds)},pointFromPixelNoRotate:function(pixel,current){current=this.getBoundsNoRotate(current);return pixel.minus(new $.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/current.width).plus(current.getTopLeft())},pointFromPixel:function(pixel,current){return this.pointFromPixelNoRotate(pixel,current).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(viewerX,viewerY){var scale=this._contentBoundsNoRotate.width;return new $.Point(viewerX*this._contentSizeNoRotate.x/scale,viewerY*this._contentSizeNoRotate.x/scale)},viewportToImageCoordinates:function(viewerX,viewerY){if(viewerX instanceof $.Point)return this.viewportToImageCoordinates(viewerX.x,viewerX.y);if(this.viewer){var count=this.viewer.world.getItemCount();if(1<count)$.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===count)return this.viewer.world.getItemAt(0).viewportToImageCoordinates(viewerX,viewerY,!0)}return this._viewportToImageDelta(viewerX-this._contentBoundsNoRotate.x,viewerY-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(imageX,imageY){var scale=this._contentBoundsNoRotate.width;return new $.Point(imageX/this._contentSizeNoRotate.x*scale,imageY/this._contentSizeNoRotate.x*scale)},imageToViewportCoordinates:function(imageX,imageY){if(imageX instanceof $.Point)return this.imageToViewportCoordinates(imageX.x,imageX.y);if(this.viewer){var count=this.viewer.world.getItemCount();if(1<count)$.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===count)return this.viewer.world.getItemAt(0).imageToViewportCoordinates(imageX,imageY,!0)}count=this._imageToViewportDelta(imageX,imageY);return count.x+=this._contentBoundsNoRotate.x,count.y+=this._contentBoundsNoRotate.y,count},imageToViewportRectangle:function(imageX,imageY,pixelWidth,pixelHeight){var rect=imageX;if(rect instanceof $.Rect||(rect=new $.Rect(imageX,imageY,pixelWidth,pixelHeight)),this.viewer){var count=this.viewer.world.getItemCount();if(1<count)$.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===count)return this.viewer.world.getItemAt(0).imageToViewportRectangle(imageX,imageY,pixelWidth,pixelHeight,!0)}count=this.imageToViewportCoordinates(rect.x,rect.y),imageX=this._imageToViewportDelta(rect.width,rect.height);return new $.Rect(count.x,count.y,imageX.x,imageX.y,rect.degrees)},viewportToImageRectangle:function(viewerX,viewerY,pointWidth,pointHeight){var rect=viewerX;if(rect instanceof $.Rect||(rect=new $.Rect(viewerX,viewerY,pointWidth,pointHeight)),this.viewer){var count=this.viewer.world.getItemCount();if(1<count)$.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===count)return this.viewer.world.getItemAt(0).viewportToImageRectangle(viewerX,viewerY,pointWidth,pointHeight,!0)}count=this.viewportToImageCoordinates(rect.x,rect.y),viewerX=this._viewportToImageDelta(rect.width,rect.height);return new $.Rect(count.x,count.y,viewerX.x,viewerX.y,rect.degrees)},viewerElementToImageCoordinates:function(pixel){pixel=this.pointFromPixel(pixel,!0);return this.viewportToImageCoordinates(pixel)},imageToViewerElementCoordinates:function(pixel){pixel=this.imageToViewportCoordinates(pixel);return this.pixelFromPoint(pixel,!0)},windowToImageCoordinates:function(pixel){$.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");pixel=pixel.minus($.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(pixel)},imageToWindowCoordinates:function(pixel){return $.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(pixel).plus($.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(pixel){return this.pointFromPixel(pixel,!0)},viewportToViewerElementCoordinates:function(point){return this.pixelFromPoint(point,!0)},viewerElementToViewportRectangle:function(rectangle){return $.Rect.fromSummits(this.pointFromPixel(rectangle.getTopLeft(),!0),this.pointFromPixel(rectangle.getTopRight(),!0),this.pointFromPixel(rectangle.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(rectangle){return $.Rect.fromSummits(this.pixelFromPoint(rectangle.getTopLeft(),!0),this.pixelFromPoint(rectangle.getTopRight(),!0),this.pixelFromPoint(rectangle.getBottomLeft(),!0))},windowToViewportCoordinates:function(pixel){$.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");pixel=pixel.minus($.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(pixel)},viewportToWindowCoordinates:function(point){return $.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(point).plus($.getElementPosition(this.viewer.element))},viewportToImageZoom:function(viewportZoom){if(this.viewer){var count=this.viewer.world.getItemCount();if(1<count)$.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===count)return this.viewer.world.getItemAt(0).viewportToImageZoom(viewportZoom)}count=this._contentSizeNoRotate.x;return viewportZoom*(this._containerInnerSize.x/count*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(imageZoom){if(this.viewer){var count=this.viewer.world.getItemCount();if(1<count)$.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===count)return this.viewer.world.getItemAt(0).imageToViewportZoom(imageZoom)}return imageZoom*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(state){return this.flipped!==state&&(this.flipped=state,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:state})),this}}}(OpenSeadragon),!function($){function setTileLoaded(tiledImage,tile,image,cutoff,tileRequest){var increment=0;function getCompletionCallback(){return increment++,completionCallback}function completionCallback(){0===--increment&&(tile.loading=!1,tile.loaded=!0,tile.context2D||tiledImage._tileCache.cacheTile({image:image,tile:tile,cutoff:cutoff,tiledImage:tiledImage}),tiledImage._needsDraw=!0)}tiledImage.viewer.raiseEvent("tile-loaded",{tile:tile,tiledImage:tiledImage,tileRequest:tileRequest,image:image,getCompletionCallback:getCompletionCallback}),getCompletionCallback()()}function providesCoverage(coverage,level,x,y){var rows,cols,i,j;if(!coverage[level])return!1;if(void 0!==x&&void 0!==y)return void 0===coverage[level][x]||void 0===coverage[level][x][y]||!0===coverage[level][x][y];for(i in rows=coverage[level])if(Object.prototype.hasOwnProperty.call(rows,i))for(j in cols=rows[i])if(Object.prototype.hasOwnProperty.call(cols,j)&&!cols[j])return!1;return!0}function isCovered(coverage,level,x,y){return void 0===x||void 0===y?providesCoverage(coverage,level+1):providesCoverage(coverage,level+1,2*x,2*y)&&providesCoverage(coverage,level+1,2*x,2*y+1)&&providesCoverage(coverage,level+1,2*x+1,2*y)&&providesCoverage(coverage,level+1,2*x+1,2*y+1)}function setCoverage(coverage,level,x,y,covers){coverage[level]?(coverage[level][x]||(coverage[level][x]={}),coverage[level][x][y]=covers):$.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",level)}$.TiledImage=function(options){var _this=this,x=($.console.assert(options.tileCache,"[TiledImage] options.tileCache is required"),$.console.assert(options.drawer,"[TiledImage] options.drawer is required"),$.console.assert(options.viewer,"[TiledImage] options.viewer is required"),$.console.assert(options.imageLoader,"[TiledImage] options.imageLoader is required"),$.console.assert(options.source,"[TiledImage] options.source is required"),$.console.assert(!options.clip||options.clip instanceof $.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),$.EventSource.call(this),this._tileCache=options.tileCache,delete options.tileCache,this._drawer=options.drawer,delete options.drawer,this._imageLoader=options.imageLoader,delete options.imageLoader,options.clip instanceof $.Rect&&(this._clip=options.clip.clone()),delete options.clip,options.x||0),y=(delete options.x,options.y||0),scale=(delete options.y,this.normHeight=options.source.dimensions.y/options.source.dimensions.x,this.contentAspectX=options.source.dimensions.x/options.source.dimensions.y,1),fitBounds=(options.width?(scale=options.width,delete options.width,options.height&&($.console.error("specifying both width and height to a tiledImage is not supported"),delete options.height)):options.height&&(scale=options.height/this.normHeight,delete options.height),options.fitBounds),fitBoundsPlacement=(delete options.fitBounds,options.fitBoundsPlacement||OpenSeadragon.Placement.CENTER),degrees=(delete options.fitBoundsPlacement,options.degrees||0);delete options.degrees,$.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:$.DEFAULT_SETTINGS.springStiffness,animationTime:$.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:$.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:$.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:$.DEFAULT_SETTINGS.wrapVertical,immediateRender:$.DEFAULT_SETTINGS.immediateRender,blendTime:$.DEFAULT_SETTINGS.blendTime,alwaysBlend:$.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:$.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:$.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:$.DEFAULT_SETTINGS.iOSDevice,debugMode:$.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:$.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:$.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:$.DEFAULT_SETTINGS.placeholderFillStyle,opacity:$.DEFAULT_SETTINGS.opacity,preload:$.DEFAULT_SETTINGS.preload,compositeOperation:$.DEFAULT_SETTINGS.compositeOperation},options),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new $.Spring({initial:x,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new $.Spring({initial:y,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new $.Spring({initial:scale,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new $.Spring({initial:degrees,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),fitBounds&&this.fitBounds(fitBounds,fitBoundsPlacement,!0),this._drawingHandler=function(args){_this.viewer.raiseEvent("tile-drawing",$.extend({tiledImage:_this},args))}},$.extend($.TiledImage.prototype,$.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(flag){flag!==this._fullyLoaded&&(this._fullyLoaded=flag,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=$.now(),this._needsDraw=!0},update:function(){var xUpdated=this._xSpring.update(),yUpdated=this._ySpring.update(),scaleUpdated=this._scaleSpring.update(),degreesUpdated=this._degreesSpring.update();return!!(xUpdated||yUpdated||scaleUpdated||degreesUpdated)&&(this._updateForScale(),this._needsDraw=!0)},draw:function(){0!==this.opacity||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(current){return this.getBoundsNoRotate(current).rotate(this.getRotation(current),this._getRotationPoint(current))},getBoundsNoRotate:function(current){return current?new $.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new $.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return $.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(current){var ratio,bounds=this.getBoundsNoRotate(current);return this._clip&&(ratio=(current?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x,ratio=this._clip.times(ratio),bounds=new $.Rect(bounds.x+ratio.x,bounds.y+ratio.y,ratio.width,ratio.height)),bounds.rotate(this.getRotation(current),this._getRotationPoint(current))},getContentSize:function(){return new $.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(viewerX,viewerY,current){current=(current?this._scaleSpring.current:this._scaleSpring.target).value;return new $.Point(viewerX*(this.source.dimensions.x/current),viewerY*(this.source.dimensions.y*this.contentAspectX/current))},viewportToImageCoordinates:function(viewerX,viewerY,current){viewerX=viewerX instanceof $.Point?(current=viewerY,viewerX):new $.Point(viewerX,viewerY);return viewerX=viewerX.rotate(-this.getRotation(current),this._getRotationPoint(current)),current?this._viewportToImageDelta(viewerX.x-this._xSpring.current.value,viewerX.y-this._ySpring.current.value):this._viewportToImageDelta(viewerX.x-this._xSpring.target.value,viewerX.y-this._ySpring.target.value)},_imageToViewportDelta:function(imageX,imageY,current){current=(current?this._scaleSpring.current:this._scaleSpring.target).value;return new $.Point(imageX/this.source.dimensions.x*current,imageY/this.source.dimensions.y/this.contentAspectX*current)},imageToViewportCoordinates:function(imageX,imageY,current){imageX instanceof $.Point&&(current=imageY,imageY=imageX.y,imageX=imageX.x);imageX=this._imageToViewportDelta(imageX,imageY);return current?(imageX.x+=this._xSpring.current.value,imageX.y+=this._ySpring.current.value):(imageX.x+=this._xSpring.target.value,imageX.y+=this._ySpring.target.value),imageX.rotate(this.getRotation(current),this._getRotationPoint(current))},imageToViewportRectangle:function(imageX,imageY,pixelWidth,pixelHeight,current){var rect=imageX,imageX=(rect instanceof $.Rect?current=imageY:rect=new $.Rect(imageX,imageY,pixelWidth,pixelHeight),this.imageToViewportCoordinates(rect.getTopLeft(),current)),imageY=this._imageToViewportDelta(rect.width,rect.height,current);return new $.Rect(imageX.x,imageX.y,imageY.x,imageY.y,rect.degrees+this.getRotation(current))},viewportToImageRectangle:function(viewerX,viewerY,pointWidth,pointHeight,current){var rect=viewerX,viewerX=(viewerX instanceof $.Rect?current=viewerY:rect=new $.Rect(viewerX,viewerY,pointWidth,pointHeight),this.viewportToImageCoordinates(rect.getTopLeft(),current)),viewerY=this._viewportToImageDelta(rect.width,rect.height,current);return new $.Rect(viewerX.x,viewerX.y,viewerY.x,viewerY.y,rect.degrees-this.getRotation(current))},viewerElementToImageCoordinates:function(pixel){pixel=this.viewport.pointFromPixel(pixel,!0);return this.viewportToImageCoordinates(pixel)},imageToViewerElementCoordinates:function(pixel){pixel=this.imageToViewportCoordinates(pixel);return this.viewport.pixelFromPoint(pixel,!0)},windowToImageCoordinates:function(pixel){pixel=pixel.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(pixel)},imageToWindowCoordinates:function(pixel){return this.imageToViewerElementCoordinates(pixel).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(rect){var scale=this._scaleSpring.current.value;return rect=rect.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new $.Rect((rect.x-this._xSpring.current.value)/scale,(rect.y-this._ySpring.current.value)/scale,rect.width/scale,rect.height/scale,rect.degrees)},viewportToImageZoom:function(viewportZoom){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*viewportZoom},imageToViewportZoom:function(imageZoom){return imageZoom/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(position,immediately){var sameTarget=this._xSpring.target.value===position.x&&this._ySpring.target.value===position.y;if(immediately){if(sameTarget&&this._xSpring.current.value===position.x&&this._ySpring.current.value===position.y)return;this._xSpring.resetTo(position.x),this._ySpring.resetTo(position.y)}else{if(sameTarget)return;this._xSpring.springTo(position.x),this._ySpring.springTo(position.y)}this._needsDraw=!0,sameTarget||this._raiseBoundsChange()},setWidth:function(width,immediately){this._setScale(width,immediately)},setHeight:function(height,immediately){this._setScale(height/this.normHeight,immediately)},setCroppingPolygons:function(polygons){var isXYObject=function(obj){return obj instanceof $.Point||"number"==typeof obj.x&&"number"==typeof obj.y};try{if(!$.isArray(polygons))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=polygons.map(function(polygon){return polygon.map(function(obj){try{if(isXYObject(obj))return{x:obj.x,y:obj.y};throw new Error}catch(e){throw new Error("A Provided cropping polygon point is not supported")}})})}catch(e){$.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),$.console.error(e),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(bounds,anchor,immediately){anchor=anchor||$.Placement.CENTER;var marginLeft,anchor=$.Placement.properties[anchor],aspectRatio=this.contentAspectX,xOffset=0,yOffset=0,displayedWidthRatio=1,displayedHeightRatio=1;this._clip&&(aspectRatio=this._clip.getAspectRatio(),displayedWidthRatio=this._clip.width/this.source.dimensions.x,displayedHeightRatio=this._clip.height/this.source.dimensions.y,yOffset=bounds.getAspectRatio()>aspectRatio?(xOffset=this._clip.x/this._clip.height*bounds.height,this._clip.y/this._clip.height*bounds.height):(xOffset=this._clip.x/this._clip.width*bounds.width,this._clip.y/this._clip.width*bounds.width)),bounds.getAspectRatio()>aspectRatio?(displayedHeightRatio=bounds.height/displayedHeightRatio,marginLeft=0,anchor.isHorizontallyCentered?marginLeft=(bounds.width-bounds.height*aspectRatio)/2:anchor.isRight&&(marginLeft=bounds.width-bounds.height*aspectRatio),this.setPosition(new $.Point(bounds.x-xOffset+marginLeft,bounds.y-yOffset),immediately),this.setHeight(displayedHeightRatio,immediately)):(marginLeft=bounds.width/displayedWidthRatio,displayedHeightRatio=0,anchor.isVerticallyCentered?displayedHeightRatio=(bounds.height-bounds.width/aspectRatio)/2:anchor.isBottom&&(displayedHeightRatio=bounds.height-bounds.width/aspectRatio),this.setPosition(new $.Point(bounds.x-xOffset,bounds.y-yOffset+displayedHeightRatio),immediately),this.setWidth(marginLeft,immediately))},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(newClip){$.console.assert(!newClip||newClip instanceof $.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),newClip instanceof $.Rect?this._clip=newClip.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(opacity){opacity!==this.opacity&&(this.opacity=opacity,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(preload){this._preload=!!preload,this._needsDraw=!0},getRotation:function(current){return(current?this._degreesSpring.current:this._degreesSpring.target).value},setRotation:function(degrees,immediately){this._degreesSpring.target.value===degrees&&this._degreesSpring.isAtTargetValue()||(immediately?this._degreesSpring.resetTo(degrees):this._degreesSpring.springTo(degrees),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(current){return this.getBoundsNoRotate(current).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(compositeOperation){compositeOperation!==this.compositeOperation&&(this.compositeOperation=compositeOperation,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(scale,immediately){var sameTarget=this._scaleSpring.target.value===scale;if(immediately){if(sameTarget&&this._scaleSpring.current.value===scale)return;this._scaleSpring.resetTo(scale)}else{if(sameTarget)return;this._scaleSpring.springTo(scale)}this._updateForScale(),this._needsDraw=!0,sameTarget||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var lowestLevel=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),currentZeroRatio=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,currentZeroRatio=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(currentZeroRatio/this.minPixelRatio)/Math.log(2)))),currentZeroRatio=Math.max(currentZeroRatio,this.source.minLevel||0);return{lowestLevel:Math.min(lowestLevel,currentZeroRatio),highestLevel:currentZeroRatio}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};0<this.lastDrawn.length;)this.lastDrawn.pop().beingDrawn=!1;var viewport=this.viewport,drawArea=this._viewportToTiledImageRectangle(viewport.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var tiledImageBounds=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(drawArea=drawArea.intersection(tiledImageBounds)))return}for(var tiledImageBounds=this._getLevelsInterval(),lowestLevel=tiledImageBounds.lowestLevel,tiledImageBounds=tiledImageBounds.highestLevel,bestTile=null,haveDrawn=!1,currentTime=$.now(),level=tiledImageBounds;lowestLevel<=level;level--){var drawLevel=!1,currentRenderPixelRatio=viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(level),!0).x*this._scaleSpring.current.value;if(level===lowestLevel||!haveDrawn&&currentRenderPixelRatio>=this.minPixelRatio)haveDrawn=drawLevel=!0;else if(!haveDrawn)continue;var targetRenderPixelRatio=viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(level),!1).x*this._scaleSpring.current.value,targetZeroRatio=viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,targetZeroRatio=this.immediateRender?1:targetZeroRatio,bestTile=function(tiledImage,haveDrawn,drawLevel,level,levelOpacity,levelVisibility,drawArea,currentTime,best){var topLeftBound=drawArea.getBoundingBox().getTopLeft(),bottomRightBound=drawArea.getBoundingBox().getBottomRight();tiledImage.viewer&&tiledImage.viewer.raiseEvent("update-level",{tiledImage:tiledImage,havedrawn:haveDrawn,level:level,opacity:levelOpacity,visibility:levelVisibility,drawArea:drawArea,topleft:topLeftBound,bottomright:bottomRightBound,currenttime:currentTime,best:best});tiledImage.coverage[level]={},tiledImage.loadingCoverage[level]={};for(var topLeftBound=tiledImage._getCornerTiles(level,topLeftBound,bottomRightBound),topLeftTile=topLeftBound.topLeft,bottomRightTile=topLeftBound.bottomRight,numberOfTiles=tiledImage.source.getNumTiles(level),viewportCenter=tiledImage.viewport.pixelFromPoint(tiledImage.viewport.getCenter()),x=topLeftTile.x;x<=bottomRightTile.x;x++)for(var y=topLeftTile.y;y<=bottomRightTile.y;y++){if(!tiledImage.wrapHorizontal&&!tiledImage.wrapVertical){var tileBounds=tiledImage.source.getTileBounds(level,x,y);if(null===drawArea.intersection(tileBounds))continue}best=function(tiledImage,haveDrawn,drawLevel,x,y,level,levelOpacity,levelVisibility,viewportCenter,numberOfTiles,currentTime,best){numberOfTiles=function(x,y,level,tiledImage,tileSource,tilesMatrix,time,numTiles,worldWidth,worldHeight){var xMod,yMod,sourceBounds,exists,url,ajaxHeaders,bounds;tilesMatrix[level]||(tilesMatrix[level]={});tilesMatrix[level][x]||(tilesMatrix[level][x]={});tilesMatrix[level][x][y]||(xMod=(numTiles.x+x%numTiles.x)%numTiles.x,yMod=(numTiles.y+y%numTiles.y)%numTiles.y,bounds=tileSource.getTileBounds(level,xMod,yMod),sourceBounds=tileSource.getTileBounds(level,xMod,yMod,!0),exists=tileSource.tileExists(level,xMod,yMod),url=tileSource.getTileUrl(level,xMod,yMod),tiledImage.loadTilesWithAjax?(ajaxHeaders=tileSource.getTileAjaxHeaders(level,xMod,yMod),$.isPlainObject(tiledImage.ajaxHeaders)&&(ajaxHeaders=$.extend({},tiledImage.ajaxHeaders,ajaxHeaders))):ajaxHeaders=null,tileSource=tileSource.getContext2D?tileSource.getContext2D(level,xMod,yMod):void 0,bounds.x+=(x-xMod)/numTiles.x,bounds.y+=worldHeight/worldWidth*((y-yMod)/numTiles.y),bounds=new $.Tile(level,x,y,bounds,exists,url,tileSource,tiledImage.loadTilesWithAjax,ajaxHeaders,sourceBounds),xMod==numTiles.x-1&&(bounds.isRightMost=!0),yMod==numTiles.y-1&&(bounds.isBottomMost=!0),tilesMatrix[level][x][y]=bounds);return(bounds=tilesMatrix[level][x][y]).lastTouchTime=time,bounds}(x,y,level,tiledImage,tiledImage.source,tiledImage.tilesMatrix,currentTime,numberOfTiles,tiledImage._worldWidthCurrent,tiledImage._worldHeightCurrent);tiledImage.viewer&&tiledImage.viewer.raiseEvent("update-tile",{tiledImage:tiledImage,tile:numberOfTiles});setCoverage(tiledImage.coverage,level,x,y,!1);var loadingCoverage=numberOfTiles.loaded||numberOfTiles.loading||isCovered(tiledImage.loadingCoverage,level,x,y);return setCoverage(tiledImage.loadingCoverage,level,x,y,loadingCoverage),numberOfTiles.exists&&(haveDrawn&&!drawLevel&&(isCovered(tiledImage.coverage,level,x,y)?setCoverage(tiledImage.coverage,level,x,y,!0):drawLevel=!0),drawLevel)&&(function(tile,overlap,viewport,viewportCenter,levelVisibility,tiledImage){var boundsTL=tile.bounds.getTopLeft(),boundsSize=(boundsTL.x*=tiledImage._scaleSpring.current.value,boundsTL.y*=tiledImage._scaleSpring.current.value,boundsTL.x+=tiledImage._xSpring.current.value,boundsTL.y+=tiledImage._ySpring.current.value,tile.bounds.getSize()),positionC=(boundsSize.x*=tiledImage._scaleSpring.current.value,boundsSize.y*=tiledImage._scaleSpring.current.value,viewport.pixelFromPointNoRotate(boundsTL,!0)),boundsTL=viewport.pixelFromPointNoRotate(boundsTL,!1),sizeC=viewport.deltaPixelsFromPointsNoRotate(boundsSize,!0),viewport=viewport.deltaPixelsFromPointsNoRotate(boundsSize,!1),boundsSize=boundsTL.plus(viewport.divide(2)),boundsTL=viewportCenter.squaredDistanceTo(boundsSize);overlap||(sizeC=sizeC.plus(new $.Point(1,1)));tile.isRightMost&&tiledImage.wrapHorizontal&&(sizeC.x+=.75);tile.isBottomMost&&tiledImage.wrapVertical&&(sizeC.y+=.75);tile.position=positionC,tile.size=sizeC,tile.squaredDistance=boundsTL,tile.visibility=levelVisibility}(numberOfTiles,tiledImage.source.tileOverlap,tiledImage.viewport,viewportCenter,levelVisibility,tiledImage),numberOfTiles.loaded||(numberOfTiles.context2D?setTileLoaded(tiledImage,numberOfTiles):(haveDrawn=tiledImage._tileCache.getImageRecord(numberOfTiles.cacheKey))&&(drawLevel=haveDrawn.getImage(),setTileLoaded(tiledImage,numberOfTiles,drawLevel))),numberOfTiles.loaded?function(tiledImage,tile,x,y,level,levelOpacity,currentTime){var opacity,blendTimeMillis=1e3*tiledImage.blendTime;tile.blendStart||(tile.blendStart=currentTime);currentTime=currentTime-tile.blendStart,opacity=blendTimeMillis?Math.min(1,currentTime/blendTimeMillis):1,tiledImage.alwaysBlend&&(opacity*=levelOpacity);if(tile.opacity=opacity,tiledImage.lastDrawn.push(tile),1===opacity)setCoverage(tiledImage.coverage,level,x,y,!0),tiledImage._hasOpaqueTile=!0;else if(currentTime<blendTimeMillis)return!0;return!1}(tiledImage,numberOfTiles,x,y,level,levelOpacity,currentTime)&&(tiledImage._needsDraw=!0):numberOfTiles.loading?tiledImage._tilesLoading++:loadingCoverage||(best=function(previousBest,tile){if(!previousBest)return tile;{if(tile.visibility>previousBest.visibility)return tile;if(tile.visibility==previousBest.visibility&&tile.squaredDistance<previousBest.squaredDistance)return tile}return previousBest}(best,numberOfTiles))),best}(tiledImage,drawLevel,haveDrawn,x,y,level,levelOpacity,levelVisibility,viewportCenter,numberOfTiles,currentTime,best)}return best}(this,haveDrawn,drawLevel,level,Math.min(1,(currentRenderPixelRatio-.5)/.5),targetZeroRatio/Math.abs(targetZeroRatio-targetRenderPixelRatio),drawArea,currentTime,bestTile);if(providesCoverage(this.coverage,level))break}!function(tiledImage,lastDrawn){if(0!==tiledImage.opacity&&(0!==lastDrawn.length||tiledImage.placeholderFillStyle)){var useSketch,sketchScale,sketchTranslate,bounds,box,tile=lastDrawn[0],zoom=(tile&&(useSketch=tiledImage.opacity<1||tiledImage.compositeOperation&&"source-over"!==tiledImage.compositeOperation||!tiledImage._isBottomItem()&&tile._hasTransparencyChannel()),tiledImage.viewport.getZoom(!0)),zoom=tiledImage.viewportToImageZoom(zoom),zoom=(1<lastDrawn.length&&zoom>tiledImage.smoothTileEdgesMinZoom&&!tiledImage.iOSDevice&&tiledImage.getRotation(!0)%360==0&&$.supportsCanvas&&(useSketch=!0,sketchScale=tile.getScaleForEdgeSmoothing(),sketchTranslate=tile.getTranslationForEdgeSmoothing(sketchScale,tiledImage._drawer.getCanvasSize(!1),tiledImage._drawer.getCanvasSize(!0))),useSketch&&(sketchScale||(bounds=tiledImage.viewport.viewportToViewerElementRectangle(tiledImage.getClippedBounds(!0)).getIntegerBoundingBox(),!tiledImage._drawer.viewer.viewport.getFlip()||0===tiledImage.viewport.degrees&&tiledImage.getRotation(!0)%360==0||(bounds.x=tiledImage._drawer.viewer.container.clientWidth-(bounds.x+bounds.width)),bounds=bounds.times($.pixelDensityRatio)),tiledImage._drawer._clear(!0,bounds)),sketchScale||(0!==tiledImage.viewport.degrees&&tiledImage._drawer._offsetForRotation({degrees:tiledImage.viewport.degrees,useSketch:useSketch}),tiledImage.getRotation(!0)%360!=0&&tiledImage._drawer._offsetForRotation({degrees:tiledImage.getRotation(!0),point:tiledImage.viewport.pixelFromPointNoRotate(tiledImage._getRotationPoint(!0),!0),useSketch:useSketch}),0===tiledImage.viewport.degrees&&tiledImage.getRotation(!0)%360==0&&tiledImage._drawer.viewer.viewport.getFlip()&&tiledImage._drawer._flip()),!1);if(tiledImage._clip&&(tiledImage._drawer.saveContext(useSketch),box=(box=tiledImage.imageToViewportRectangle(tiledImage._clip,!0)).rotate(-tiledImage.getRotation(!0),tiledImage._getRotationPoint(!0)),box=tiledImage._drawer.viewportToDrawerRectangle(box),sketchScale&&(box=box.times(sketchScale)),sketchTranslate&&(box=box.translate(sketchTranslate)),tiledImage._drawer.setClip(box,useSketch),zoom=!0),tiledImage._croppingPolygons){tiledImage._drawer.saveContext(useSketch);try{var polygons=tiledImage._croppingPolygons.map(function(polygon){return polygon.map(function(coord){coord=tiledImage.imageToViewportCoordinates(coord.x,coord.y,!0).rotate(-tiledImage.getRotation(!0),tiledImage._getRotationPoint(!0)),coord=tiledImage._drawer.viewportCoordToDrawerCoord(coord);return coord=sketchScale?coord.times(sketchScale):coord})});tiledImage._drawer.clipWithPolygons(polygons,useSketch)}catch(e){$.console.error(e)}zoom=!0}tiledImage.placeholderFillStyle&&!1===tiledImage._hasOpaqueTile&&(box=tiledImage._drawer.viewportToDrawerRectangle(tiledImage.getBounds(!0)),sketchScale&&(box=box.times(sketchScale)),sketchTranslate&&(box=box.translate(sketchTranslate)),polygons=null,polygons="function"==typeof tiledImage.placeholderFillStyle?tiledImage.placeholderFillStyle(tiledImage,tiledImage._drawer.context):tiledImage.placeholderFillStyle,tiledImage._drawer.drawRectangle(box,polygons,useSketch));for(var i=lastDrawn.length-1;0<=i;i--)tile=lastDrawn[i],tiledImage._drawer.drawTile(tile,tiledImage._drawingHandler,useSketch,sketchScale,sketchTranslate),tile.beingDrawn=!0,tiledImage.viewer&&tiledImage.viewer.raiseEvent("tile-drawn",{tiledImage:tiledImage,tile:tile});zoom&&tiledImage._drawer.restoreContext(useSketch),sketchScale||(tiledImage.getRotation(!0)%360!=0&&tiledImage._drawer._restoreRotationChanges(useSketch),0!==tiledImage.viewport.degrees&&tiledImage._drawer._restoreRotationChanges(useSketch)),useSketch&&(sketchScale&&(0!==tiledImage.viewport.degrees&&tiledImage._drawer._offsetForRotation({degrees:tiledImage.viewport.degrees,useSketch:!1}),tiledImage.getRotation(!0)%360!=0)&&tiledImage._drawer._offsetForRotation({degrees:tiledImage.getRotation(!0),point:tiledImage.viewport.pixelFromPointNoRotate(tiledImage._getRotationPoint(!0),!0),useSketch:!1}),tiledImage._drawer.blendSketch({opacity:tiledImage.opacity,scale:sketchScale,translate:sketchTranslate,compositeOperation:tiledImage.compositeOperation,bounds:bounds}),sketchScale)&&(tiledImage.getRotation(!0)%360!=0&&tiledImage._drawer._restoreRotationChanges(!1),0!==tiledImage.viewport.degrees)&&tiledImage._drawer._restoreRotationChanges(!1),sketchScale||0===tiledImage.viewport.degrees&&tiledImage.getRotation(!0)%360==0&&tiledImage._drawer.viewer.viewport.getFlip()&&tiledImage._drawer._flip(),!function(tiledImage,lastDrawn){if(tiledImage.debugMode)for(var i=lastDrawn.length-1;0<=i;i--){var tile=lastDrawn[i];try{tiledImage._drawer.drawDebugInfo(tile,lastDrawn.length,i,tiledImage)}catch(e){$.console.error(e)}}}(tiledImage,lastDrawn)}}(this,this.lastDrawn),bestTile&&!bestTile.context2D?(function(tiledImage,tile,time){tile.loading=!0,tiledImage._imageLoader.addJob({src:tile.url,loadWithAjax:tile.loadWithAjax,ajaxHeaders:tile.ajaxHeaders,crossOriginPolicy:tiledImage.crossOriginPolicy,ajaxWithCredentials:tiledImage.ajaxWithCredentials,callback:function(image,errorMsg,tileRequest){!function(tiledImage,tile,time,image,errorMsg,tileRequest){var finish;image?time<tiledImage.lastResetTime?($.console.log("Ignoring tile %s loaded before reset: %s",tile,tile.url),tile.loading=!1):(finish=function(){var cutoff=tiledImage.source.getClosestLevel();setTileLoaded(tiledImage,tile,image,cutoff,tileRequest)},tiledImage._midDraw?window.setTimeout(finish,1):finish()):($.console.log("Tile %s failed to load: %s - error: %s",tile,tile.url,errorMsg),tiledImage.viewer.raiseEvent("tile-load-failed",{tile:tile,tiledImage:tiledImage,time:time,message:errorMsg,tileRequest:tileRequest}),tile.loading=!1,tile.exists=!1)}(tiledImage,tile,time,image,errorMsg,tileRequest)},abort:function(){tile.loading=!1}})}(this,bestTile,currentTime),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(level,topLeftBound,bottomRightBound){var rightX=this.wrapHorizontal?(leftX=$.positiveModulo(topLeftBound.x,1),$.positiveModulo(bottomRightBound.x,1)):(leftX=Math.max(0,topLeftBound.x),Math.min(1,bottomRightBound.x)),aspectRatio=1/this.source.aspectRatio,bottomY=this.wrapVertical?(topY=$.positiveModulo(topLeftBound.y,aspectRatio),$.positiveModulo(bottomRightBound.y,aspectRatio)):(topY=Math.max(0,topLeftBound.y),Math.min(aspectRatio,bottomRightBound.y)),leftX=this.source.getTileAtPoint(level,new $.Point(leftX,topY)),topY=this.source.getTileAtPoint(level,new $.Point(rightX,bottomY)),rightX=this.source.getNumTiles(level);return this.wrapHorizontal&&(leftX.x+=rightX.x*Math.floor(topLeftBound.x),topY.x+=rightX.x*Math.floor(bottomRightBound.x)),this.wrapVertical&&(leftX.y+=rightX.y*Math.floor(topLeftBound.y/aspectRatio),topY.y+=rightX.y*Math.floor(bottomRightBound.y/aspectRatio)),{topLeft:leftX,bottomRight:topY}}})}(OpenSeadragon),!function($){function TileRecord(options){$.console.assert(options,"[TileCache.cacheTile] options is required"),$.console.assert(options.tile,"[TileCache.cacheTile] options.tile is required"),$.console.assert(options.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=options.tile,this.tiledImage=options.tiledImage}function ImageRecord(options){$.console.assert(options,"[ImageRecord] options is required"),$.console.assert(options.image,"[ImageRecord] options.image is required"),this._image=options.image,this._tiles=[]}ImageRecord.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){var canvas;return this._renderedContext||((canvas=document.createElement("canvas")).width=this._image.width,canvas.height=this._image.height,this._renderedContext=canvas.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null),this._renderedContext},setRenderedContext:function(renderedContext){$.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=renderedContext},addTile:function(tile){$.console.assert(tile,"[ImageRecord.addTile] tile is required"),this._tiles.push(tile)},removeTile:function(tile){for(var i=0;i<this._tiles.length;i++)if(this._tiles[i]===tile)return void this._tiles.splice(i,1);$.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",tile)},getTileCount:function(){return this._tiles.length}},$.TileCache=function(options){this._maxImageCacheCount=(options=options||{}).maxImageCacheCount||$.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},$.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(options){$.console.assert(options,"[TileCache.cacheTile] options is required"),$.console.assert(options.tile,"[TileCache.cacheTile] options.tile is required"),$.console.assert(options.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),$.console.assert(options.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var cutoff=options.cutoff||0,insertionIndex=this._tilesLoaded.length,imageRecord=this._imagesLoaded[options.tile.cacheKey];if(imageRecord||($.console.assert(options.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),imageRecord=this._imagesLoaded[options.tile.cacheKey]=new ImageRecord({image:options.image}),this._imagesLoadedCount++),imageRecord.addTile(options.tile),options.tile.cacheImageRecord=imageRecord,this._imagesLoadedCount>this._maxImageCacheCount){for(var prevTile,worstTime,worstLevel,prevTime,prevLevel,prevTileRecord,worstTile=null,worstTileIndex=-1,worstTileRecord=null,i=this._tilesLoaded.length-1;0<=i;i--)(prevTile=(prevTileRecord=this._tilesLoaded[i]).tile).level<=cutoff||prevTile.beingDrawn||(!worstTile||(prevTime=prevTile.lastTouchTime,worstTime=worstTile.lastTouchTime,prevLevel=prevTile.level,worstLevel=worstTile.level,prevTime<worstTime)||prevTime==worstTime&&worstLevel<prevLevel)&&(worstTile=prevTile,worstTileIndex=i,worstTileRecord=prevTileRecord);worstTile&&0<=worstTileIndex&&(this._unloadTile(worstTileRecord),insertionIndex=worstTileIndex)}this._tilesLoaded[insertionIndex]=new TileRecord({tile:options.tile,tiledImage:options.tiledImage})},clearTilesFor:function(tiledImage){var tileRecord;$.console.assert(tiledImage,"[TileCache.clearTilesFor] tiledImage is required");for(var i=0;i<this._tilesLoaded.length;++i)(tileRecord=this._tilesLoaded[i]).tiledImage===tiledImage&&(this._unloadTile(tileRecord),this._tilesLoaded.splice(i,1),i--)},getImageRecord:function(cacheKey){return $.console.assert(cacheKey,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[cacheKey]},_unloadTile:function(tileRecord){$.console.assert(tileRecord,"[TileCache._unloadTile] tileRecord is required");var tile=tileRecord.tile,tileRecord=tileRecord.tiledImage,imageRecord=(tile.unload(),tile.cacheImageRecord=null,this._imagesLoaded[tile.cacheKey]);imageRecord.removeTile(tile),imageRecord.getTileCount()||(imageRecord.destroy(),delete this._imagesLoaded[tile.cacheKey],this._imagesLoadedCount--),tileRecord.viewer.raiseEvent("tile-unloaded",{tile:tile,tiledImage:tileRecord})}}}(OpenSeadragon),!function($){$.World=function(options){var _this=this;$.console.assert(options.viewer,"[World] options.viewer is required"),$.EventSource.call(this),this.viewer=options.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(event){_this._autoRefigureSizes?_this._figureSizes():_this._needsSizesFigured=!0},this._figureSizes()},$.extend($.World.prototype,$.EventSource.prototype,{addItem:function(item,options){$.console.assert(item,"[World.addItem] item is required"),$.console.assert(item instanceof $.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(options=options||{}).index?(options=Math.max(0,Math.min(this._items.length,options.index)),this._items.splice(options,0,item)):this._items.push(item),this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,item.addHandler("bounds-change",this._delegatedFigureSizes),item.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:item})},getItemAt:function(index){return $.console.assert(void 0!==index,"[World.getItemAt] index is required"),this._items[index]},getIndexOfItem:function(item){return $.console.assert(item,"[World.getIndexOfItem] item is required"),$.indexOf(this._items,item)},getItemCount:function(){return this._items.length},setItemIndex:function(item,index){$.console.assert(item,"[World.setItemIndex] item is required"),$.console.assert(void 0!==index,"[World.setItemIndex] index is required");var oldIndex=this.getIndexOfItem(item);if(index>=this._items.length)throw new Error("Index bigger than number of layers.");index!==oldIndex&&-1!==oldIndex&&(this._items.splice(oldIndex,1),this._items.splice(index,0,item),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:item,previousIndex:oldIndex,newIndex:index}))},removeItem:function(item){$.console.assert(item,"[World.removeItem] item is required");var index=$.indexOf(this._items,item);-1!==index&&(item.removeHandler("bounds-change",this._delegatedFigureSizes),item.removeHandler("clip-change",this._delegatedFigureSizes),item.destroy(),this._items.splice(index,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(item))},removeAll:function(){var item,i;for(this.viewer._cancelPendingImages(),i=0;i<this._items.length;i++)(item=this._items[i]).removeHandler("bounds-change",this._delegatedFigureSizes),item.removeHandler("clip-change",this._delegatedFigureSizes),item.destroy();var removedItems=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,i=0;i<removedItems.length;i++)item=removedItems[i],this._raiseRemoveItem(item)},resetItems:function(){for(var i=0;i<this._items.length;i++)this._items[i].reset()},update:function(){for(var animated=!1,i=0;i<this._items.length;i++)animated=this._items[i].update()||animated;return animated},draw:function(){for(var i=0;i<this._items.length;i++)this._items[i].draw();this._needsDraw=!1},needsDraw:function(){for(var i=0;i<this._items.length;i++)if(this._items[i].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(value){(this._autoRefigureSizes=value)&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(options){var item,width,box,immediately=(options=options||{}).immediately||!1,layout=options.layout||$.DEFAULT_SETTINGS.collectionLayout,rows=options.rows||$.DEFAULT_SETTINGS.collectionRows,columns=options.columns||$.DEFAULT_SETTINGS.collectionColumns,tileSize=options.tileSize||$.DEFAULT_SETTINGS.collectionTileSize,increment=tileSize+(options.tileMargin||$.DEFAULT_SETTINGS.collectionTileMargin),wrap=!options.rows&&columns?columns:Math.ceil(this._items.length/rows),x=0,y=0;this.setAutoRefigureSizes(!1);for(var i=0;i<this._items.length;i++)i&&i%wrap==0&&("horizontal"===layout?(y+=increment,x=0):(x+=increment,y=0)),box=(width=(box=(item=this._items[i]).getBounds()).width>box.height?tileSize:tileSize*(box.width/box.height))*(box.height/box.width),box=new $.Point(x+(tileSize-width)/2,y+(tileSize-box)/2),item.setPosition(box,immediately),item.setWidth(width,immediately),"horizontal"===layout?x+=increment:y+=increment;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var oldHomeBounds=this._homeBounds?this._homeBounds.clone():null,oldContentSize=this._contentSize?this._contentSize.clone():null,oldContentFactor=this._contentFactor||0;if(this._items.length){for(var item=this._items[0],bounds=item.getBounds(),clippedBounds=(this._contentFactor=item.getContentSize().x/bounds.width,item.getClippedBounds().getBoundingBox()),left=clippedBounds.x,top=clippedBounds.y,right=clippedBounds.x+clippedBounds.width,bottom=clippedBounds.y+clippedBounds.height,i=1;i<this._items.length;i++)bounds=(item=this._items[i]).getBounds(),this._contentFactor=Math.max(this._contentFactor,item.getContentSize().x/bounds.width),clippedBounds=item.getClippedBounds().getBoundingBox(),left=Math.min(left,clippedBounds.x),top=Math.min(top,clippedBounds.y),right=Math.max(right,clippedBounds.x+clippedBounds.width),bottom=Math.max(bottom,clippedBounds.y+clippedBounds.height);this._homeBounds=new $.Rect(left,top,right-left,bottom-top),this._contentSize=new $.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new $.Rect(0,0,1,1),this._contentSize=new $.Point(1,1),this._contentFactor=1;this._contentFactor===oldContentFactor&&this._homeBounds.equals(oldHomeBounds)&&this._contentSize.equals(oldContentSize)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(item){this.raiseEvent("remove-item",{item:item})}})}(OpenSeadragon);