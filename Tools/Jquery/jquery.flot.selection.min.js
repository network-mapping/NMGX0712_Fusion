!function($){$.plot.plugins.push({init:function(plot){var selection={first:{x:-1,y:-1},second:{x:-1,y:-1},show:!1,active:!1},savedhandlers={},mouseUpHandler=null;function onMouseMove(e){selection.active&&(updateSelection(e),plot.getPlaceholder().trigger("plotselecting",[getSelection()]))}function onMouseDown(e){1==e.which&&(document.body.focus(),void 0!==document.onselectstart&&null==savedhandlers.onselectstart&&(savedhandlers.onselectstart=document.onselectstart,document.onselectstart=function(){return!1}),void 0!==document.ondrag&&null==savedhandlers.ondrag&&(savedhandlers.ondrag=document.ondrag,document.ondrag=function(){return!1}),setSelectionPos(selection.first,e),selection.active=!0,mouseUpHandler=function(e){!function(e){mouseUpHandler=null,void 0!==document.onselectstart&&(document.onselectstart=savedhandlers.onselectstart);void 0!==document.ondrag&&(document.ondrag=savedhandlers.ondrag);selection.active=!1,updateSelection(e),selectionIsSane()?triggerSelectedEvent():(plot.getPlaceholder().trigger("plotunselected",[]),plot.getPlaceholder().trigger("plotselecting",[null]))}(e)},$(document).one("mouseup",mouseUpHandler))}function getSelection(){var r,c1,c2;return selectionIsSane()&&selection.show?(r={},c1=selection.first,c2=selection.second,$.each(plot.getAxes(),function(name,axis){var p1;axis.used&&(p1=axis.c2p(c1[axis.direction]),axis=axis.c2p(c2[axis.direction]),r[name]={from:Math.min(p1,axis),to:Math.max(p1,axis)})}),r):null}function triggerSelectedEvent(){var r=getSelection();plot.getPlaceholder().trigger("plotselected",[r]),r.xaxis&&r.yaxis&&plot.getPlaceholder().trigger("selected",[{x1:r.xaxis.from,y1:r.yaxis.from,x2:r.xaxis.to,y2:r.yaxis.to}])}function clamp(min,value,max){return value<min?min:max<value?max:value}function setSelectionPos(pos,e){var o=plot.getOptions(),offset=plot.getPlaceholder().offset(),plotOffset=plot.getPlotOffset();pos.x=clamp(0,e.pageX-offset.left-plotOffset.left,plot.width()),pos.y=clamp(0,e.pageY-offset.top-plotOffset.top,plot.height()),"y"==o.selection.mode&&(pos.x=pos==selection.first?0:plot.width()),"x"==o.selection.mode&&(pos.y=pos==selection.first?0:plot.height())}function updateSelection(pos){null!=pos.pageX&&(setSelectionPos(selection.second,pos),selectionIsSane()?(selection.show=!0,plot.triggerRedrawOverlay()):clearSelection(!0))}function clearSelection(preventEvent){selection.show&&(selection.show=!1,plot.triggerRedrawOverlay(),preventEvent||plot.getPlaceholder().trigger("plotunselected",[]))}function extractRange(ranges,coord){var axis,key,k,tmp,from,to,axes=plot.getAxes();for(k in axes)if((axis=axes[k]).direction==coord&&ranges[key=ranges[key=coord+axis.n+"axis"]||1!=axis.n?key:coord+"axis"]){from=ranges[key].from,to=ranges[key].to;break}return ranges[key]||(axis=("x"==coord?plot.getXAxes():plot.getYAxes())[0],from=ranges[coord+"1"],to=ranges[coord+"2"]),null!=from&&null!=to&&to<from&&(tmp=from,from=to,to=tmp),{from:from,to:to,axis:axis}}function selectionIsSane(){var minSize=plot.getOptions().selection.minSize;return Math.abs(selection.second.x-selection.first.x)>=minSize&&Math.abs(selection.second.y-selection.first.y)>=minSize}plot.clearSelection=clearSelection,plot.setSelection=function(ranges,preventEvent){var range,o=plot.getOptions();"y"==o.selection.mode?(selection.first.x=0,selection.second.x=plot.width()):(range=extractRange(ranges,"x"),selection.first.x=range.axis.p2c(range.from),selection.second.x=range.axis.p2c(range.to)),"x"==o.selection.mode?(selection.first.y=0,selection.second.y=plot.height()):(range=extractRange(ranges,"y"),selection.first.y=range.axis.p2c(range.from),selection.second.y=range.axis.p2c(range.to)),selection.show=!0,plot.triggerRedrawOverlay(),!preventEvent&&selectionIsSane()&&triggerSelectedEvent()},plot.getSelection=getSelection,plot.hooks.bindEvents.push(function(plot,eventHolder){null!=plot.getOptions().selection.mode&&(eventHolder.mousemove(onMouseMove),eventHolder.mousedown(onMouseDown))}),plot.hooks.drawOverlay.push(function(plot,ctx){var plotOffset,w,h;selection.show&&selectionIsSane()&&(plotOffset=plot.getPlotOffset(),plot=plot.getOptions(),ctx.save(),ctx.translate(plotOffset.left,plotOffset.top),plotOffset=$.color.parse(plot.selection.color),ctx.strokeStyle=plotOffset.scale("a",.8).toString(),ctx.lineWidth=1,ctx.lineJoin=plot.selection.shape,ctx.fillStyle=plotOffset.scale("a",.4).toString(),plot=Math.min(selection.first.x,selection.second.x)+.5,plotOffset=Math.min(selection.first.y,selection.second.y)+.5,w=Math.abs(selection.second.x-selection.first.x)-1,h=Math.abs(selection.second.y-selection.first.y)-1,ctx.fillRect(plot,plotOffset,w,h),ctx.strokeRect(plot,plotOffset,w,h),ctx.restore())}),plot.hooks.shutdown.push(function(plot,eventHolder){eventHolder.unbind("mousemove",onMouseMove),eventHolder.unbind("mousedown",onMouseDown),mouseUpHandler&&$(document).unbind("mouseup",mouseUpHandler)})},options:{selection:{mode:null,color:"#e8cfac",shape:"round",minSize:5}},name:"selection",version:"1.1"})}(jQuery);