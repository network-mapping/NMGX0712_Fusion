$(async function(){try{var sgsConfig=services.GetParamValue("config",""),config=(application.state.projectPath=services.GetParamValue("project",""),await application.getConfigFileFromTEF(sgsConfig).catch(err=>{throw new Error(err)})),res=(application.initCustomization(config),await application.runtimeInitialized().catch(err=>{throw new Error(err)}),application.render(),await application.init().catch(err=>{throw new Error(err)}));if(res){try{parent&&parent.onTEFInit()}catch(err){}await application.authSGS(),startPage.render(function(){settings.getRecentProjects($("#startpageRecentProjectsDiv"))}),""==application.state.projectPath?application.showStartPage():application.openFly()}}catch(error){application.errorHandling(error.message,0),application.showStartPage()}});var application={state:{TEPLUS:!1,langCode:"",errorLog:[],projectPath:"",frameCounter:0,renderQuality:0,isPlanar:null,inOpenProject:!1,connectedServer:null,connectedUser:null,reloadAfterLogin:!1,openProjectsDialogAfterLogin:!1,messageBarTimeout:null,disabledMessageBar:!1,popupMessageTimeout:null,tooltipTimeout:null,tooltipOpenTime:300,sevirityText:[],sevirityColor:["s9error","s9warning","s9"],errorsCount:0,serverConfig:{},isCustomAuth:!1,treeItemIcons:{folder:"InfotreeGroupOp.bmp",object:"InfotreeObjectStatic.bmp",_19:"InfotreeLocation.bmp",_20:"InfotreeHotlink.bmp",_23:"InfotreeObjectDyn.bmp",_26:"InfotreeImageryLayer.bmp",_27:"InfotreeVideo.bmp",_28:"infoTreePointCloud.bmp",_29:"InfotreeRasterLayer.bmp",_30:"infoTreeModifyTerrain.bmp",_34:"InfotreePresentation.bmp",_35:"InfotreeLOS2.bmp",_36:"InfotreeMPV.bmp",_36_0:"LayerPointInfoTree.bmp",_36_1:"LayerPolylineInfoTree.bmp",_36_2:"LayerPolygonInfoTree.bmp",_36_3:"InfotreeMPV.bmp",_37:"InfotreeMPV.bmp",_38:"InfoTree3DMLMeshLayer.bmp",_40:"InfotreeKML.bmp",_41:"Infotree3DViewshed.bmp",_42:"infotreeContour.bmp",_43:"InfotreeSlope.bmp",_45:"InfotreeNetworkLink.bmp"},treeItemsWithoutCheckbox:[19,20,21,22,32,34,45,46],last:null},init:function(){return new Promise((resolve,reject)=>{try{if(null==SGWorld&&(SGWorld=CreateSGWorld()),!application.isBrowserSupported())return application.errorWhileLoading(Lang.application.browserNotSupported),void resolve(!1);settings.getRecentProjects($("#startpageRecentProjectsDiv")),application.state.sevirityText[0]=Lang.application.sevirityError,application.state.sevirityText[1]=Lang.application.sevirityWarning,application.state.sevirityText[2]="",$(document).tooltip({tooltipClass:"tewtooltip"}),toolbox.init(),$(window).on("onbeforeunload",function(){application.closeApp()}),$(window).resize(function(){toolbox.resizePanel()}),console.defaultError=console.error.bind(console),console.error=function(){var a=Array.from(arguments);if(0<=a[0].indexOf('resultMessageCode":"NoPermissions"'))application.setLoginState(!1),application.errorHandling(Lang.application.mustLogin,1),""!=application.state.connectedServer&&null!=application.state.connectedServer&&application.logout(),application.showLogin("reloadProject"),$("#errorLogin").show(),$("#errorLogin").text(Lang.application.mustLogin);else{if(0<=a[0].indexOf('resultMessageCode":"UnknownProject"')||0<=a[0].indexOf("Failed to load FLY:"))return application.showStartPage(Lang.application.failedToLoadFly),!1;{if(0<=a[0].indexOf("Failed to load MPT:"))return application.showStartPage(Lang.application.failedToLoadTerrain),!1;0<=a[0].toLowerCase().indexOf("missing read permission")?application.errorHandling(Lang.application.unsupportedLayersError,0):application.errorHandling(arguments[0],-1)}}},console.info=function(){application.errorHandling(arguments[0],-2)},console.warn=function(){application.errorHandling(arguments[0],-1)},null==window?attachEvent("onmessage",projectTree.receiveMessage,!1):window.addEventListener("message",projectTree.receiveMessage,!1),$("#logInContainer").dialog({autoOpen:!1,width:500,height:230,close:function(){},dialogClass:"LoginDiv dialog"}),$("#loadLayerContainer").dialog({autoOpen:!1,hide:{effect:"explode",duration:200},width:1250,height:650,dialogClass:"toolConainer dialog",close:function(){$("#loadLayerIframe").attr("src","")}}),$("#messagePopup").dialog({autoOpen:!1,hide:{effect:"explode",duration:200},dialogClass:"toolConainer dialog"}),$("#messagePopup").on("dialogclose",function(event){$("#messagePopupContent").html("")}),application.closeMessageBar()}catch(err){application.errorWhileLoading(err.message),resolve(!1)}resolve(!0)})},authSGS:function(){return new Promise((resolve,reject)=>{application.initCustomAuth().then(()=>{application.loginByTokenOrForceLogin().then(()=>{resolve()}).catch(err=>{reject(err)})})})},closeApp:function(){try{application.execute(1005,0)}catch(err){application.errorHandling(err.message,0)}},openFly:function(){$("#loadingText").text(Lang.application.loadingProject);try{SGWorld.AttachEvent("OnSGWorldMessage",application.OnSGWorldMessage),SGWorld.AttachEvent("OnMeasurementQueryResult",application.OnMeasurementQueryResult),SGWorld.AttachEvent("OnObjectUnderCursorChanged",application.OnObjectUnderCursorChanged),SGWorld.AttachEvent("OnInputModeChanged",application.OnInputModeChanged),SGWorld.AttachEvent("OnFrame",application.onFrame),SGWorld.AttachEvent("OnRenderQualityChanged",application.OnRenderQualityChanged),SGWorld.AttachEvent("OnLoadFinished",application.OnLoadFinished);var serverMatch=application.state.projectPath.match(/^(http[s]?:\/\/.+?)(\/([a-f0-9]{32}))?\/projects(\/|[?])/i);serverMatch&&(SGWorld.CoordServices.ShiftGridURL=serverMatch[1]+"/ProjData"),application.state.inOpenProject=!0,SGWorld.Project.Open(this.state.projectPath)}catch(err){application.errorWhileLoading(Lang.application.LoadingError)}},OnLoadFinished:function(success){try{$("#loadingDiv").hide(),$("#applicationDiv").show(),settings.init(),analysis.init(),projectTree.init("projectTree","myDataTree"),navigate.init(),search.init(),SGWorld.Command.IsChecked(1155,0),application.execute(1155,0),application.state.isPlanar=0!=SGWorld.Terrain.CoordinateSystem.IsPlanar(),application.setLoginState(!1),$("#LoginTitleDivID").show(),application.state.disabledMessageBar=!1,application.state.serverConfig&&application.state.serverConfig.startupScript&&eval(application.state.serverConfig.startupScript),services.loadAndRunScript("./custom/startupScript.js",!0);var script=services.GetParamValue("script","");""!=script&&services.loadAndRunScript("./custom/"+script,!0),application.state.inOpenProject=!1;try{parent&&parent.onTEFProjectLoaded()}catch(err){}}catch(err){application.errorWhileLoading(err.message)}},render:function(){try{$("body").append(` 
         <div id="errorDiv" class="errorDiv" style="display:none">
             <img src="images/img/ErrorLoading.png"  class="errorImg">
             <span id="errorTextID" class="s18 i18n"></span>  
         </div>`),$("#applicationDiv").append('<canvas id="canvas" width="300px" height="300px"  tabindex="1" oncontextmenu="event.preventDefault()"></canvas>'),$("#applicationDiv").append('<div id="toolbox" class="toolbox boxShadowLarge" ></div>'),$("#applicationDiv").append(`<div id="frameRateDiv" class="frameRate" style="display:none">
            <label for="pin" class="btns s9inv">${Lang.application.frameRate}:</label><label for="pin" class="btns s9inv" id="FR"></label>
       </div>`),$("#applicationDiv").append('<div id="logoID" class="logo" ></div>    '),$("#applicationDiv").append(`<div id="centerSignID" class="centerSign" style="display:none">
            <img src="images/icons/centerSign.png">
       </div>`),$("#applicationDiv").append(`<div id="navigationButtons" class="navigationBarDiv boxShadowLarge" style="display:none">
            <img src="images/icons/north.png" id="navigationButtonNorth" class="navigationButton link" onclick="navigate.north()">
            <img src="images/icons/ZoomIn.png" class="navigationButton link" onclick="navigate.zoom(1)">
            <img src="images/icons/ZoomOut.png" class="navigationButton link" onclick="navigate.zoom(-1)">
       </div>`),$("#applicationDiv").append(`<div id="statusBarID" class="statusBar" style="display:none">
            <table class="s9 statusBarTable"> <tr>
            <td> <div class="bufferingDivWrapper"><div id="bufferingID" class="bufferingDiv"></div></div></td>
            <td> <span id="LatID" class="s9 link2" onclick="search.inputFromCord(false)"> </span> </td>
            <td> <span id="LonID" class="s9 link2"  onclick="search.inputFromCord(false)"></span> </td>
            <td id="MGRStD" class="MGRS link2" style="display: none;"  onclick="search.inputFromCord(true)"> <span id="MGRSID" class="s9"></span> </td>
            <td> <span id="altitudeID" class="s9"></span> </td>
            <td> <span id="copyrightID" class="s9 copyright"></span></td>
        </tr> </table>
       </div>    `),$("#applicationDiv").append(`<div id="messageBar" class = "messageBar boxShadowLarge"  style="display:none">
            <span id="messageBarText" class="s9"></span>
        </div>`),$("body").append(` 
            <div id="LoginTitleDivID" class="LoginTitleDiv"  onclick="application.showLogin()" style="display:none">
                 <span class="s14w link LoginTitle" id="logInTitle" ></span> 
            </div>`),$("body").append(`
        <div id="logInContainer" style="display:none;">
            <form class="w95 h100 s9 spacerAbove px12">
                <label class="" for="serverURL">${Lang.application.serverURL}:</label>
                <input class="mt12 w95 py3 px6" type="text" id="serverURL" oninput="application.validateField()" placeholder="${Lang.application.serverURLPlaceholder}" name="serverURL">
                <div class="mt40">
                    <span class="s9 LoginError"  style="display:none" id="errorLogin"></span>
                </div>
                <div align="right">
            </form>
        </div>`),$("body").append(`
        <div id="logInContainer-2" style="display:none;">
            <form class="w95 h100 s9 spacerAbove px12">
                <label class="" for="userName">${Lang.application.userName}:</label>
                <input class="mt12 w95 py3 px6" type="text" id="userName" oninput="application.validateField()" placeholder="${Lang.application.userNamePlaceholder}" name="userName">
                <div class="mt12">
                    <label class="mt12" for="password">${Lang.application.password}:</label>
                </div>
                <input class="mt12 w95 py3 px6" type="password" id="password" oninput="application.validateField()" placeholder="${Lang.application.passwordPlaceholder}" name="password" onkeydown = 'if (event.keyCode === 13) {$("#SGSConnectBtn").click();}'>
                <div id="customAuthExtraButtons" class="spacerAbove" display="none">
                </div>
                <div class="mt12">
                    <span class="s9 LoginError"  style="display:none" id="errorLogin-2"></span>
                </div>
            </form>
        </div>`),$("body").append(`
                <div id="loadLayerContainer" title="Load Layers"  style="display:none; padding:0px">
                <table  class="panelTable s9 h100"> 
                    <tr class="h100">
                        <td >
                            <iframe type="text/html" id="loadLayerIframe" class="loadLayeriframe h100" src=""></iframe>
                        </td>
                    </tr>
                </table>
                </div>`),$("body").append(`
            <div id="dialogConfirmContainer" class="messagePopup dialogConfirmDiv s12" style="display:none;">
                <div id="dialogConfirmContent" class="messagePopupContent dialogConfirmContent"></div>
            </div>     `),$("body").append(`<div id="messagePopup" class="messagePopup s9" title="" style="display:none; padding:0px">
            <div id="messagePopupContent" class="messagePopupContent"></div>
        </div> `),$("body").append('<div id="toolTip" class = "toolTip boxShadowSmall"  style="display:none">            <span id="toolTipText" class="s9"></span>        </div>')}catch(err){application.errorWhileLoading(err.message)}},isBrowserSupported:function(){try{return""!=services.GetParamValue("ct","")?!0:(-1!==navigator.userAgent.indexOf("Edg")||-1!==navigator.userAgent.indexOf("Chrome"))&&!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}catch(err){application.errorHandling(err.message,0)}},errorWhileLoading:function(errorText){try{$("#loadingDiv").hide(),$("#errorTextID").text(errorText),$("#errorDiv").show()}catch(err){application.errorHandling(err.message,0)}},errorHandling:function(message,sevirity){var fullMessage=0==Math.abs(sevirity)?(application.state.errorsCount++,` ${message} `+(""!=arguments.callee.caller.name?arguments.callee.caller.name:"")):` ${message} `;0<=sevirity&&application.showMessageBar(application.state.sevirityText[Math.abs(sevirity)]+fullMessage,5,Math.abs(sevirity)),application.state.errorLog.push([sevirity,fullMessage]),toolbox.showLoggerCount(application.state.errorsCount)},showErrorLog:function(){try{var content="";0==this.getErrorLogCount()?content=Lang.application.noErrors:$.each(this.state.errorLog,function(index,value){content+=`<p class='${application.state.sevirityColor[Math.abs(value[0])]}'>${index+1}: ${application.state.sevirityText[Math.abs(value[0])]} ${value[1]}</p>`}),application.openPopupDialog(content,Lang.application.errorLogTitle,500,350,-1)}catch(err){application.errorHandling(err.message,0)}},getErrorLogCount:function(message){try{return application.state.errorLog.length}catch(err){application.errorHandling(err.message,0)}},getCurrentSitePath:function(){var site=services.GetParamValue("site","");return site==site==""?"":("/"+site).replace("#","").replace(/\/$/,"")},getUrlPrefix:function(){var serverMatch=application.state.projectPath.match(/^(http[s]?:\/\/.+?)(\/([a-f0-9]{32}))?\/projects(\/|[?])/i);return serverMatch?serverMatch[1]:(serverMatch=(serverMatch=0==window.location.pathname.indexOf("/")?window.location.pathname.substring(1):window.location.pathname).substring(0,serverMatch.indexOf("/")),window.location.origin+"/"+serverMatch+application.getCurrentSitePath())},initCustomAuth:function(){return new Promise(async(resolve,reject)=>{SGWorld.SGServer.Reconnect();var getConnectedServer=SGWorld.SGServer.GetConnectedServer();(""==getConnectedServer||null==getConnectedServer)&&(getConnectedServer=application.getUrlPrefix(),getConnectedServer=await application.isCustomAuth(getConnectedServer))&&"true"==getConnectedServer.result?application.autoLogin(getConnectedServer.scriptURL,(username,jwtToken)=>{try{SGWorld.SGServer.Connect(serverURL,"xxx","xxx",jwtToken),application.setLoginState(!1),resolve()}catch(e){$("#errorLogin-2").show(),$("#errorLogin-2").text(e.message)}},fnErrorResult=>{resolve()}):resolve()})},isCustomAuth:function(serverURL){return new Promise((resolve,reject)=>{fetch(serverURL+"/isCustomAuth",{method:"GET"}).then(res=>res.json()).then(result=>{resolve(result)}).catch(error=>{resolve(error.toString())})})},autoLogin:function(scriptURL,fnSuccess,fnError){var script=document.createElement("script"),scriptURL=(script.src=scriptURL,script.addEventListener("load",()=>{"function"==typeof SkylineAuthentication.autoLogin&&SkylineAuthentication.autoLogin(fnSuccess,fnError)}),script.addEventListener("error",error=>{reject(error)}),script.setAttribute("customAuth-script","1"),document.querySelector('script[customAuth-script="1"]'));scriptURL&&scriptURL.remove(),document.body.appendChild(script)},getConfigFileFromTEF:function(name){return new Promise((resolve,reject)=>{var urlPrefix=application.getUrlPrefix(),name=services.GetParamValue("config","");application.state.serverConfig.serverURL=urlPrefix,console.log("QWE: fetch /gettefconfig"),console.log(urlPrefix),console.log(name),fetch(urlPrefix+"/gettefconfig?name="+name,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then(res=>res.json()).then(result=>{1==result.result?(result=JSON.parse(result.Value),resolve(result)):resolve(JSON.parse("{}"))}).catch(error=>{resolve(JSON.parse("{}"))})})},initCustomization:function(data){var data="string"==typeof data?{}:data,data=(application.state.serverConfig={...application.state.serverConfig,...data},application.state.serverConfig.cssScript),head=document.head||document.getElementsByTagName("head")[0],style=document.createElement("style");head.appendChild(style),style.type="text/css",style.appendChild(document.createTextNode(data)),""!=(data=services.GetParamValue("css",""))&&(head="./custom/"+data+".css",(style=document.createElement("link")).setAttribute("rel","stylesheet"),style.setAttribute("href",head),document.head.appendChild(style)),application.state.langCode=services.GetParamValue("lang",""),""==application.state.langCode&&(application.state.serverConfig.customLang&&""!=application.state.serverConfig.customLang?application.state.langCode=application.state.serverConfig.customLang:application.state.serverConfig.lang&&""!=application.state.serverConfig.lang&&(application.state.langCode=application.state.serverConfig.lang))},runtimeInitialized:function(){return new Promise((resolve,reject)=>{Module.onRuntimeInitialized=function(){var scriptUrl=""!=application.state.langCode?"./js/lang/lang."+application.state.langCode+".js":"./js/lang/lang.js",script=document.createElement("script"),head=document.head||document.getElementsByTagName("head")[0];script.src=scriptUrl,script.onload=()=>{resolve()},head.insertBefore(script,head.firstChild)}})},showStartPage:function(errorMessage){try{void 0!==errorMessage&&""!==errorMessage&&$("#startPageError").html(errorMessage),$("#loadingDiv").hide(),SGWorld.SGServer.Reconnect(),$("#LoginTitleDivID").addClass("startPageLogin"),application.setLoginState(!1),$("#startPageDiv").show()}catch(err){application.errorHandling(err.message,0)}},isValidURL:function(str){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(str)},isSGSVersionGreaterThan735:function(version){var targetVersion=[7,3,5],versionParts=version.split(".").map(Number);for(let i=0;i<targetVersion.length;i++){if(versionParts[i]>targetVersion[i])return!0;if(versionParts[i]<targetVersion[i])return!1}return!1},loginByTokenOrForceLogin:function(){return new Promise((resolve,reject)=>{if(""!=application.state.projectPath){var serverMatch,loginUrl="",token="",m=decodeURIComponent(application.state.projectPath).match(/^(http[s]?:\/\/.*)\/([a-f0-9]{32})\/projects\//i);if(m&&(token=m[2],loginUrl=m[1]+"?token="+token),m||(projectMatch=location.href.match(/[?&]project=(.*)/i))&&(serverMatch=decodeURIComponent(projectMatch[1]).match(/^(http[s]?:\/\/.*)\/projects\//i))&&(m=(m=decodeURIComponent(projectMatch[1]).match(/[?&]token=([a-f0-9]{32})/i))||location.href.match(/[?&]token=([a-f0-9]{32})/i))&&(token=m[1],loginUrl=serverMatch[1]+"?token="+token),""!=loginUrl)if(""!=getConnectedServer&&null!=getConnectedServer){var projectMatch=!1;try{projectMatch=SGWorld.SGServer.IsTokenLoggedIn(token)}catch{}if(!projectMatch)if(application.isSGSVersionGreaterThan735(SGWorld.SGServer.GetVersion()))application.openConfirmationPopupDialog(Lang.application.changeSGSConnectionMessage,Lang.application.changeSGConnectionTitle,500,200,Lang.application.changeSGConnectionYesButton,function(){$(this).dialog("close"),application.logout();try{SGWorld.SGServer.Connect(loginUrl,"","")}catch{}},Lang.application.changeSGConnectionNoButton,function(){$(this).dialog("close")});else{application.logout();try{SGWorld.SGServer.Connect(loginUrl,"","")}catch{}}}else try{SGWorld.SGServer.Connect(loginUrl,"","")}catch{}else if(application.state.serverConfig&&application.state.serverConfig.loginMode){SGWorld.SGServer.Reconnect();var getConnectedServer=SGWorld.SGServer.GetConnectedServer();if("force"==application.state.serverConfig.loginMode&&""==getConnectedServer)application.showLogin(void 0,{forceLoginMode:!0});else if("token"==application.state.serverConfig.loginMode)try{SGWorld.SGServer.Connect(this.state.serverConfig.serverURL+"?token="+application.state.serverConfig.token,"","")}catch{}}}resolve()})},reloadPage:function(){try{application.state.projectPath=$("#enterProjectURL").val(),""!=application.state.projectPath&&this.isValidURL(application.state.projectPath.trim())?application.reloadPageURL(application.state.projectPath):application.showStartPage(Lang.application.failedToLoadFly)}catch(err){application.errorHandling(err.message,0)}},reloadPageURL:function(projectURL){try{var newLocation=(newLocation=location.href).substring(0,newLocation.indexOf(".html")+5);window.location=newLocation+"?project="+projectURL}catch(err){application.errorHandling(err.message,0)}},openDemoProjectURL:function(projectURL){try{var newLocation=location.origin+location.pathname,newSearch="",newSearch=null!=location.search.match(/([?&])project=[^&]*/)?location.search.replace(/([?&])project=[^&]*/,"$1project="+projectURL):(""==newSearch?"?":"&")+"project="+projectURL;window.location=newLocation+newSearch}catch(err){application.errorHandling(err.message,0)}},openInTED:function(){try{window.open(this.state.projectPath,"_blank")}catch(err){application.errorHandling(err.message,0)}},OnRenderQualityChanged:function(quality){try{application.state.renderQuality=quality}catch(err){application.errorHandling(err.message,0)}},onFrame:function(success){try{var altitudeTypeRequest,cameraPos,YSign,XSign,MGRS,rotate;application.state.frameCounter%6==0&&($("#bufferingID").width(application.state.renderQuality),altitudeTypeRequest=0==settings.state.altitudeType?0:3,cameraPos=SGWorld.Navigate.GetPosition(altitudeTypeRequest),application.state.isPlanar?($("#LatID").text(Lang.application.coordX+": "+cameraPos.X.toFixed(1)),$("#LonID").text(Lang.application.coordY+": "+cameraPos.Y.toFixed(1))):(YSign=0<cameraPos.Y?Lang.application.coordNorth:Lang.application.coordSouth,XSign=0<cameraPos.X?Lang.application.coordEast:Lang.application.coordWest,$("#LatID").text(cameraPos.Y.toFixed(5)+" "+YSign),$("#LonID").text(cameraPos.X.toFixed(5)+" "+XSign)),$("#altitudeID").text(settings.formatDistance(cameraPos.Altitude,2)+" "+settings.state.altitudeTypeString),settings.state.showMGRS)&&(MGRS=SGWorld.CoordServices.ConvertCoordinateToMGRS(cameraPos.X,cameraPos.Y),$("#MGRSID").text(Lang.application.coordMGRS+": "+MGRS)),application.state.frameCounter%3==0&&(rotate=360-SGWorld.Navigate.GetPosition(0).Yaw,$("#navigationButtonNorth").css({"-webkit-transform":"rotate("+rotate+"deg)","-moz-transform":"rotate("+rotate+"deg)",transform:"rotate("+rotate+"deg)"}))}catch(err){application.errorHandling(err.message,0)}application.state.frameCounter++},execute:function(id,param){try{SGWorld.Command.Execute(id,param)}catch(err){application.errorHandling(err.message,0)}},isCommandChecked:function(id,param){try{return SGWorld.Command.IsChecked(id,param)}catch(err){return application.errorHandling(err.message,0),!1}},OnSGWorldMessage:function(MessageID,SourceObjectID){try{var content="",width=400,height=400;if("MessageBarText"==SourceObjectID)return application.state.disabledMessageBar?void 0:(analysis.state.queryOn?analysis.showQueryHover(services.clearHTMLString(MessageID)):application.state.inOpenProject||application.showMessageBar(services.clearHTMLString(MessageID),5,2),!0);var message=SGWorld.Creator.GetObject(MessageID);if(32==message.ObjectType&&(content=""!=message.Src?`<iframe class='w100 h100' src='${message.Src}' onload='application.resizePopupDialog(this);'></iframe>`:services.clearHTMLString(""==message.InnerHTML?message.InnerText:message.InnerHTML),0==(8192&message.Flags)?(width=Math.max(100,message.Width),height=Math.max(100,message.Height)):width=height=-1,application.openPopupDialog(content,message.Caption,width,height,message.Timeout)),22==message.ObjectType)switch(message.Type){case 0:switch(content=services.clearHTMLString(message.Text),message.TargetPosition){case 3:application.showMessageBar(content,5,2);break;case 4:window.open(content,"_blank").focus();break;default:application.openPopupDialog(content,"Message",-1,-1,-1)}break;case 1:window.open(message.URL,"_blank").focus();break;case 3:0<=message.Text.indexOf("<DOCTITLE>")?application.showXMLMessage(message.Text,SourceObjectID):application.activateScriptMessage(message.Text,SourceObjectID)}}catch(err){application.errorHandling(err.message,0)}return!0},showXMLMessage:function(message,sourceObjectID){try{var xslName,xmlString=(xmlString=message.substring(message.indexOf("<"))).substring(0,xmlString.lastIndexOf(">")+1),xml=(new DOMParser).parseFromString(xmlString,"text/xml"),title="Attributes"==xml.firstChild.attributes.name.value?(xslName="Message.xsl",Lang.application.attributes):(xslName="linksMessage.xsl",Lang.application.message),xslFile=services.abspath()+"/TerraExplorerApp.Emscripten.Resources/"+xslName,xsl=services.loadXMLDoc(xslFile),html=services.convertXmlToHtml(xml,xsl);application.openPopupDialog(html,title,-1,-1,-1)}catch(err){application.errorHandling(err.message,0)}},activateScriptMessage:function(script,sourceObjectID){try{if(null==script.split(">")[1])application.errorHandling(Lang.application.noVBScript,1);else{var a=script.split(">")[1].split("<")[0],a=a.replace(/\\n/g,"");if(a=a.replace(/\t/g,""),""!=sourceObjectID&&"0_0"!=sourceObjectID)try{var object=SGWorld.Creator.GetObject(sourceObjectID),This=This70=This71=This72=This73=This74=This80=This81=This82=object}catch(err){}var SGWorld70=SGWorld71=SGWorld72=SGWorld73=SGWorld74=SGWorld80=SGWorld81=SGWorld82=SGWorld;eval(a)}}catch(err){application.errorHandling(err.message,0)}},showMessageBar:function(text,timeout,sevirity){try{$("#messageBarText").html(`<span class='${application.state.sevirityColor[sevirity]}'>${text}</span>`),$("#messageBar").show(),$("#messageBar").css("opacity","1"),$("#messageBar").css("height","60px"),$("#messageBar").css("max-height","60px"),clearTimeout(application.state.messageBarTimeout),application.state.messageBarTimeout=setTimeout("application.closeMessageBar()",1e3*timeout)}catch(err){application.errorHandling(err.message,0)}},closeMessageBar:function(){try{$("#messageBar").hide(),$("#messageBar").css("max-height","10px"),$("#messageBar").css("opacity","0"),$("#messageBar").css("height","10px")}catch(err){application.errorHandling(err.message,0)}},OnObjectUnderCursorChanged:function(inObject,objectID){try{if(1==inObject){var text="",object=null;try{object=SGWorld.Creator.GetObject(objectID)}catch(err){}null!=object&&(33==object.ObjectType?text=object.GetProperty("Tool Tip"):null!=object.Tooltip&&(text=object.Tooltip.Text),""!=text)&&(text=services.clearHTMLString(text),application.state.tooltipTimeout=setTimeout(`application.openToolTip ('${text}',10);`,application.state.tooltipOpenTime))}else clearTimeout(application.state.tooltipTimeout),application.closeToolTip()}catch(err){application.errorHandling(err.message,0)}},OnInputModeChanged:function(mode){try{0==mode&&analysis.state.queryOn&&(toolbox.closeAllTools(),analysis.stopQuery())}catch(err){application.errorHandling(err.message,0)}},openToolTip:function(text){try{$("#toolTipText").html(text);var cursor=SGWorld.Window.GetMouseInfo();0<=cursor.X&&0<=cursor.Y?($("#toolTip").css("left",cursor.X+"px"),$("#toolTip").css("top",cursor.Y+"px")):($("#toolTip").css("left","50%"),$("#toolTip").css("top","50%")),$("#toolTip").show()}catch(err){application.errorHandling(err.message,0)}},closeToolTip:function(){try{$("#toolTip").hide()}catch(err){application.errorHandling(err.message,0)}},OnMeasurementQueryResult:function(result,objectID){try{analysis.showQueryMessage(result)}catch(err){application.errorHandling(err.message,0)}},openPopupDialog:function(message,title,width,height,timeout){try{$("#messagePopupContent").html(message),$("#messagePopup").dialog("option","title",title),-1==width?$("#messagePopup").dialog("option","width","auto"):$("#messagePopup").dialog("option","width",width),-1==height?$("#messagePopup").dialog("option","height","auto"):$("#messagePopup").dialog("option","height",height),$("#messagePopup").dialog("open"),clearTimeout(application.state.popupMessageTimeout),0<timeout&&(application.state.popupMessageTimeout=setTimeout("application.closePopupDialog()",timeout))}catch(err){application.errorHandling(err.message,0)}},resizePopupDialog:function(that){try{$("#messagePopup").dialog("option","height",$($("#messagePopup")[0]).find("iframe")[0].contentWindow.document.body.scrollHeight+50),$("#messagePopup").dialog("option","width",$($("#messagePopup")[0]).find("iframe")[0].contentWindow.document.body.scrollWidth+10)}catch(err){application.errorHandling(err.message,0)}},openPopupDialogURL:function(src,title,width,height,timeout){try{var html=`<iframe class='w100 h100' src='${src}'></iframe>`;application.openPopupDialog(html,title,width,height,timeout)}catch(err){application.errorHandling(err.message,0)}},closePopupDialog:function(){try{$("#messagePopup").dialog("close")}catch(err){application.errorHandling(err.message,0)}},openConfirmationPopupDialog:function(message,title,width,height,buttonOneName,buttonOneFunction,buttonTwoName,buttonTwoFunction){try{$("#dialogConfirmContent").html(message),$("#dialogConfirmContainer").dialog({title:title,height:-1==height?"auto":height,width:-1==width?"auto":width,modal:!0,buttons:[{text:buttonOneName,id:"btnOK",class:"ButtonRound py6 px12",click:buttonOneFunction},{text:buttonTwoName,class:"ButtonRoundOutline py6 px12",click:buttonTwoFunction}],close:function(){$(this).dialog("close")}})}catch(err){application.errorHandling(err.message,0)}},showLogin:function(actionAfterLogin,options){try{switch(actionAfterLogin){case"reloadProject":application.state.reloadAfterLogin=!0;break;case"openProjectsDialogFromServer":application.state.openProjectsDialogAfterLogin=!0}$("#logInContainer").dialog({buttons:[{text:Lang.application.next,id:"loginBtnNext",class:"ButtonRound",click:async function(){var isCustomAuth;""!=(serverURL=$("#serverURL").val())&&($(this).dialog("close"),(isCustomAuth=await application.isCustomAuth(serverURL))&&"true"==isCustomAuth.result?application.autoLogin(isCustomAuth.scriptURL,(username,jwtToken)=>{try{SGWorld.SGServer.Connect(serverURL,"xxx","xxx",jwtToken),application.setLoginState(!1)}catch(e){$("#errorLogin-2").show(),$("#errorLogin-2").text(e.message)}},fnErrorResult=>{application.state.isCustomAuth=!0,"function"==typeof SkylineAuthentication.getExtraButtons&&SkylineAuthentication.getExtraButtons(imageButtons=>{imageButtons.forEach(element=>{var a=$(`<a href="#"><img src=${element.imageUrl} width="48" height="48"></a>`);a.click(function(){return element.onClick(()=>{try{SGWorld.SGServer.Connect(serverURL,"xxx","xxx",jwtToken),application.setLoginState(!1)}catch(e){$("#errorLogin-2").show(),$("#errorLogin-2").text(e.message)}},errorMessage=>{$("#errorLogin-2").show(),$("#errorLogin-2").text(errorMessage)}),!1}),$("#customAuthExtraButtons").append(a)}),$("#customAuthExtraButtons").show()},errorMessage=>{$("#errorLogin-2").show(),$("#errorLogin-2").text(errorMessage)}),$("#logInContainer-2").dialog("open")}):(application.state.isCustomAuth=!1,$("#logInContainer-2").dialog("open")))}},{text:Lang.application.logOut,id:"logOut",class:"ButtonRound",click:function(){application.state.isCustomAuth&&"function"==typeof SkylineAuthentication.Logout?(application.state.isCustomAuth=!1,SkylineAuthentication.Logout(result=>{},errorMessage=>{$("#errorLogin-2").show(),$("#errorLogin-2").text(errorMessage)})):(application.state.isCustomAuth=!1,application.logout())}}],open:function(){$(".ui-dialog-buttonset .ui-button").removeClass("ui-button ui-corner-all ui-widget")},close:function(){options&&options.onLoginDialogClosed&&options.onLoginDialogClosed()},beforeClose:function(){return!options||!options.forceLoginMode||""!=SGWorld.SGServer.GetConnectedUser()}}).dialog("open"),$("#logInContainer-2").dialog({autoOpen:!1,width:500,minHeight:230,dialogClass:"LoginDiv dialog",title:Lang.application.loginToSGS,buttons:[{text:Lang.application.back,id:"loginBtnPrev",class:"ButtonRoundOutline px12 py6",click:function(){application.state.isCustomAuth=!1,$("#customAuthExtraButtons").empty(),$("#customAuthExtraButtons").hide(),$(this).dialog("close"),$("#logInContainer").dialog("open")}},{text:Lang.application.logIn,id:"SGSConnectBtn",class:"ButtonRound",click:function(){application.state.isCustomAuth&&"function"==typeof SkylineAuthentication.Login?SkylineAuthentication.Login((username,jwtToken)=>{try{SGWorld.SGServer.Connect(serverURL,"xxx","xxx",jwtToken),application.setLoginState(!1),application.closeLogin()}catch(e){$("#errorLogin-2").show(),$("#errorLogin-2").text(e.message)}},errorMessage=>{$("#errorLogin-2").show(),$("#errorLogin-2").text(errorMessage)}):application.login()}}],open:function(event,ui){$(this).hide(),$(this).show({effect:"fade",duration:500}),$(".ui-dialog-buttonset .ui-button").removeClass("ui-button ui-corner-all ui-widget")},close:function(event,ui){if(application.state.isCustomAuth)return!1;options&&options.onLoginDialogClosed&&options.onLoginDialogClosed()},beforeClose:function(){var res=!0;return options&&options.forceLoginMode&&(""!=SGWorld.SGServer.GetConnectedUser()&&null!=SGWorld.SGServer.GetConnectedUser()||(res=!1)),$(this).effect("explode",{},200),$("#errorLogin-2").text(""),$("#customAuthExtraButtons").empty(),$("#customAuthExtraButtons").hide(),res}}),application.setLoginState(!1),application.validateField()}catch(err){application.errorHandling(err.message,0)}},closeLogin:function(){try{$("#logInContainer").dialog("close"),$("#logInContainer-2").dialog("close")}catch(err){application.errorHandling(err.message,0)}},validateField:function(){try{var disabled=0==$("#serverURL").val().length||0==$("#userName").val().length||0==$("#password").val().length||!services.validURL($("#serverURL").val().trim());return $("#SGSConnectBtn").prop("disabled",disabled),disabled}catch(err){application.errorHandling(err.message,0)}},login:function(){try{var objectData,match,serverURL,loginUrl;null!==event&&event.preventDefault(),application.validateField&&(objectData={request:"login",username:$("#userName").val(),password:$("#password").val(),isPersistent:!0},JSON.stringify(objectData),match=(serverURL=document.getElementById("serverURL").value.trim()).match(/^(.+)\/terraexplorerweb(\/|\?|$)/i),serverURL=serverURL.replace(/\/+$/g,"")+"/",loginUrl=null==match?serverURL:match[1],null===match&&(serverURL+="terraexplorerweb"),null!==loginUrl.match(/^http[s]?:\/\/[^\/]+\/*$/i)&&(loginUrl+="sg"),SGWorld.SGServer.Connect(loginUrl,objectData.username,objectData.password),application.setLoginState(!1),application.closeLogin(),application.state.reloadAfterLogin?SGWorld.Project.Open(this.state.projectPath):application.state.openProjectsDialogAfterLogin&&settings.loadProject())}catch(e){$("#errorLogin-2").show(),$("#errorLogin-2").text(e.message),application.errorHandling(e.message,1)}},OnLoginAjaxError:function(e){$("#errorLogin-2").show(),e.responseJSON?$("#errorLogin-2").text(e.responseJSON.resultMessageDescription):$("#errorLogin-2").text(Lang.application.errorNoServer)},logout:function(){try{SGWorld.SGServer.Disconnect(),application.closeLogin(),application.setLoginState(!1)}catch(err){application.errorHandling(err.message,0)}},setLoginState:function(fromOpen){try{application.state.connectedServer=SGWorld.SGServer.GetConnectedServer(),""!=application.state.connectedServer&&null!=application.state.connectedServer?(application.state.connectedUser=SGWorld.SGServer.GetConnectedUser(),$("#logInTitle").text(SGWorld.SGServer.GetUserDisplayName().substring(0,2).toUpperCase()),$("#logInTitle").prop("title",Lang.application.loggedIn+": "+application.state.connectedServer),$("#LoginTitleDivID").addClass("LoginTitleOn"),$("#LoginTitleDivID").addClass("startPageNoLogin-no-hover"),$("#errorLogin").text(""),$("#errorLogin-2").text(""),$("#serverURL").val(application.state.connectedServer),$("#serverURL").prop("disabled",!0),$("#userName").val(application.state.connectedUser),$("#userName").prop("disabled",!0),$("#passwordLine").hide(),$("#password").val(""),$("#logOut").prop("disabled",!1),$("#SGSConnectBtn").hide(),$("#loginBtnNext").hide(),$("#logOut").show(),$("#logInContainer").dialog("option","title",Lang.application.logOutFromServer)):(application.state.connectedServer=null,application.state.connectedUser=null,$("#logInTitle").text(""),$("#logInTitle").prop("title",Lang.application.clickToLogin),$("#LoginTitleDivID").removeClass("LoginTitleOn"),$("#LoginTitleDivID").removeClass("startPageNoLogin-no-hover"),$("#serverURL").val(""),$("#serverURL").prop("disabled",!1),$("#userName").val(""),$("#userName").prop("disabled",!1),$("#passwordLine").show(),$("#logOut").prop("disabled",!0),$("#SGSConnectBtn").show(),$("#loginBtnNext").show(),$("#logOut").hide(),$("#logInContainer").dialog("option","title",Lang.application.loginToSGS),$("#logInContainer-2").hasClass("ui-dialog-content")&&$("#logInContainer-2").dialog("isOpen")&&$("#logInContainer-2").dialog("close"))}catch(err){application.errorHandling(err.message,0)}},dummy:null};