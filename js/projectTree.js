var projectTree={state:{},initState:function(){try{projectTree.state={treeDivName:"",myDataDivName:"",treeState:-1,treeItemIcons:{folder:"InfotreeGroupOp.svg",object:"InfotreeObjectStatic.svg",_18:"InfotreeLabel.svg",_19:"InfotreeLocation.svg",_20:"InfotreeHotlink.svg",_23:"InfotreeObjectDyn.svg",_24:"InfotreeLabel.svg",_26:"InfotreeImageryLayer.svg",_27:"InfotreeVideo.svg",_28:"infoTreePointCloud.svg",_29:"InfotreeRasterLayer.svg",_30:"infoTreeModifyTerrain.svg",_34:"InfotreePresentation.svg",_35:"InfotreeLOS2.svg",_36:"InfotreeMPV.svg",_36_0:"LayerPointInfoTree.svg",_36_1:"LayerPolylineInfoTree.svg",_36_2:"LayerPolygonInfoTree.svg",_36_3:"InfotreeMPV.svg",_37:"InfotreeMPV.svg",_38:"InfoTree3DMLMeshLayer.svg",_40:"InfotreeKML.svg",_41:"Infotree3DViewshed.svg",_42:"infotreeContour.svg",_43:"InfotreeSlope.svg",_44:"InfotreeLabel.svg",_45:"InfotreeNetworkLink.svg"},treeIconSize:"19px",treeItemsWithoutCheckbox:[19,20,21,22,32,34,45,46],treeItemsLayers:[26,28,29,36,38],treeItemsNavigate:[19,21,34],bottomAddButtons:["layersAddLocationDiv","layersAddLayerDiv","layersAddLayerDiv"],deleteAllText:[""+Lang.projectTree.deleteAllLocations,""+Lang.projectTree.deleteAllLayers,""+Lang.projectTree.deleteAll],loadLayerType:0,myDataGroupID:"",myDataGroupName:"##My Data##",findMyData:!1,toolLastDiv:null,inQuery:!1,queryLayer:null,attributeTable:null,maxAttributeFeatures:200,spatialQueryCommand:{0:1071,1:1072,2:1074},toolsURL:{ClipModel:"./Tools/ImageComparison/BimComparisonPopup.html"},geometryTypes:["Point","Polyline","Polygon","Point"],style:{type19:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.activationAction,type:"list",list:[{name:""+Lang.projectTree.flyTo,value:0},{name:""+Lang.projectTree.jumpTo,value:14}],property:"Action.Code"}],buttons:[{name:""+Lang.projectTree.share,icon:"share.png",callback:ID=>{navigate.shareLocation(ID)},buttonType:0}]},type26:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.removeNullValue,type:"list",property:"UseNull",list:[{name:""+Lang.projectTree.yes,value:1},{name:""+Lang.projectTree.no,value:0}]},{name:""+Lang.projectTree.nullValue,type:"color",property:"NullValue"},{name:""+Lang.projectTree.nullTolerance,type:"range",property:"NullTolerance",min:"0",max:"255"}]},type28:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.pointSize,type:"range",property:"PointSize",min:"1",max:"10"},{name:""+Lang.projectTree.pointColor,type:"color",property:"PointColor"},{name:""+Lang.projectTree.intensityBlend,type:"range",property:"IntensityBlend",min:"1",max:"100",factor:100},{name:""+Lang.projectTree.flattenTerrain,type:"list",property:"FlattenBelowTerrain",list:[{name:""+Lang.projectTree.yes,value:1},{name:""+Lang.projectTree.no,value:0}]},{name:""+Lang.projectTree.altitudeMethod,type:"list",property:"AltitudeType",list:[{name:""+Lang.projectTree.relative,value:10},{name:""+Lang.projectTree.absolute,value:11},{name:""+Lang.projectTree.onTerrain,value:12}]},{name:""+Lang.projectTree.altitude,type:"number",property:"Position.Altitude",factor:"feet"}]},type29:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.removeNullValue,type:"list",property:"UseNull",list:[{name:""+Lang.projectTree.yes,value:1},{name:""+Lang.projectTree.no,value:0}]},{name:""+Lang.projectTree.nullValue,type:"number",property:"NullValue"},{name:""+Lang.projectTree.nullTolerance,type:"number",property:"NullTolerance"}]},type36_Point:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.text,type:"text",classification:"Text"},{name:""+Lang.projectTree.icon,type:"list",classification:"Image file",list:[{name:""+Lang.projectTree.no,value:""},{name:""+Lang.projectTree.yes,value:services.abspath()+"/images/icons/location.png"}]},{name:""+Lang.projectTree.scale,type:"range",classification:"Scale",min:"1",max:"1000"},{name:""+Lang.projectTree.altitudeMethod,type:"list",classification:"Altitude Method",list:[{name:""+Lang.projectTree.relative,value:10},{name:""+Lang.projectTree.absolute,value:11},{name:""+Lang.projectTree.onTerrain,value:12}]},{name:""+Lang.projectTree.altitudeOffset,type:"number",classification:"Altitude",factor:"feet"},{name:""+Lang.projectTree.tooltip,type:"text",classification:"Tool Tip"}]},type36_Polyline:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.lineWidth,type:"range",classification:"Line Width",min:"0",max:"5",factor:-1},{name:""+Lang.projectTree.lineColor,type:"color",classification:"Line Color"},{name:""+Lang.projectTree.lineOpacity,type:"range",classification:"Line Opacity",min:"0",max:"100",factor:100},{name:""+Lang.projectTree.altitudeMethod,type:"list",classification:"Altitude Method",list:[{name:""+Lang.projectTree.relative,value:10},{name:""+Lang.projectTree.absolute,value:11},{name:""+Lang.projectTree.onTerrain,value:12}]},{name:""+Lang.projectTree.altitudeOffset,type:"number",classification:"Altitude",factor:"feet"},{name:""+Lang.projectTree.tooltip,type:"text",classification:"Tool Tip"}]},type36_Polygon:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.lineWidth,type:"range",classification:"Line Width",min:"0",max:"5",factor:-1},{name:""+Lang.projectTree.lineColor,type:"color",classification:"Line Color"},{name:""+Lang.projectTree.lineOpacity,type:"range",classification:"Line Opacity",min:"0",max:"100",factor:100},{name:""+Lang.projectTree.fillColor,type:"color",classification:"Fill Color"},{name:""+Lang.projectTree.fillOpacity,type:"range",classification:"Fill Opacity",min:"0",max:"100",factor:100},{name:""+Lang.projectTree.altitudeMethod,type:"list",classification:"Altitude Method",list:[{name:""+Lang.projectTree.relative,value:10},{name:""+Lang.projectTree.absolute,value:11},{name:""+Lang.projectTree.onTerrain,value:12}]},{name:""+Lang.projectTree.altitudeOffset,type:"number",classification:"Altitude",factor:"feet"},{name:""+Lang.projectTree.tooltip,type:"text",classification:"Tool Tip"}]},type36_Colleciton:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"}]},type38:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.quality,type:"range",property:"Oversampling",min:"75",max:"150"},{name:""+Lang.projectTree.scale,type:"number",property:"ScaleFactor"},{name:""+Lang.projectTree.altitude,type:"number",property:"Position.Altitude",factor:"feet"},{name:""+Lang.projectTree.replaceTerrain,type:"list",property:"ReplaceTerrainWithMesh",list:[{name:""+Lang.projectTree.none,value:0},{name:""+Lang.projectTree.meshGroundLayer,value:1},{name:""+Lang.projectTree.simplifiedMesh,value:2}]},{name:""+Lang.projectTree.displayStyle,type:"list",property:"DisplayStyle",list:[{name:""+Lang.projectTree.texture,value:0},{name:""+Lang.projectTree.xRay,value:2},{name:""+Lang.projectTree.solidColor,value:3}]}],buttons:[{name:""+Lang.projectTree.move,icon:"MoveXY.png",callback:ID=>{projectTree.moveXY(ID)},buttonType:0}]},type41:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.altitudeAGL,type:"number",property:"Position.Altitude",factor:"feet"},{name:""+Lang.projectTree.horizontalFOV,type:"range",property:"FieldOfViewX",min:"1",max:"120"},{name:""+Lang.projectTree.verticalFOV,type:"range",property:"FieldOfViewY",min:"1",max:"120"},{name:""+Lang.projectTree.distance,type:"number",property:"Distance",factor:"feet"},{name:""+Lang.projectTree.direction,type:"number",property:"Position.Yaw",factor:"feet"}]},type99:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"}]}},query:{type36_Point:{buttons:[{name:""+Lang.projectTree.single,icon:"select.png",callback:ID=>{projectTree.layerCommand(ID,1070,0)},buttonType:0},{name:""+Lang.projectTree.area,icon:"areaSelect.png",callback:ID=>{projectTree.layerCommand(ID,1071,0)},buttonType:0},{name:""+Lang.projectTree.line,icon:"lineSelect.png",callback:ID=>{projectTree.layerCommand(ID,1072,0)},buttonType:0},{name:""+Lang.projectTree.attributes,icon:"attributeTable.png",callback:ID=>{projectTree.openAttributeTable(null)},buttonType:0}]},type36_Polyline:{buttons:[{name:""+Lang.projectTree.single,icon:"select.png",callback:ID=>{projectTree.layerCommand(ID,1070,0)},buttonType:0},{name:""+Lang.projectTree.area,icon:"areaSelect.png",callback:ID=>{projectTree.layerCommand(ID,1071,0)},buttonType:0},{name:""+Lang.projectTree.line,icon:"lineSelect.png",callback:ID=>{projectTree.layerCommand(ID,1072,0)},buttonType:0},{name:""+Lang.projectTree.attributes,icon:"attributeTable.png",callback:ID=>{projectTree.openAttributeTable(null)},buttonType:0}]},type36_Polygon:{buttons:[{name:""+Lang.projectTree.single,icon:"select.png",callback:ID=>{projectTree.layerCommand(ID,1070,0)},buttonType:0},{name:""+Lang.projectTree.area,icon:"areaSelect.png",callback:ID=>{projectTree.layerCommand(ID,1071,0)},buttonType:0},{name:""+Lang.projectTree.line,icon:"lineSelect.png",callback:ID=>{projectTree.layerCommand(ID,1072,0)},buttonType:0},{name:""+Lang.projectTree.attributes,icon:"attributeTable.png",callback:ID=>{projectTree.openAttributeTable(null)},buttonType:0}]},type36_Colleciton:{properties:[]},type99:{properties:[]}},last:null}}catch(err){application.errorHandling(err.message,0)}},init:function(divName,myDataDivName){try{for(projectTree.initState(),this.render(),this.state.treeDivName=divName,this.state.myDataDivName=myDataDivName,this.loadMyData(),this.getMyDataGroup(),this.state.treeState=0,i=0;i<=2;i++)"1px"==$("#layersButtonState"+i).css("background-size").toLowerCase()&&(this.state.treeState=i);$("#attributeTableDiv").dialog({autoOpen:!1,hide:{effect:"explode",duration:200},width:1250,height:750,dialogClass:"toolConainer dialog boxShadowLarge",resize:function(event,ui){$(".dataTables_scrollBody").css("max-height",ui.size.height-200+"px")}}),SGWorld.AttachEvent("OnObjectAction",projectTree.OnObjectAction),SGWorld.AttachEvent("OnInputModeChanged",projectTree.OnInputModeChanged)}catch(err){application.errorHandling(err.message,0)}},render:function(){try{$("#layersPanelDiv").html(` 
        <div id="layersMain" class="w100 h100">
        <table  class="tabsTable panelHeader s9"> 
            <tr>
                <td >
                    <button id="layersButtonState0" class="tab tabSelected  " onclick="projectTree.setTreeState(0)">${Lang.projectTree.navigate}</button>
                    <button id="layersButtonState1" class="tab   " onclick="projectTree.setTreeState(1)">${Lang.projectTree.layers}</button>
                    <button id="layersButtonState2" class="tab   " onclick="projectTree.setTreeState(2)">${Lang.projectTree.projectTree}</button>
                </td>
                <td class="link " colspan="2" align="right" onclick="toolbox.closeAllTools('layers',true)"><img src="images/icons/close.png"></td>
            </tr>
        </table>
        <table  class="panelTable s9">             
            <tr>
                <td id="projectTreeTD" valign="top" colspan="2">
                    <div id="projectTreeWrapperID" class="projectTreeWrapper">
                        <div id="projectTree" class="projectTree"></div>
                        <div id="myDataTitle" class="w100 s9 myDataTitle spacerAbove" style="display:none">
                            <table class="w100"><tr>
                                <td><span>${Lang.projectTree.myData} </span></td>
                                <td align="right"><span id="deleteAllID"  class="link2" onclick="projectTree.DeleteMyData()"></span></td>
                            </tr></table>
                        </div>
                        <div id="myDataTree" class="projectTree "></div>
                    </div>
                </td>
            </tr>
        </table>
        <div class="bottomBlueBar " >
            <div id='layersAddLayerDiv'  style="display:none">
             <span></span>
            </div>
            <div id='layersAddLocationDiv' class='link2' onclick="navigate.createAndEditLocation()" style="display:none">
                <span class="s9inv link">${Lang.projectTree.addLocation}</span>
                <img src="images/icons/addLocationSmall.png">
            </div>
        </div>

        </div>
        <div id="layersPSDiv" class="w100 h100" style="display:none">
            <table class="w100 h100 layersPSTable" >
                <tr class="layersPSTitle panelTable panelHeader">
                    <td>  <img src="images/icons/backArrow.png" class="link" onclick=" projectTree.closeTool()" /> </td>
                    <td align="center"> <span class="s12b" id="layersToolCaption"></span></td>
                    <td class="link " colspan="2" align="right" onclick="toolbox.closeAllTools('projectTree',true)"><img src="images/icons/close.png"></td>
                </tr>
                <tr><td colspan="3">
                        <div id="layersToolWrapper" class="w100 h100 "></div>  
                </td></tr>
            </table>            
        </div>`),$("body").append(` 
            <div id="attributeTableDiv" class = ""  style="display:none">
                <div> ${Lang.projectTree.searchQuery} 
                    <input type='text' class="attributeSearch" id="attributeTableSearchString" onkeydown = "if (event.keyCode == 13) projectTree.queryAttributes()" >
                    <button class='ButtonRoundOutline i18n' onclick="projectTree.queryAttributes()">${Lang.projectTree.search}</button>
                    <span class='s9warning' id='attributeTableMaxResults'>${Lang.projectTree.attributeMaxResult} ${projectTree.state.maxAttributeFeatures} ${Lang.projectTree.attributeItems} </span>
                </div>
                <table id="attributeTable" class="attributeTable s9" ></table>    
            </div>`),application.state.TEPLUS&&($("#layersAddLayerDiv").addClass("link"),$("#layersAddLayerDiv").attr("onClick","projectTree.loadLayer()"),$("#layersAddLayerDiv").html(`<span class="s9inv ">${Lang.projectTree.loadLayer}</span>
                                    <img src="images/icons/addLayerSmall.png">`))}catch(err){application.errorHandling(err.message,0)}},show:function(){try{var height=$("#layersPanelDiv").height()-95;$("#projectTreeWrapperID").css("height",height),this.setTreeState(this.state.treeState)}catch(err){application.errorHandling(err.message,0)}},resize:function(height){try{height=height-95;$("#projectTreeWrapperID").css("height",height)}catch(err){application.errorHandling(err.message,0)}},setTreeState:function(state){try{for(i=0;i<=2;i++)$("#layersButtonState"+i).removeClass("tabSelected");for($("#projectTreeWrapperID").css("opacity","0"),$("#layersButtonState"+state).addClass("tabSelected"),i=0;i<2;i++)$("#"+this.state.bottomAddButtons[i]).hide();$("#"+this.state.bottomAddButtons[state]).show(),$("#deleteAllID").text(this.state.deleteAllText[state]),$("#"+this.state.treeDivName).html(""),$("#"+this.state.myDataDivName).html(""),this.state.treeState=state,this.state.findMyData=!1,this.BuildProjectTree(SGWorld.ProjectTree.RootID,this.state.treeDivName,!1),this.BuildProjectTree(this.getMyDataGroup(),this.state.myDataDivName,!0),this.refreshShowHideState(SGWorld.ProjectTree.RootID),this.state.findMyData?$("#myDataTitle").show():$("#myDataTitle").hide(),setTimeout(function(){$("#projectTreeWrapperID").css("opacity","1")},300)}catch(err){application.errorHandling(err.message,0)}},BuildProjectTree:function(parentNode,parentDiv,myData){try{for(var node=SGWorld.ProjectTree.GetNextItem(parentNode,11);""!=node;){if(node!=this.getMyDataGroup()){var isGroup=SGWorld.ProjectTree.IsGroup(node),isFeatureLayer=SGWorld.ProjectTree.IsLayer(node),addItem=2==this.state.treeState,itemName=SGWorld.ProjectTree.GetItemName(node),checked=0==SGWorld.ProjectTree.GetVisibility(node)?"":"checked",featureGeometryTye="",objectType=-1,groupExpanded=!1;try{var object=SGWorld.Creator.GetObject(node);36==(objectType=object.ObjectType)&&(featureGeometryTye="_"+object.GeometryType),0<=this.state.treeItemsLayers.indexOf(objectType)&&(isGroup=!1),(1==this.state.treeState&&0<=this.state.treeItemsLayers.indexOf(objectType)||0==this.state.treeState&&0<=this.state.treeItemsNavigate.indexOf(objectType))&&(addItem=!0)}catch(err){}try{object.TreeItem.ShowInViewerTree||(addItem=!1)}catch(err){}var regularGroup,iconName,htmlStr="";addItem&&(myData&&(this.state.findMyData=!0),isGroup&&SGWorld.ProjectTree.IsExpanded(node)&&(groupExpanded=!0),htmlStr=htmlStr+`<div id="treeItem_${node}" class='treeItemLine link2' onclick='projectTree.treeActivateItem("${node}",${regularGroup=isGroup&&!isFeatureLayer&&0==SGWorld.ProjectTree.IsLocked(node)})' >`+(regularGroup?`<img src='./images/treeIcons/${groupExpanded?"minus":"plus"}.png' onclick='projectTree.expandCollapseGroup("${node}");event.stopPropagation();' class='link treeFolderPlusMinus'>`:"<div class='treeSpacer20'></div>"),-1==this.state.treeItemsWithoutCheckbox.indexOf(objectType)?htmlStr+=`<input id="treeItemCheck_${node}" class='treeCheck' type='${""!=parentNode&&SGWorld.ProjectTree.IsRadioGroup(parentNode)?"radio":"checkbox"}' onclick='projectTree.showHide ("${node}");event.stopPropagation();' ${checked}>`:htmlStr+="<div class='treeSpacer20'></div>",iconName=this.state.treeItemIcons.object,isGroup&&!isFeatureLayer?iconName=this.state.treeItemIcons.folder:void 0!==this.state.treeItemIcons["_"+objectType]&&(iconName=this.state.treeItemIcons["_"+objectType+featureGeometryTye]),htmlStr=(htmlStr+=`<img class='treeIcon' absmiddle src='./images/treeIcons/${iconName}' width='${projectTree.state.treeIconSize}' height='${projectTree.state.treeIconSize}'>`)+`<span class='treeItemName'>${itemName}</span><br>`+"</div>",$("#"+parentDiv).append(htmlStr),$("#treeItem_"+node).on("contextmenu",function(e){e.preventDefault();var menu=projectTree.buildContextMenu(e.currentTarget,myData);superCm.createMenu(menu,e)})),isGroup&&(addItem?(htmlStr=`<div id='treeItemDiv_${node}' class='treeFolderDiv' style='${groupExpanded?"":"display:none"}'></div>`,$("#"+parentDiv).append(htmlStr),this.BuildProjectTree(node,"treeItemDiv_"+node,myData)):this.BuildProjectTree(node,parentDiv,myData))}node=SGWorld.ProjectTree.GetNextItem(node,13)}}catch(err){application.errorHandling(err.message,0)}},buildContextMenu:function(targetObject,myData){try{var objectID=targetObject.id.split("treeItem_")[1],objectType=0,objectName=SGWorld.ProjectTree.GetItemName(objectID).substring(0,20),menu=[];try{objectType=SGWorld.Creator.GetObject(objectID).ObjectType}catch(e){}return 34==objectType?menu.push({objectID:objectID,objectType:objectType,label:""+Lang.projectTree.playPresentation,submenu:null,disabled:!1,action:function(option,contextMenuIndex,optionIndex){superCm.destroyMenu(),navigate.PlayObject(objectID,!0)}}):(menu.push({objectID:objectID,objectType:objectType,label:""+Lang.projectTree.flyToObject,submenu:null,disabled:!1,action:function(option,contextMenuIndex,optionIndex){superCm.destroyMenu(),SGWorld.Navigate.FlyTo(objectID)}}),menu.push({objectID:objectID,objectType:objectType,label:""+Lang.projectTree.jumpToObject,submenu:null,disabled:!1,action:function(option,contextMenuIndex,optionIndex){superCm.destroyMenu(),SGWorld.Navigate.FlyTo(objectID,14)}})),38==objectType&&menu.push({objectID:objectID,objectType:objectType,label:""+Lang.projectTree.clipModel,submenu:null,disabled:!1,action:function(option,contextMenuIndex,optionIndex){superCm.destroyMenu(),projectTree.openTool(objectID,""+Lang.projectTree.clip+objectName,1,projectTree.state.toolsURL.ClipModel+"?ID="+objectID+"&lang="+Lang.code)}}),36==objectType&&menu.push({objectID:objectID,objectType:objectType,label:""+Lang.projectTree.queryLayer,submenu:null,disabled:!1,action:function(option,contextMenuIndex,optionIndex){superCm.destroyMenu(),projectTree.state.inQuery=!0,projectTree.state.queryLayer=objectID,projectTree.openTool(objectID,Lang.projectTree.query+": "+objectName,0,"projectTree.state.query")}}),myData&&(menu.push({objectID:objectID,objectType:objectType,label:""+Lang.projectTree.delete,submenu:null,disabled:!1,action:function(option,contextMenuIndex,optionIndex){superCm.destroyMenu(),projectTree.DeleteObject(objectID)}}),0!=objectType)&&menu.push({objectID:objectID,objectType:objectType,label:""+Lang.projectTree.properties,submenu:null,disabled:!1,action:function(option,contextMenuIndex,optionIndex){superCm.destroyMenu(),projectTree.openTool(objectID,Lang.projectTree.properties+": "+objectName,0,"projectTree.state.style")}}),menu}catch(err){return application.errorHandling(err.message,0),null}},expandCollapseGroup:function(div){try{var divElement=$("#treeItemDiv_"+div);divElement.is(":visible")?(divElement.hide(),SGWorld.ProjectTree.ExpandGroup(div,!1),$("#treeItem_"+div).find("img:eq(0)").attr("src","./images/treeIcons/plus.png")):(divElement.show(),SGWorld.ProjectTree.ExpandGroup(div,!0),$("#treeItem_"+div).find("img:eq(0)").attr("src","./images/treeIcons/minus.png"))}catch(err){application.errorHandling(err.message,0)}},treeActivateItem:function(itemID,isGroup){try{isGroup?projectTree.expandCollapseGroup(""+itemID):navigate.PlayObject(itemID,!1)}catch(err){application.errorHandling(err.message,0)}},showHide:function(id){try{var show=0!=SGWorld.ProjectTree.GetVisibility(id);SGWorld.ProjectTree.SetVisibility(id,!show),this.refreshShowHideState(SGWorld.ProjectTree.RootID)}catch(err){application.errorHandling(err.message,0)}},refreshShowHideState:function(parentNode){try{for(var node=SGWorld.ProjectTree.GetNextItem(parentNode,11);""!=node;){var visibilityState=SGWorld.ProjectTree.GetVisibility(node),checked=0!=visibilityState;$("#treeItemCheck_"+node).prop("checked",checked),2==visibilityState?$("#treeItemCheck_"+node).addClass("treeCheckIndeterminate"):$("#treeItemCheck_"+node).removeClass("treeCheckIndeterminate"),SGWorld.ProjectTree.IsGroup(node)&&this.refreshShowHideState(node),node=SGWorld.ProjectTree.GetNextItem(node,13)}}catch(err){application.errorHandling(err.message,0)}},getMyDataGroup:function(){try{return""==this.state.myDataGroupID&&(this.state.myDataGroupID=SGWorld.ProjectTree.FindItem(projectTree.state.myDataGroupName),""==this.state.myDataGroupID)&&(this.state.myDataGroupID=SGWorld.ProjectTree.CreateGroup(projectTree.state.myDataGroupName,SGWorld.ProjectTree.RootID)),SGWorld.SetParam(9952,this.state.myDataGroupID),this.state.myDataGroupID}catch(err){return application.errorHandling(err.message,0),""}},refreshMyData:function(){try{$("#"+this.state.myDataDivName).html(""),this.state.findMyData=!1,this.BuildProjectTree(this.getMyDataGroup(),this.state.myDataDivName,!0),this.refreshShowHideState(SGWorld.ProjectTree.RootID),this.state.findMyData?$("#myDataTitle").show():$("#myDataTitle").hide(),application.state.disabledMessageBar=!0;SGWorld.ProjectTree.SaveAsFly(projectTree.getMyDataFileName(),this.state.myDataGroupID);application.state.disabledMessageBar=!1}catch(err){application.errorHandling(err.message,0)}},getMyDataFileName:function(){try{return services.cleanURL(application.state.projectPath)}catch(err){return application.errorHandling(err.message,0),""}},loadMyData:function(){try{var layerID=SGWorld.ProjectTree.LoadFlyLayer(SGWorld.Application.DataPath+"/"+projectTree.getMyDataFileName()+".fly",SGWorld.ProjectTree.RootID),childID=SGWorld.ProjectTree.GetNextItem(layerID,11);""!=childID&&SGWorld.ProjectTree.SetParent(childID,SGWorld.ProjectTree.RootID),SGWorld.ProjectTree.DeleteItem(layerID)}catch(err){return""}},DeleteObject:function(objectID){try{SGWorld.ProjectTree.DeleteItem(objectID),this.refreshMyData()}catch(err){return application.errorHandling(err.message,0),""}},DeleteMyData:function(){try{if(confirm(""+Lang.projectTree.sure)){for(var node=SGWorld.ProjectTree.GetNextItem(projectTree.state.myDataGroupID,11);""!=node;){var object=SGWorld.Creator.GetObject(node),objectType=0;try{objectType=object.ObjectType}catch(e){}var nextNode=SGWorld.ProjectTree.GetNextItem(node,13);(2==this.state.treeState||1==this.state.treeState&&0<=this.state.treeItemsLayers.indexOf(objectType)||0==this.state.treeState&&0<=this.state.treeItemsNavigate.indexOf(objectType))&&SGWorld.ProjectTree.DeleteItem(node),node=nextNode}this.refreshMyData()}}catch(err){return application.errorHandling(err.message,0),""}},openTool:function(itemID,title,type,param1){try{var content;toolbox.selectTool(1,!0),$("#layersMain").hide(),$("#layersPSDiv").show(),0==type?content=this.buildPropertiesSheet(itemID,param1):1==type&&(content=`<iframe  class='w100 projectTreeTooliframe' src='${param1}'></iframe>`),$("#layersToolWrapper").html(content),$("#layersToolCaption").text(title)}catch(err){application.errorHandling(err.message,0)}},closeTool:function(){try{$("#layersMain").show(),$("#layersPSDiv").hide(),$("#layersToolWrapper").html(""),this.refreshMyData(),projectTree.state.inQuery=!1,projectTree.state.queryLayer=null,SGWorld.Window.SetInputMode(0)}catch(err){application.errorHandling(err.message,0)}},buildPropertiesSheet:function(itemID,itemlist){try{var initVal="",lineNum=0,object=SGWorld.Creator.GetObject(itemID),objectType=object.ObjectType,PSArray=(36==objectType&&(objectType+="_"+this.state.geometryTypes[object.GeometryType]),eval(itemlist+'["type"+objectType]')),html=(null==PSArray&&(PSArray=eval(itemlist+'["type99"]')),"<table id='propertiesTable' class='propertiesTable'> ");return $.each(PSArray.properties,function(index,value){var type=value.type,highlight=lineNum%2==0?"propertiesTRGray":"",color,factor=(html+=`<tr class='${highlight}'><td>${value.name}</td>`,html+="<td >",36==object.ObjectType&&null!=value.classification?eval(`object.FeatureGroups.${projectTree.state.geometryTypes[object.GeometryType]}.IsClassified('${value.classification}')`)?(initVal=eval(`object.FeatureGroups.${projectTree.state.geometryTypes[object.GeometryType]}.GetClassification('${value.classification}')`),initVal=initVal.replaceAll("'",'"'),0<=initVal.indexOf("<Classification")&&(type="text")):initVal=eval(`object.FeatureGroups.${projectTree.state.geometryTypes[object.GeometryType]}.GetProperty('${value.classification}')`):null!=value.property&&(initVal=eval("object."+value.property)),"color"==type&&(color=SGWorld.Creator.CreateColor(),color.FromABGRColor(initVal),initVal=color.ToHTMLColor()),null);switch(type){case"number":case"range":var minStr=null!=value.min?`min='${value.min}'`:"",maxStr=null!=value.max?`max='${value.max}'`:"",factor=1;null!=value.factor&&(factor="feet"==value.factor?settings.state.unitRatio:value.factor),initVal=(+initVal*factor).toFixed(5);case"text":case"color":html+=`<input type='${type}' value='${initVal}' ${minStr} ${maxStr}  onchange='projectTree.updateProperty(this,"${itemID}","${value.property}","${value.classification}",${factor})' >`;break;case"list":html+=`<select onchange='projectTree.updateProperty(this,"${itemID}","${value.property}","${value.classification}",null)'>`,$.each(value.list,function(index,listValue){var selected=listValue.value==initVal?'selected="selected"':"";html+=`<option value=${listValue.value} ${selected}>${listValue.name}</option>>`}),html+="</select>"}html+="</td></tr>",lineNum++}),html+="<tr><td colspan='2'>",$.each(PSArray.buttons,function(index,button){html+=`<button class='ButtonRoundOutline ButtonLarge  ' onclick='${itemlist}.type${objectType}.buttons[${index}].callback("${itemID}")'><img src="images/icons/${button.icon}"><br><span>${button.name}</span></button>`}),html+=`<button class='ButtonRoundOutline ButtonLarge  ' onclick='SGWorld.Navigate.FlyTo ("${itemID}");' title='${Lang.projectTree.flyToTooltip}'><img src="images/icons/zoomTo.png"><br><span>${Lang.projectTree.zoom}</span></button>`,html+=`<button class='ButtonRoundOutline ButtonLarge  ' onclick='projectTree.closeTool()' title='${Lang.projectTree.closeTooltip}'><img src="images/icons/OK.png"><br><span>${Lang.projectTree.close}</span></button>`,html+="</td></tr>",html+="</table>",html}catch(err){return application.errorHandling(err.message,0),""}},updateProperty:function(inputObj,itemID,property,classification,factor){try{var object=SGWorld.Creator.GetObject(itemID),newValue=null!=factor?inputObj.value/factor:inputObj.value,command;36==object.ObjectType&&"undefined"!=classification?(command="SetProperty",0<=(newValue+"").indexOf("<Classification")&&(command="SetClassification"),eval(`object.FeatureGroups.${projectTree.state.geometryTypes[object.GeometryType]}.${command}('${classification}','${newValue}')`)):"undefined"!=property&&eval(`object.${property} = "${newValue}"`)}catch(err){return application.errorHandling(err.message,0),""}},moveXY:function(itemID){try{SGWorld.ProjectTree.EditItemEx(itemID,4097,0,0,0)}catch(err){return application.errorHandling(err.message,0),""}},layerCommand:function(itemID,queryType,value){try{services.resetAllButtons($("#propertiesTable")),services.highlightButtonFromEvent(event,!application.isCommandChecked(queryType,0)),SGWorld.ProjectTree.SelectItem(itemID,0,0),application.execute(queryType,value)}catch(err){return application.errorHandling(err.message,0),""}},OnObjectAction:function(ObjectID,Action){try{projectTree.state.inQuery&&20==Action.Code&&(SGWorld.Window.SetInputMode(0),SGWorld.Application.Selection.Add(ObjectID),projectTree.openAttributeTable([ObjectID]))}catch(err){application.errorHandling(err.message,0)}},OnInputModeChanged:function(mode){try{projectTree.state.inQuery&&0==mode&&services.resetAllButtons($("#propertiesTable"))}catch(err){application.errorHandling(err.message,0)}},openAttributeTable:function(objects){try{if($("#attributeTableSearchString").val(""),$("#attributeTableDiv").dialog("open"),0<SGWorld.Application.Selection.Count){var features=[];$("#attributeTableSearchString").attr("placeholder",""+Lang.projectTree.selectedFeatures);for(var i=0;i<SGWorld.Application.Selection.Count;i++)features.push(SGWorld.Application.Selection.Item(i));projectTree.buildAttributesTable(features,!0)}else $("#attributeTableSearchString").attr("placeholder",""),projectTree.queryAttributes();$(".dataTables_scrollBody").css("max-height",$("#attributeTableDiv").height()-180+"px")}catch(err){application.errorHandling(err.message,0)}},queryAttributes:function(){try{var featureLayer=SGWorld.Creator.GetObject(projectTree.state.queryLayer);features=featureLayer.ExecuteQuery($("#attributeTableSearchString").val(),projectTree.state.maxAttributeFeatures,"",SGWorld.Creator.GeometryCreator.CreatePolygonGeometry(null)),$("#attributeTableSearchString").attr("placeholder",""),projectTree.buildAttributesTable(features,!1)}catch(err){application.errorHandling(err.message,0)}},buildAttributesTable:function(features,selectedFeatures){try{projectTree.cleanAttributeTable(),cols=[],rows=[],$("#attributeTableMaxResults").hide();var count=selectedFeatures?features.length:features.Count;if(0==count)application.errorHandling(""+Lang.projectTree.errorNoFeatures,2);else{count==projectTree.state.maxAttributeFeatures&&$("#attributeTableMaxResults").show();var firstFeature=selectedFeatures?features[0]:features.Item(0);cols[0]={title:"#"};for(var j=0;j<firstFeature.FeatureAttributes.Count;j++)cols[j+1]={title:firstFeature.FeatureAttributes.Item(j).Name};for(var i=0;i<count;i++){var currentFeature=selectedFeatures?features[i]:features.Item(i);if(3!=currentFeature.State){var row=[];row[0]=`<span class='link' onclick='navigate.FlyToFeatureID ("${projectTree.state.queryLayer}","${currentFeature.DataSourceFeatureID}");'>${i}</span>`;for(j=0;j<currentFeature.FeatureAttributes.Count;j++)row[j+1]=`<span class='link' onclick='navigate.FlyToFeatureDataSourceFeatureID ("${projectTree.state.queryLayer}","${currentFeature.DataSourceFeatureID}");'>${currentFeature.FeatureAttributes.Item(j).Value}</span>`;rows.push(row)}}projectTree.state.attributeTable=$("#attributeTable").DataTable({columns:cols,data:rows,paging:!1,info:!1,pageLength:500,scrollY:"200px",scrollCollapse:!0}),$(".dataTables_scrollBody").css("max-height",$("#attributeTableDiv").height()-180+"px")}}catch(err){application.errorHandling(err.message,0)}},cleanAttributeTable:function(){try{null!=projectTree.state.attributeTable&&($("#attributeTable").DataTable().clear().draw(),$("#attributeTable").DataTable().destroy(),$("#attributeTable thead").html(""),projectTree.state.attributeTable=null)}catch(err){application.errorHandling(err.message,0)}},loadLayer:function(){try{application.state.TEPLUS&&(null==application.state.connectedServer?application.errorHandling(""+Lang.projectTree.errorMustLogin,2):(window.isSGSCreatorLoaded||(window.isSGSCreatorLoaded=!0),projectTree.openLayersDialog(application.state.connectedServer+"/telayers?type=Mesh|Feature|Imagery|RasterComplex|PointCloud|Elevation|TerraBuilderProject|TerraExplorerProjectDesktop&tewebnew=true",1)))}catch(err){application.errorHandling(err.message,0)}},openLayersDialog:function(url,type){try{projectTree.state.loadLayerType=type,$("#loadLayerIframe").attr("src",url),$("#loadLayerContainer").dialog("open")}catch(err){application.errorHandling(err.message,0)}},receiveMessage:function(data){try{var layers,groupID,layer;"close"==data.data?$("#loadLayerContainer").dialog("close"):(layers=JSON.parse(data.data),groupID=projectTree.getMyDataGroup(),layer=null,$.each(layers,function(key,value){switch(value.type){case"Mesh3DML":case"MeshPhotoMesh":value.url+="/streamer.ashx",layer=SGWorld.Creator.CreateMeshLayerFromSGS(value.url,value.catalogID,groupID);break;case"FeaturePoint":case"FeatureLine":case"FeaturePolygon":case"FeatureComplex":(layer=SGWorld.Creator.CreateFeatureLayer(value.catalogID,"Server="+value.url+"/streamer.ashx;WFSVersion=1.0.0;LayerName="+value.catalogID+";TEPlugName=WFS;",groupID)).DataSourceInfo.Attributes.ImportAll=!0,"FeaturePoint"==value.type&&(layer.FeatureGroups.Point.DisplayAs=18),layer.Load();break;case"RasterComplex":case"UnknownRaster":case"Imagery":case"Elevation":case"TerraBuilderProject":var layerExtension=value.name.split(".").pop(),layerName=value.catalogID+"."+layerExtension+"@"+value.urlWithoutProtocol;"Elevation"==value.type||"RasterComplex"==value.type&&"elevation"==value.typeParameter||"TerraBuilderProject"==value.type&&"imagery"!=value.typeParameter?(layer=SGWorld.Creator.CreateElevationLayer(layerName,0,0,0,0,'<EXT><ExtInfo><![CDATA[<Skyline version="1.0.0"><ServerList name="'+value.catalogID+"."+layerExtension+'"><Server priority="1">'+value.urlWithoutProtocol+"</Server></ServerList></Skyline>]]></ExtInfo><ExtType>mpt</ExtType></EXT>","mptplg.rct",groupID)).TreeItem.Name=value.catalogID:(layer=SGWorld.Creator.CreateImageryLayer(layerName,0,0,0,0,'<EXT><ExtInfo><![CDATA[<Skyline version="1.0.0"><ServerList name="'+value.catalogID+"."+layerExtension+'"><Server priority="1">'+value.urlWithoutProtocol+"</Server></ServerList></Skyline>]]></ExtInfo><ExtType>mpt</ExtType></EXT>","mptplg.rct",groupID)).TreeItem.Name=value.catalogID;break;case"TerraExplorerProject":case"TerraExplorerProjectDesktop":case"TerraExplorerProjectMobile":0==projectTree.state.loadLayerType?application.reloadPageURL(value.url+"/projects/"+value.catalogID):SGWorld.ProjectTree.LoadFlyLayer(value.url+"/projects/"+value.catalogID,groupID);break;case"KML":case"KMZ":case"TerraExplorerProjectWeb":SGWorld.Creator.CreateKMLLayer(value.url+"/projects/"+value.catalogID,groupID);break;case"PointCloud":layerName=SGWorld.Creator.CreatePosition(0,0,0,3,0,0,0,0);(layer=SGWorld.Creator.CreatePointCloudModel(value.catalogID+".cpt@"+value.urlWithoutProtocol,layerName,groupID)).TreeItem.Name=value.catalogID;break;default:application.errorHandling(""+Lang.projectTree.errorNotSupported,1)}}),1==layers.length&&null!=layer?projectTree.openTool(layer.ID,Lang.projectTree.edit,0,"projectTree.state.style"):setTimeout(()=>{projectTree.refreshMyData()},10),$("#loadLayerContainer").dialog("close"))}catch(err){application.errorHandling(err.message,0)}},dummy:null};